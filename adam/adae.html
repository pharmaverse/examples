<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ADAE – pharmaverse examples</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../tlg/demographic.html" rel="next">
<link href="../adam/advs.html" rel="prev">
<link href="../assets/img/Pharmaverse_examples.png" rel="icon" type="image/png">
<script src="../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-bc185b5c5bdbcb35c2eb49d8a876ef70.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-c3ad7b7c660ea9194172360a214f88a3.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-d986666dcae71c20e4dd59d93fa9b0e2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-c3ad7b7c660ea9194172360a214f88a3.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en-US"
  });
});
</script> 
  
<style>html{ scroll-behavior: smooth; }</style>
<script src="../site_libs/core-js-2.5.3/shim.min.js"></script>
<script src="../site_libs/react-18.2.0/react.min.js"></script>
<script src="../site_libs/react-18.2.0/react-dom.min.js"></script>
<script src="../site_libs/reactwidget-2.0.0/react-tools.js"></script>
<link href="../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="../site_libs/reactable-0.4.4/reactable.css" rel="stylesheet">
<script src="../site_libs/reactable-binding-0.4.4/reactable.js"></script>


<link rel="stylesheet" href="../assets/css/style.scss">
<meta property="og:title" content="ADAE – pharmaverse examples">
<meta property="og:description" content="">
<meta property="og:image" content="https://pharmaverse.github.io/examples/adam/assets/img/Pharmaverse_examples.png">
<meta property="og:site_name" content="pharmaverse examples">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">pharmaverse examples</span>
    </a>
  </div>
          <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://pharmaverse.github.io/examples/"> <i class="bi bi-house" role="img" aria-label="pharmaverse">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://app.slack.com/client/T028PB489D3/"> <i class="bi bi-slack" role="img" aria-label="Slack">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pharmaverse/examples"> <i class="bi bi-github" role="img" aria-label="Repository">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
            <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../adam/adsl.html">ADaM</a></li><li class="breadcrumb-item"><a href="../adam/adae.html">ADAE</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../assets/img/Pharmaverse_examples.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">SDTM</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sdtm/examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SDTM Examples</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">ADaM</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../adam/adsl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ADSL</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../adam/adpc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ADPC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../adam/adppk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ADPPK</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../adam/adrs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ADRS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../adam/adtte.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ADTTE</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../adam/advs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ADVS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../adam/adae.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">ADAE</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">TLG</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tlg/demographic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Demographic Table</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tlg/adverse_events.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Adverse Events</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tlg/pharmacokinetic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pharmacokinetic</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Interactive</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../interactive/teal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>teal</code> applications</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Logs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../logging/logging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Difference Between <code>logr</code>, <code>logrx</code>, and <code>whirl</code></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">eSubmission</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../esub/esub.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">eSubmission</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../session.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Info</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://pharmaverse.org/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pharmaverse Home</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../adam/adsl.html">ADaM</a></li><li class="breadcrumb-item"><a href="../adam/adae.html">ADAE</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">ADAE</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i></button></div></div>
</div>



<div class="quarto-title-meta column-page-right">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This article provides a step-by-step explanation for creating an ADaM <code>ADAE</code> (Adverse Events) dataset using key pharmaverse packages along with tidyverse components.</p>
<p>Here we try to cover the most common AE analysis dataset derivations and some of the most useful functions for these.</p>
<p>For the purpose of this example, we will use the <code>ADSL</code> dataset from <code>{pharmaverseadam}</code> and <code>ae</code> and <code>ex</code> domains from <code>{pharmaversesdtm}</code>.</p>
<section id="programming-flow" class="level2">
<h2 class="anchored" data-anchor-id="programming-flow">Programming Flow</h2>
<ul>
<li><a href="#loaddata">Load Data and Required pharmaverse Packages</a></li>
<li><a href="#loadspecs">Load Specifications for Metacore</a></li>
<li><a href="#adslvars">Select ADSL Variables</a></li>
<li><a href="#startbuild">Start Building Derivations</a></li>
<li><a href="#anldates">Derive Analysis Dates</a></li>
<li><a href="#anldur">Derive Duration</a></li>
<li><a href="#exdates">Derive Date of Last Dose</a></li>
<li><a href="#anlflags">Derive Analysis Flags</a></li>
<li><a href="#occflags">Derive Occurrence Flags</a></li>
<li><a href="#query">Derive Query Variables</a></li>
<li><a href="#adsladd">Add ADSL Variables</a></li>
<li><a href="#metacore_xportr">Apply Metadata to Create an eSub XPT and Perform Associated Checks</a></li>
</ul>
</section>
</section>
<section id="loaddata" class="level1">
<h1>Load Data and Required pharmaverse Packages</h1>
<p>The first step is to load the required packages and input data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(metacore)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(metatools)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(pharmaversesdtm)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(pharmaverseadam)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(admiral)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(xportr)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="fu">library</span>(reactable)</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co"># Read in input data</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>adsl <span class="ot">&lt;-</span> pharmaverseadam<span class="sc">::</span>adsl</span>
<span id="cb1-14"><a href="#cb1-14"></a>ae <span class="ot">&lt;-</span> pharmaversesdtm<span class="sc">::</span>ae</span>
<span id="cb1-15"><a href="#cb1-15"></a>ex <span class="ot">&lt;-</span> pharmaversesdtm<span class="sc">::</span>ex</span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="co"># When SAS datasets are imported into R using haven::read_sas(), missing</span></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co"># character values from SAS appear as "" characters in R, instead of appearing</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co"># as NA values. Further details can be obtained via the following link:</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="co"># https://pharmaverse.github.io/admiral/articles/admiral.html#handling-of-missing-values</span></span>
<span id="cb1-21"><a href="#cb1-21"></a>ae <span class="ot">&lt;-</span> <span class="fu">convert_blanks_to_na</span>(ae)</span>
<span id="cb1-22"><a href="#cb1-22"></a>ex <span class="ot">&lt;-</span> <span class="fu">convert_blanks_to_na</span>(ex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loadspecs" class="level1">
<h1>Load Specifications for Metacore</h1>
<p>We have saved our specifications in an Excel file and will load them into <code>{metacore}</code> with the <code>metacore::spec_to_metacore()</code> function.</p>
<p>When you run this in your R script you might find warnings that come from <code>{metacore}</code> which help you to improve your specifications. Examples could be specification columns with only missing values or unused codelists, but once checked these warnings could be suppressed using something like <code>suppressWarnings()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># ---- Load Specs for Metacore ----</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>metacore <span class="ot">&lt;-</span> <span class="fu">spec_to_metacore</span>(</span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="at">path =</span> <span class="st">"./metadata/safety_specs.xlsx"</span>,</span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="co"># All datasets are described in the same sheet</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="at">where_sep_sheet =</span> <span class="cn">FALSE</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="fu">select_dataset</span>(<span class="st">"ADAE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adslvars" class="level1">
<h1>Select ADSL Variables</h1>
<p>Some variables from the <code>ADSL</code> dataset required for the derivations are merged into the <code>AE</code> domain using the <code>admiral::derive_vars_merged()</code> function. Find other <code>{admiral}</code> functions and related variables by searching <a href="https://pharmaverse.github.io/admiraldiscovery/articles/reactable.html">admiraldiscovery</a>. The rest of the relevant <code>ADSL</code> variables will be added later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Select required ADSL variables</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>adsl_vars <span class="ot">&lt;-</span> <span class="fu">exprs</span>(TRTSDT, TRTEDT, DTHDT)</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co"># Join ADSL variables with VS</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>adae <span class="ot">&lt;-</span> ae <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb3-7"><a href="#cb3-7"></a>    <span class="at">dataset_add =</span> adsl,</span>
<span id="cb3-8"><a href="#cb3-8"></a>    <span class="at">new_vars =</span> adsl_vars,</span>
<span id="cb3-9"><a href="#cb3-9"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID)</span>
<span id="cb3-10"><a href="#cb3-10"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="startbuild" class="level1">
<h1>Start Building Derivations</h1>
<section id="anldates" class="level2">
<h2 class="anchored" data-anchor-id="anldates">Derive Analysis Dates</h2>
<p>The first derivation step we are going to do is to compute the Analysis Date and Relative Analysis Day with the variables merged from <code>ADSL</code> dataset using the <code>admiral::derive_vars_dt()</code> and <code>admiral::derive_vars_dy()</code> functions.</p>
<p>When deriving AE end date first as <code>AENDT</code>, we’re going to impute partial dates with missing day or month. For AE start date <code>ASTDT</code> then we’re going to use the same imputation, but additionally we ensure that the imputed date doesn’t go before treatment start date or after the AE end date.</p>
<p>For all of these example calls we don’t generally include the default arguments, so you should be sure to check out the full functional reference pages as then you’ll also learn what other arguments exist to allow further user control over the derivations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Derive ASTDT/ASTDTF/ASTDY and AENDT/AENDTF/AENDY</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>adae <span class="ot">&lt;-</span> adae <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">derive_vars_dt</span>(</span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="at">new_vars_prefix =</span> <span class="st">"AEN"</span>,</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="at">dtc =</span> AEENDTC,</span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="at">date_imputation =</span> <span class="st">"last"</span>,</span>
<span id="cb4-7"><a href="#cb4-7"></a>    <span class="at">highest_imputation =</span> <span class="st">"M"</span>, <span class="co"># imputation is performed on missing days or months</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="at">flag_imputation =</span> <span class="st">"auto"</span> <span class="co"># to automatically create AENDTF variable</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>  <span class="fu">derive_vars_dt</span>(</span>
<span id="cb4-11"><a href="#cb4-11"></a>    <span class="at">new_vars_prefix =</span> <span class="st">"AST"</span>,</span>
<span id="cb4-12"><a href="#cb4-12"></a>    <span class="at">dtc =</span> AESTDTC,</span>
<span id="cb4-13"><a href="#cb4-13"></a>    <span class="at">highest_imputation =</span> <span class="st">"M"</span>, <span class="co"># imputation is performed on missing days or months</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>    <span class="at">flag_imputation =</span> <span class="st">"auto"</span>, <span class="co"># to automatically create ASTDTF variable</span></span>
<span id="cb4-15"><a href="#cb4-15"></a>    <span class="at">min_dates =</span> <span class="fu">exprs</span>(TRTSDT), <span class="co"># apply a minimum date for the imputation</span></span>
<span id="cb4-16"><a href="#cb4-16"></a>    <span class="at">max_dates =</span> <span class="fu">exprs</span>(AENDT) <span class="co"># apply a maximum date for the imputation</span></span>
<span id="cb4-17"><a href="#cb4-17"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-18"><a href="#cb4-18"></a>  <span class="fu">derive_vars_dy</span>(</span>
<span id="cb4-19"><a href="#cb4-19"></a>    <span class="at">reference_date =</span> TRTSDT,</span>
<span id="cb4-20"><a href="#cb4-20"></a>    <span class="at">source_vars =</span> <span class="fu">exprs</span>(ASTDT, AENDT)</span>
<span id="cb4-21"><a href="#cb4-21"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-fc3a4345ec85c0f3b8c1" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-fc3a4345ec85c0f3b8c1">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1023","01-701-1023","01-701-1023","01-701-1023","01-701-1028","01-701-1028","01-701-1034"],"AESTDTC":["2014-01-03","2014-01-03","2014-01-09","2012-08-26","2012-08-07","2012-08-07","2012-08-07","2013-07-21","2013-08-08","2014-08-27"],"ASTDT":["2014-01-03","2014-01-03","2014-01-09","2012-08-26","2012-08-07","2012-08-07","2012-08-07","2013-07-21","2013-08-08","2014-08-27"],"ASTDTF":[null,null,null,null,null,null,null,null,null,null],"ASTDY":[2,2,8,22,3,3,3,3,21,58],"AEENDTC":[null,null,"2014-01-11",null,"2012-08-30",null,"2012-08-30",null,null,null],"AENDT":[null,null,"2014-01-11",null,"2012-08-30",null,"2012-08-30",null,null,null],"AENDTF":[null,null,null,null,null,null,null,null,null,null],"AENDY":["NA","NA",10,"NA",26,"NA",26,"NA","NA","NA"]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"AESTDTC","name":"AESTDTC","type":"character"},{"id":"ASTDT","name":"ASTDT","type":"Date"},{"id":"ASTDTF","name":"ASTDTF","type":"character"},{"id":"ASTDY","name":"ASTDY","type":"numeric"},{"id":"AEENDTC","name":"AEENDTC","type":"character"},{"id":"AENDT","name":"AENDT","type":"Date"},{"id":"AENDTF","name":"AENDTF","type":"character"},{"id":"AENDY","name":"AENDY","type":"numeric"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"00db3a4dff811fd09b4ae6399bf14203"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="anldur" class="level2">
<h2 class="anchored" data-anchor-id="anldur">Derive Duration</h2>
<p>Now we have these date variables we can derive AE duration using the <code>admiral::derive_vars_duration()</code> function. For this function the default is to + 1 day for the calculation, but this can be controlled with the <code>add_one</code> argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Derive ADURN/ADURU</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>adae <span class="ot">&lt;-</span> adae <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">derive_vars_duration</span>(</span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span class="at">new_var =</span> ADURN,</span>
<span id="cb5-5"><a href="#cb5-5"></a>    <span class="at">new_var_unit =</span> ADURU,</span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="at">start_date =</span> ASTDT,</span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="at">end_date =</span> AENDT</span>
<span id="cb5-8"><a href="#cb5-8"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-b893512d9bed40a4c008" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b893512d9bed40a4c008">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1023","01-701-1023","01-701-1023","01-701-1023","01-701-1028","01-701-1028","01-701-1034"],"ASTDT":["2014-01-03","2014-01-03","2014-01-09","2012-08-26","2012-08-07","2012-08-07","2012-08-07","2013-07-21","2013-08-08","2014-08-27"],"AENDT":[null,null,"2014-01-11",null,"2012-08-30",null,"2012-08-30",null,null,null],"ADURN":["NA","NA",3,"NA",24,"NA",24,"NA","NA","NA"],"ADURU":[null,null,"DAYS",null,"DAYS",null,"DAYS",null,null,null]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"ASTDT","name":"ASTDT","type":"Date"},{"id":"AENDT","name":"AENDT","type":"Date"},{"id":"ADURN","name":"ADURN","type":"numeric"},{"id":"ADURU","name":"ADURU","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"9dc42ca6ada5546fdc49553c87e23dd1"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="exdates" class="level2">
<h2 class="anchored" data-anchor-id="exdates">Derive Date of Last Dose</h2>
<p>You might need to add some exposure information from <code>ex</code> such as deriving the date of last dose before each AE.</p>
<p>In the below case we call this <code>LDOSEDT</code> and we want to look only at exposure records with a valid dose or placebo. Here we use the <code>admiral::derive_vars_joined()</code> function which enables more complex joins.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Derive LDOSEDT</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co"># In our ex data the EXDOSFRQ (frequency) is "QD" which stands for once daily</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co"># If this was not the case then we would need to use the admiral::create_single_dose_dataset() function</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co"># to generate single doses from aggregate dose information</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co"># Refer to https://pharmaverse.github.io/admiral/reference/create_single_dose_dataset.html</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>ex <span class="ot">&lt;-</span> ex <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="fu">derive_vars_dt</span>(</span>
<span id="cb6-8"><a href="#cb6-8"></a>    <span class="at">dtc =</span> EXENDTC,</span>
<span id="cb6-9"><a href="#cb6-9"></a>    <span class="at">new_vars_prefix =</span> <span class="st">"EXEN"</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>  )</span>
<span id="cb6-11"><a href="#cb6-11"></a></span>
<span id="cb6-12"><a href="#cb6-12"></a>adae <span class="ot">&lt;-</span> adae <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>  <span class="fu">derive_vars_joined</span>(</span>
<span id="cb6-14"><a href="#cb6-14"></a>    <span class="at">dataset_add =</span> ex,</span>
<span id="cb6-15"><a href="#cb6-15"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID),</span>
<span id="cb6-16"><a href="#cb6-16"></a>    <span class="at">order =</span> <span class="fu">exprs</span>(EXENDT),</span>
<span id="cb6-17"><a href="#cb6-17"></a>    <span class="at">new_vars =</span> <span class="fu">exprs</span>(<span class="at">LDOSEDT =</span> EXENDT),</span>
<span id="cb6-18"><a href="#cb6-18"></a>    <span class="at">join_vars =</span> <span class="fu">exprs</span>(EXENDT),</span>
<span id="cb6-19"><a href="#cb6-19"></a>    <span class="at">join_type =</span> <span class="st">"all"</span>,</span>
<span id="cb6-20"><a href="#cb6-20"></a>    <span class="at">filter_add =</span> (EXDOSE <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> (EXDOSE <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(EXTRT, <span class="st">"PLACEBO"</span>))) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(EXENDT),</span>
<span id="cb6-21"><a href="#cb6-21"></a>    <span class="at">filter_join =</span> EXENDT <span class="sc">&lt;=</span> ASTDT,</span>
<span id="cb6-22"><a href="#cb6-22"></a>    <span class="at">mode =</span> <span class="st">"last"</span></span>
<span id="cb6-23"><a href="#cb6-23"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-27adde07f0a10096a2a2" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-27adde07f0a10096a2a2">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1023","01-701-1023","01-701-1028","01-701-1028","01-701-1028","01-701-1033","01-701-1034"],"EXTRT":["PLACEBO","PLACEBO","PLACEBO","PLACEBO","PLACEBO","XANOMELINE","XANOMELINE","XANOMELINE","XANOMELINE","XANOMELINE"],"EXDOSE":[0,0,0,0,0,54,81,54,54,54],"EXENDT":["2014-01-16","2014-06-18","2014-07-02","2012-08-27","2012-09-01","2013-08-01","2014-01-06","2014-01-14","2014-03-31","2014-07-15"]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"EXTRT","name":"EXTRT","type":"character"},{"id":"EXDOSE","name":"EXDOSE","type":"numeric"},{"id":"EXENDT","name":"EXENDT","type":"Date"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"e01a47c2ab62dcd615f9124bfaa9c1be"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-7377f22fb6abb8ab1c00" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7377f22fb6abb8ab1c00">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1023","01-701-1023","01-701-1023","01-701-1023","01-701-1028","01-701-1028","01-701-1034"],"ASTDT":["2014-01-03","2014-01-03","2014-01-09","2012-08-26","2012-08-07","2012-08-07","2012-08-07","2013-07-21","2013-08-08","2014-08-27"],"LDOSEDT":[null,null,null,null,null,null,null,null,"2013-08-01","2014-07-15"]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"ASTDT","name":"ASTDT","type":"Date"},{"id":"LDOSEDT","name":"LDOSEDT","type":"Date"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"1ec75ee0a0414aaf1fe52c49438d1e54"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="anlflags" class="level2">
<h2 class="anchored" data-anchor-id="anlflags">Derive Analysis Flags</h2>
<p>Next we looks at common analysis flags such as treatment emergent and on treatment flags using the <code>admiral::derive_var_trtemfl()</code> and <code>admiral::derive_var_ontrtfl()</code> functions. For the on-treatment flag we only want to include AEs occurring until 30 days after treatment end.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Derive TRTEMFL and ONTRTFL</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>adae <span class="ot">&lt;-</span> adae <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">derive_var_trtemfl</span>(</span>
<span id="cb7-4"><a href="#cb7-4"></a>    <span class="at">start_date =</span> ASTDT,</span>
<span id="cb7-5"><a href="#cb7-5"></a>    <span class="at">end_date =</span> AENDT,</span>
<span id="cb7-6"><a href="#cb7-6"></a>    <span class="at">trt_start_date =</span> TRTSDT,</span>
<span id="cb7-7"><a href="#cb7-7"></a>    <span class="at">trt_end_date =</span> TRTEDT</span>
<span id="cb7-8"><a href="#cb7-8"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="fu">derive_var_ontrtfl</span>(</span>
<span id="cb7-10"><a href="#cb7-10"></a>    <span class="at">start_date =</span> ASTDT,</span>
<span id="cb7-11"><a href="#cb7-11"></a>    <span class="at">ref_start_date =</span> TRTSDT,</span>
<span id="cb7-12"><a href="#cb7-12"></a>    <span class="at">ref_end_date =</span> TRTEDT,</span>
<span id="cb7-13"><a href="#cb7-13"></a>    <span class="at">ref_end_window =</span> <span class="dv">30</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-afc9fb573603f1d0f940" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-afc9fb573603f1d0f940">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1023","01-701-1023","01-701-1023","01-701-1023","01-701-1028","01-701-1028","01-701-1034"],"ASTDT":["2014-01-03","2014-01-03","2014-01-09","2012-08-26","2012-08-07","2012-08-07","2012-08-07","2013-07-21","2013-08-08","2014-08-27"],"TRTSDT":["2014-01-02","2014-01-02","2014-01-02","2012-08-05","2012-08-05","2012-08-05","2012-08-05","2013-07-19","2013-07-19","2014-07-01"],"TRTEDT":["2014-07-02","2014-07-02","2014-07-02","2012-09-01","2012-09-01","2012-09-01","2012-09-01","2014-01-14","2014-01-14","2014-12-30"],"TRTEMFL":["Y","Y","Y","Y","Y","Y","Y","Y","Y","Y"],"ONTRTFL":["Y","Y","Y","Y","Y","Y","Y","Y","Y","Y"]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"ASTDT","name":"ASTDT","type":"Date"},{"id":"TRTSDT","name":"TRTSDT","type":"Date"},{"id":"TRTEDT","name":"TRTEDT","type":"Date"},{"id":"TRTEMFL","name":"TRTEMFL","type":"character"},{"id":"ONTRTFL","name":"ONTRTFL","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"c2277be5c4f668dbb13833812620fe0d"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>At first these 2 functions may appear similar but both offer extra specific arguments for flexibility if you needed to apply more complex analysis rules to these derivations. For example, for treatment emergent you could use the intensity arguments if you also wanted to flag those AEs starting before treatment start and ending after treatment start with worsened intensity (i.e.&nbsp;the most extreme intensity is greater than the initial intensity).</p>
</section>
<section id="occflags" class="level2">
<h2 class="anchored" data-anchor-id="occflags">Derive Occurrence Flags</h2>
<p>There can be flags that need to be derived based on AE occurrences, such as flagging the first occurrence of maximum severity per patient which in the below example we call <code>AOCCIFL</code>. Here we use the <code>admiral::derive_var_extreme_flag()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Derive AOCCIFL</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>adae <span class="ot">&lt;-</span> adae <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="co"># create temporary numeric ASEVN for sorting purpose</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">mutate</span>(<span class="at">TEMP_AESEVN =</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(AESEV, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"SEVERE"</span>, <span class="st">"MODERATE"</span>, <span class="st">"MILD"</span>)))) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="fu">derive_var_extreme_flag</span>(</span>
<span id="cb8-6"><a href="#cb8-6"></a>    <span class="at">new_var =</span> AOCCIFL,</span>
<span id="cb8-7"><a href="#cb8-7"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID),</span>
<span id="cb8-8"><a href="#cb8-8"></a>    <span class="at">order =</span> <span class="fu">exprs</span>(TEMP_AESEVN, ASTDT, AESEQ),</span>
<span id="cb8-9"><a href="#cb8-9"></a>    <span class="at">mode =</span> <span class="st">"first"</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-9755167df75c3986ca5e" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9755167df75c3986ca5e">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1023","01-701-1023","01-701-1023","01-701-1023","01-701-1028","01-701-1028","01-701-1034"],"ASTDT":["2014-01-03","2014-01-03","2014-01-09","2012-08-07","2012-08-07","2012-08-07","2012-08-26","2013-07-21","2013-08-08","2014-08-27"],"AESEQ":[1,2,3,2,1,4,3,1,2,1],"AESEV":["MILD","MILD","MILD","MODERATE","MILD","MILD","MILD","MILD","MILD","MILD"],"AOCCIFL":["Y",null,null,"Y",null,null,null,"Y",null,"Y"]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"ASTDT","name":"ASTDT","type":"Date"},{"id":"AESEQ","name":"AESEQ","type":"numeric"},{"id":"AESEV","name":"AESEV","type":"character"},{"id":"AOCCIFL","name":"AOCCIFL","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"01dcbee0589beb6c97c2632204ac2cdb"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="query" class="level2">
<h2 class="anchored" data-anchor-id="query">Derive Query Variables</h2>
<p>The final set of derived flags would be around those checking for queries/baskets of AE terms, e.g.&nbsp;using Standardized MedDRA Queries (SMQs) or Custom Queries (CQs).</p>
<p>Before reading this section, you should read the <a href="https://pharmaverse.github.io/admiral/articles/queries_dataset.html">Queries Dataset Vignette</a> from <code>{admiral}</code>.</p>
<p>On a study you would need to create your own version of this queries dataset with the AE queries you need, but for the purpose of this article we use the example provided as part of <code>{admiral}</code> and we filter it to just one CQ and one SMQ. Then you can derive the required variables using the <code>admiral::derive_vars_query()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>queries <span class="ot">&lt;-</span> admiral<span class="sc">::</span>queries <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="fu">filter</span>(PREFIX <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CQ01"</span>, <span class="st">"SMQ02"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-099691b66ec32263fff2" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-099691b66ec32263fff2">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"PREFIX":["CQ01","CQ01","CQ01","CQ01","CQ01","SMQ02","SMQ02","SMQ02"],"GRPNAME":["Dermatologic events","Dermatologic events","Dermatologic events","Dermatologic events","Dermatologic events","Immune-Mediated Hypothyroidism","Immune-Mediated Hypothyroidism","Immune-Mediated Hypothyroidism"],"GRPID":["NA","NA","NA","NA","NA",20000160,20000160,20000160],"SCOPE":[null,null,null,null,null,"BROAD","BROAD","NARROW"],"SCOPEN":["NA","NA","NA","NA","NA",1,1,2],"SRCVAR":["AELLT","AELLT","AELLT","AELLT","AELLT","AEDECOD","AEDECOD","AEDECOD"],"TERMCHAR":["APPLICATION SITE ERYTHEMA","APPLICATION SITE PRURITUS","ERYTHEMA","LOCALIZED ERYTHEMA","GENERALIZED PRURITUS","BIOPSY THYROID GLAND ABNORMAL","BLOOD THYROID STIMULATING HORMONE ABNORMAL","BIOPSY THYROID GLAND INCREASED"],"TERMNUM":["NA","NA","NA","NA","NA","NA","NA","NA"]},"columns":[{"id":"PREFIX","name":"PREFIX","type":"character"},{"id":"GRPNAME","name":"GRPNAME","type":"character"},{"id":"GRPID","name":"GRPID","type":"numeric"},{"id":"SCOPE","name":"SCOPE","type":"character"},{"id":"SCOPEN","name":"SCOPEN","type":"numeric"},{"id":"SRCVAR","name":"SRCVAR","type":"character"},{"id":"TERMCHAR","name":"TERMCHAR","type":"character"},{"id":"TERMNUM","name":"TERMNUM","type":"numeric"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"b3605a3d79ffdd2c26fdcb5dc010980c"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Derive CQ01NAM and SMQ02NAM</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>adae <span class="ot">&lt;-</span> adae <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="fu">derive_vars_query</span>(<span class="at">dataset_queries =</span> queries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-74b53db9aeb0d6fce28f" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-74b53db9aeb0d6fce28f">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1023","01-701-1023","01-701-1023","01-701-1023","01-701-1028","01-701-1028","01-701-1034"],"AEDECOD":["APPLICATION SITE ERYTHEMA","APPLICATION SITE PRURITUS","DIARRHOEA","ERYTHEMA","ERYTHEMA","ERYTHEMA","ATRIOVENTRICULAR BLOCK SECOND DEGREE","APPLICATION SITE ERYTHEMA","APPLICATION SITE PRURITUS","APPLICATION SITE PRURITUS"],"CQ01NAM":[null,null,null,"Dermatologic events","Dermatologic events","Dermatologic events",null,"Dermatologic events",null,null],"SMQ02NAM":[null,null,null,null,null,null,null,null,null,null]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"AEDECOD","name":"AEDECOD","type":"character"},{"id":"CQ01NAM","name":"CQ01NAM","type":"character"},{"id":"SMQ02NAM","name":"SMQ02NAM","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"8ac99bbc58ccd9ad139651cceec45108"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="adsladd" class="level2">
<h2 class="anchored" data-anchor-id="adsladd">Add ADSL Variables</h2>
<p>If needed, the other <code>ADSL</code> variables can now be added. List of ADSL variables already merged held in vector <code>adsl_vars</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>adae <span class="ot">&lt;-</span> adae <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="at">dataset_add =</span> <span class="fu">select</span>(adsl, <span class="sc">!!!</span><span class="fu">negate_vars</span>(adsl_vars)),</span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID)</span>
<span id="cb11-5"><a href="#cb11-5"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="metacore_xportr" class="level1">
<h1>Apply Metadata to Create an eSub XPT and Perform Associated Checks</h1>
<p>We use <code>{metatools}</code> and <code>{xportr}</code> to perform checks, apply metadata such as types, lengths, labels, and write the dataset to an XPT file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">tempdir</span>() <span class="co"># Specify the directory for saving the XPT file</span></span>
<span id="cb12-2"><a href="#cb12-2"></a></span>
<span id="cb12-3"><a href="#cb12-3"></a>adae <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">drop_unspec_vars</span>(metacore) <span class="sc">%&gt;%</span> <span class="co"># Drop unspecified variables from specs</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="fu">check_variables</span>(metacore) <span class="sc">%&gt;%</span> <span class="co"># Check all variables specified are present and no more</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="fu">check_ct_data</span>(metacore, <span class="at">na_acceptable =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="co"># Checks all variables with CT only contain values within the CT</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>  <span class="fu">order_cols</span>(metacore) <span class="sc">%&gt;%</span> <span class="co"># Orders the columns according to the spec</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>  <span class="fu">sort_by_key</span>(metacore) <span class="sc">%&gt;%</span> <span class="co"># Sorts the rows by the sort keys</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>  <span class="fu">xportr_type</span>(metacore, <span class="at">domain =</span> <span class="st">"ADAE"</span>) <span class="sc">%&gt;%</span> <span class="co"># Coerce variable type to match spec</span></span>
<span id="cb12-10"><a href="#cb12-10"></a>  <span class="fu">xportr_length</span>(metacore) <span class="sc">%&gt;%</span> <span class="co"># Assigns SAS length from a variable level metadata</span></span>
<span id="cb12-11"><a href="#cb12-11"></a>  <span class="fu">xportr_label</span>(metacore) <span class="sc">%&gt;%</span> <span class="co"># Assigns variable label from metacore specifications</span></span>
<span id="cb12-12"><a href="#cb12-12"></a>  <span class="fu">xportr_df_label</span>(metacore) <span class="sc">%&gt;%</span>  <span class="co"># Assigns dataset label from metacore specifications</span></span>
<span id="cb12-13"><a href="#cb12-13"></a>  <span class="fu">xportr_write</span>(<span class="fu">file.path</span>(dir, <span class="st">"adae.xpt"</span>), <span class="at">metadata =</span> metacore, <span class="at">domain =</span> <span class="st">"ADAE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/pharmaverse\.github\.io\/examples\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation column-page-right">
  <div class="nav-page nav-page-previous">
      <a href="../adam/advs.html" class="pagination-link" aria-label="ADVS">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">ADVS</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../tlg/demographic.html" class="pagination-link" aria-label="Demographic Table">
        <span class="nav-page-text">Demographic Table</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb13" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">---</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="an">title:</span><span class="co"> "ADAE"</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="an">order:</span><span class="co"> 7</span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co">---</span></span>
<span id="cb13-5"><a href="#cb13-5"></a></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="in">```{r setup script, include=FALSE, purl=FALSE}</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>invisible_hook_purl <span class="ot">&lt;-</span> <span class="cf">function</span>(before, options, ...) {</span>
<span id="cb13-8"><a href="#cb13-8"></a>  knitr<span class="sc">::</span><span class="fu">hook_purl</span>(before, options, ...)</span>
<span id="cb13-9"><a href="#cb13-9"></a>  <span class="cn">NULL</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>}</span>
<span id="cb13-11"><a href="#cb13-11"></a>knitr<span class="sc">::</span>knit_hooks<span class="sc">$</span><span class="fu">set</span>(<span class="at">purl =</span> invisible_hook_purl)</span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="fu">source</span>(<span class="st">"functions/print_df.R"</span>)</span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="in">```</span></span>
<span id="cb13-14"><a href="#cb13-14"></a></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="fu"># Introduction</span></span>
<span id="cb13-16"><a href="#cb13-16"></a></span>
<span id="cb13-17"><a href="#cb13-17"></a>This article provides a step-by-step explanation for creating an ADaM <span class="in">`ADAE`</span> (Adverse Events) dataset using key pharmaverse packages along with tidyverse components.</span>
<span id="cb13-18"><a href="#cb13-18"></a></span>
<span id="cb13-19"><a href="#cb13-19"></a>Here we try to cover the most common AE analysis dataset derivations and some of the most useful functions for these. </span>
<span id="cb13-20"><a href="#cb13-20"></a></span>
<span id="cb13-21"><a href="#cb13-21"></a>For the purpose of this example, we will use the <span class="in">`ADSL`</span> dataset from <span class="in">`{pharmaverseadam}`</span> and <span class="in">`ae`</span> and <span class="in">`ex`</span> domains from <span class="in">`{pharmaversesdtm}`</span>.</span>
<span id="cb13-22"><a href="#cb13-22"></a></span>
<span id="cb13-23"><a href="#cb13-23"></a><span class="fu">## Programming Flow</span></span>
<span id="cb13-24"><a href="#cb13-24"></a></span>
<span id="cb13-25"><a href="#cb13-25"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Load Data and Required pharmaverse Packages</span><span class="co">](#loaddata)</span></span>
<span id="cb13-26"><a href="#cb13-26"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Load Specifications for Metacore</span><span class="co">](#loadspecs)</span></span>
<span id="cb13-27"><a href="#cb13-27"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Select ADSL Variables</span><span class="co">](#adslvars)</span></span>
<span id="cb13-28"><a href="#cb13-28"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Start Building Derivations</span><span class="co">](#startbuild)</span></span>
<span id="cb13-29"><a href="#cb13-29"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Derive Analysis Dates</span><span class="co">](#anldates)</span></span>
<span id="cb13-30"><a href="#cb13-30"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Derive Duration</span><span class="co">](#anldur)</span></span>
<span id="cb13-31"><a href="#cb13-31"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Derive Date of Last Dose</span><span class="co">](#exdates)</span></span>
<span id="cb13-32"><a href="#cb13-32"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Derive Analysis Flags</span><span class="co">](#anlflags)</span></span>
<span id="cb13-33"><a href="#cb13-33"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Derive Occurrence Flags</span><span class="co">](#occflags)</span></span>
<span id="cb13-34"><a href="#cb13-34"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Derive Query Variables</span><span class="co">](#query)</span></span>
<span id="cb13-35"><a href="#cb13-35"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Add ADSL Variables</span><span class="co">](#adsladd)</span></span>
<span id="cb13-36"><a href="#cb13-36"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Apply Metadata to Create an eSub XPT and Perform Associated Checks</span><span class="co">](#metacore_xportr)</span></span>
<span id="cb13-37"><a href="#cb13-37"></a></span>
<span id="cb13-38"><a href="#cb13-38"></a><span class="fu"># Load Data and Required pharmaverse Packages {#loaddata}</span></span>
<span id="cb13-39"><a href="#cb13-39"></a></span>
<span id="cb13-40"><a href="#cb13-40"></a>The first step is to load the required packages and input data.</span>
<span id="cb13-41"><a href="#cb13-41"></a></span>
<span id="cb13-42"><a href="#cb13-42"></a><span class="in">```{r setup, message=FALSE, warning=FALSE, results='hold'}</span></span>
<span id="cb13-43"><a href="#cb13-43"></a><span class="fu">library</span>(metacore)</span>
<span id="cb13-44"><a href="#cb13-44"></a><span class="fu">library</span>(metatools)</span>
<span id="cb13-45"><a href="#cb13-45"></a><span class="fu">library</span>(pharmaversesdtm)</span>
<span id="cb13-46"><a href="#cb13-46"></a><span class="fu">library</span>(pharmaverseadam)</span>
<span id="cb13-47"><a href="#cb13-47"></a><span class="fu">library</span>(admiral)</span>
<span id="cb13-48"><a href="#cb13-48"></a><span class="fu">library</span>(xportr)</span>
<span id="cb13-49"><a href="#cb13-49"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb13-50"><a href="#cb13-50"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb13-51"><a href="#cb13-51"></a><span class="fu">library</span>(stringr)</span>
<span id="cb13-52"><a href="#cb13-52"></a><span class="fu">library</span>(reactable)</span>
<span id="cb13-53"><a href="#cb13-53"></a></span>
<span id="cb13-54"><a href="#cb13-54"></a><span class="co"># Read in input data</span></span>
<span id="cb13-55"><a href="#cb13-55"></a>adsl <span class="ot">&lt;-</span> pharmaverseadam<span class="sc">::</span>adsl</span>
<span id="cb13-56"><a href="#cb13-56"></a>ae <span class="ot">&lt;-</span> pharmaversesdtm<span class="sc">::</span>ae</span>
<span id="cb13-57"><a href="#cb13-57"></a>ex <span class="ot">&lt;-</span> pharmaversesdtm<span class="sc">::</span>ex</span>
<span id="cb13-58"><a href="#cb13-58"></a></span>
<span id="cb13-59"><a href="#cb13-59"></a><span class="co"># When SAS datasets are imported into R using haven::read_sas(), missing</span></span>
<span id="cb13-60"><a href="#cb13-60"></a><span class="co"># character values from SAS appear as "" characters in R, instead of appearing</span></span>
<span id="cb13-61"><a href="#cb13-61"></a><span class="co"># as NA values. Further details can be obtained via the following link:</span></span>
<span id="cb13-62"><a href="#cb13-62"></a><span class="co"># https://pharmaverse.github.io/admiral/articles/admiral.html#handling-of-missing-values</span></span>
<span id="cb13-63"><a href="#cb13-63"></a>ae <span class="ot">&lt;-</span> <span class="fu">convert_blanks_to_na</span>(ae)</span>
<span id="cb13-64"><a href="#cb13-64"></a>ex <span class="ot">&lt;-</span> <span class="fu">convert_blanks_to_na</span>(ex)</span>
<span id="cb13-65"><a href="#cb13-65"></a><span class="in">```</span></span>
<span id="cb13-66"><a href="#cb13-66"></a></span>
<span id="cb13-67"><a href="#cb13-67"></a><span class="fu"># Load Specifications for Metacore {#loadspecs}</span></span>
<span id="cb13-68"><a href="#cb13-68"></a></span>
<span id="cb13-69"><a href="#cb13-69"></a>We have saved our specifications in an Excel file and will load them into <span class="in">`{metacore}`</span> with the <span class="in">`metacore::spec_to_metacore()`</span> function.</span>
<span id="cb13-70"><a href="#cb13-70"></a></span>
<span id="cb13-71"><a href="#cb13-71"></a>When you run this in your R script you might find warnings that come from <span class="in">`{metacore}`</span> which help you to improve your specifications.</span>
<span id="cb13-72"><a href="#cb13-72"></a>Examples could be specification columns with only missing values or unused codelists, but once checked these warnings could be suppressed using something like <span class="in">`suppressWarnings()`</span>.</span>
<span id="cb13-73"><a href="#cb13-73"></a></span>
<span id="cb13-74"><a href="#cb13-74"></a><span class="in">```{r echo=TRUE}</span></span>
<span id="cb13-75"><a href="#cb13-75"></a><span class="co">#| label: Load Specs</span></span>
<span id="cb13-76"><a href="#cb13-76"></a><span class="co">#| warning: false</span></span>
<span id="cb13-77"><a href="#cb13-77"></a><span class="co"># ---- Load Specs for Metacore ----</span></span>
<span id="cb13-78"><a href="#cb13-78"></a>metacore <span class="ot">&lt;-</span> <span class="fu">spec_to_metacore</span>(</span>
<span id="cb13-79"><a href="#cb13-79"></a>  <span class="at">path =</span> <span class="st">"./metadata/safety_specs.xlsx"</span>,</span>
<span id="cb13-80"><a href="#cb13-80"></a>  <span class="co"># All datasets are described in the same sheet</span></span>
<span id="cb13-81"><a href="#cb13-81"></a>  <span class="at">where_sep_sheet =</span> <span class="cn">FALSE</span></span>
<span id="cb13-82"><a href="#cb13-82"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb13-83"><a href="#cb13-83"></a>  <span class="fu">select_dataset</span>(<span class="st">"ADAE"</span>)</span>
<span id="cb13-84"><a href="#cb13-84"></a><span class="in">```</span></span>
<span id="cb13-85"><a href="#cb13-85"></a></span>
<span id="cb13-86"><a href="#cb13-86"></a><span class="fu"># Select ADSL Variables {#adslvars}</span></span>
<span id="cb13-87"><a href="#cb13-87"></a></span>
<span id="cb13-88"><a href="#cb13-88"></a>Some variables from the <span class="in">`ADSL`</span> dataset required for the derivations are merged into the <span class="in">`AE`</span> domain using the <span class="in">`admiral::derive_vars_merged()`</span> function. Find other <span class="in">`{admiral}`</span> functions and related variables by searching <span class="co">[</span><span class="ot">admiraldiscovery</span><span class="co">](&lt;https://pharmaverse.github.io/admiraldiscovery/articles/reactable.html&gt;)</span>. The rest of the relevant <span class="in">`ADSL`</span> variables will be added later.</span>
<span id="cb13-89"><a href="#cb13-89"></a></span>
<span id="cb13-92"><a href="#cb13-92"></a><span class="in">```{r}</span></span>
<span id="cb13-93"><a href="#cb13-93"></a><span class="co"># Select required ADSL variables</span></span>
<span id="cb13-94"><a href="#cb13-94"></a>adsl_vars <span class="ot">&lt;-</span> <span class="fu">exprs</span>(TRTSDT, TRTEDT, DTHDT)</span>
<span id="cb13-95"><a href="#cb13-95"></a></span>
<span id="cb13-96"><a href="#cb13-96"></a><span class="co"># Join ADSL variables with VS</span></span>
<span id="cb13-97"><a href="#cb13-97"></a>adae <span class="ot">&lt;-</span> ae <span class="sc">%&gt;%</span></span>
<span id="cb13-98"><a href="#cb13-98"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb13-99"><a href="#cb13-99"></a>    <span class="at">dataset_add =</span> adsl,</span>
<span id="cb13-100"><a href="#cb13-100"></a>    <span class="at">new_vars =</span> adsl_vars,</span>
<span id="cb13-101"><a href="#cb13-101"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID)</span>
<span id="cb13-102"><a href="#cb13-102"></a>  )</span>
<span id="cb13-103"><a href="#cb13-103"></a><span class="in">```</span></span>
<span id="cb13-104"><a href="#cb13-104"></a></span>
<span id="cb13-105"><a href="#cb13-105"></a><span class="fu"># Start Building Derivations {#startbuild}</span></span>
<span id="cb13-106"><a href="#cb13-106"></a></span>
<span id="cb13-107"><a href="#cb13-107"></a><span class="fu">## Derive Analysis Dates {#anldates}</span></span>
<span id="cb13-108"><a href="#cb13-108"></a></span>
<span id="cb13-109"><a href="#cb13-109"></a>The first derivation step we are going to do is to compute the Analysis Date and Relative Analysis Day with the variables merged from <span class="in">`ADSL`</span> dataset using the <span class="in">`admiral::derive_vars_dt()`</span> and <span class="in">`admiral::derive_vars_dy()`</span> functions.</span>
<span id="cb13-110"><a href="#cb13-110"></a></span>
<span id="cb13-111"><a href="#cb13-111"></a>When deriving AE end date first as <span class="in">`AENDT`</span>, we're going to impute partial dates with missing day or month.</span>
<span id="cb13-112"><a href="#cb13-112"></a>For AE start date <span class="in">`ASTDT`</span> then we're going to use the same imputation, but additionally we ensure that the imputed date doesn't go before treatment start date or after the AE end date.</span>
<span id="cb13-113"><a href="#cb13-113"></a></span>
<span id="cb13-114"><a href="#cb13-114"></a>For all of these example calls we don't generally include the default arguments, so you should be sure to check out the full functional reference pages as then you'll also learn what other arguments exist to allow further user control over the derivations.</span>
<span id="cb13-115"><a href="#cb13-115"></a></span>
<span id="cb13-118"><a href="#cb13-118"></a><span class="in">```{r}</span></span>
<span id="cb13-119"><a href="#cb13-119"></a><span class="co"># Derive ASTDT/ASTDTF/ASTDY and AENDT/AENDTF/AENDY</span></span>
<span id="cb13-120"><a href="#cb13-120"></a>adae <span class="ot">&lt;-</span> adae <span class="sc">%&gt;%</span></span>
<span id="cb13-121"><a href="#cb13-121"></a>  <span class="fu">derive_vars_dt</span>(</span>
<span id="cb13-122"><a href="#cb13-122"></a>    <span class="at">new_vars_prefix =</span> <span class="st">"AEN"</span>,</span>
<span id="cb13-123"><a href="#cb13-123"></a>    <span class="at">dtc =</span> AEENDTC,</span>
<span id="cb13-124"><a href="#cb13-124"></a>    <span class="at">date_imputation =</span> <span class="st">"last"</span>,</span>
<span id="cb13-125"><a href="#cb13-125"></a>    <span class="at">highest_imputation =</span> <span class="st">"M"</span>, <span class="co"># imputation is performed on missing days or months</span></span>
<span id="cb13-126"><a href="#cb13-126"></a>    <span class="at">flag_imputation =</span> <span class="st">"auto"</span> <span class="co"># to automatically create AENDTF variable</span></span>
<span id="cb13-127"><a href="#cb13-127"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-128"><a href="#cb13-128"></a>  <span class="fu">derive_vars_dt</span>(</span>
<span id="cb13-129"><a href="#cb13-129"></a>    <span class="at">new_vars_prefix =</span> <span class="st">"AST"</span>,</span>
<span id="cb13-130"><a href="#cb13-130"></a>    <span class="at">dtc =</span> AESTDTC,</span>
<span id="cb13-131"><a href="#cb13-131"></a>    <span class="at">highest_imputation =</span> <span class="st">"M"</span>, <span class="co"># imputation is performed on missing days or months</span></span>
<span id="cb13-132"><a href="#cb13-132"></a>    <span class="at">flag_imputation =</span> <span class="st">"auto"</span>, <span class="co"># to automatically create ASTDTF variable</span></span>
<span id="cb13-133"><a href="#cb13-133"></a>    <span class="at">min_dates =</span> <span class="fu">exprs</span>(TRTSDT), <span class="co"># apply a minimum date for the imputation</span></span>
<span id="cb13-134"><a href="#cb13-134"></a>    <span class="at">max_dates =</span> <span class="fu">exprs</span>(AENDT) <span class="co"># apply a maximum date for the imputation</span></span>
<span id="cb13-135"><a href="#cb13-135"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-136"><a href="#cb13-136"></a>  <span class="fu">derive_vars_dy</span>(</span>
<span id="cb13-137"><a href="#cb13-137"></a>    <span class="at">reference_date =</span> TRTSDT,</span>
<span id="cb13-138"><a href="#cb13-138"></a>    <span class="at">source_vars =</span> <span class="fu">exprs</span>(ASTDT, AENDT)</span>
<span id="cb13-139"><a href="#cb13-139"></a>  )</span>
<span id="cb13-140"><a href="#cb13-140"></a><span class="in">```</span></span>
<span id="cb13-141"><a href="#cb13-141"></a></span>
<span id="cb13-142"><a href="#cb13-142"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb13-143"><a href="#cb13-143"></a><span class="fu">print_df</span>(adae <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, AESTDTC, ASTDT, ASTDTF, ASTDY, AEENDTC, AENDT, AENDTF, AENDY))</span>
<span id="cb13-144"><a href="#cb13-144"></a><span class="in">```</span></span>
<span id="cb13-145"><a href="#cb13-145"></a></span>
<span id="cb13-146"><a href="#cb13-146"></a><span class="fu">## Derive Duration {#anldur}</span></span>
<span id="cb13-147"><a href="#cb13-147"></a></span>
<span id="cb13-148"><a href="#cb13-148"></a>Now we have these date variables we can derive AE duration using the <span class="in">`admiral::derive_vars_duration()`</span> function.</span>
<span id="cb13-149"><a href="#cb13-149"></a>For this function the default is to + 1 day for the calculation, but this can be controlled with the <span class="in">`add_one`</span> argument.</span>
<span id="cb13-150"><a href="#cb13-150"></a></span>
<span id="cb13-153"><a href="#cb13-153"></a><span class="in">```{r}</span></span>
<span id="cb13-154"><a href="#cb13-154"></a><span class="co"># Derive ADURN/ADURU</span></span>
<span id="cb13-155"><a href="#cb13-155"></a>adae <span class="ot">&lt;-</span> adae <span class="sc">%&gt;%</span></span>
<span id="cb13-156"><a href="#cb13-156"></a>  <span class="fu">derive_vars_duration</span>(</span>
<span id="cb13-157"><a href="#cb13-157"></a>    <span class="at">new_var =</span> ADURN,</span>
<span id="cb13-158"><a href="#cb13-158"></a>    <span class="at">new_var_unit =</span> ADURU,</span>
<span id="cb13-159"><a href="#cb13-159"></a>    <span class="at">start_date =</span> ASTDT,</span>
<span id="cb13-160"><a href="#cb13-160"></a>    <span class="at">end_date =</span> AENDT</span>
<span id="cb13-161"><a href="#cb13-161"></a>  )</span>
<span id="cb13-162"><a href="#cb13-162"></a><span class="in">```</span></span>
<span id="cb13-163"><a href="#cb13-163"></a></span>
<span id="cb13-164"><a href="#cb13-164"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb13-165"><a href="#cb13-165"></a><span class="fu">print_df</span>(adae <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, ASTDT, AENDT, ADURN, ADURU))</span>
<span id="cb13-166"><a href="#cb13-166"></a><span class="in">```</span></span>
<span id="cb13-167"><a href="#cb13-167"></a></span>
<span id="cb13-168"><a href="#cb13-168"></a><span class="fu">## Derive Date of Last Dose {#exdates}</span></span>
<span id="cb13-169"><a href="#cb13-169"></a></span>
<span id="cb13-170"><a href="#cb13-170"></a>You might need to add some exposure information from <span class="in">`ex`</span> such as deriving the date of last dose before each AE.</span>
<span id="cb13-171"><a href="#cb13-171"></a></span>
<span id="cb13-172"><a href="#cb13-172"></a>In the below case we call this <span class="in">`LDOSEDT`</span> and we want to look only at exposure records with a valid dose or placebo.</span>
<span id="cb13-173"><a href="#cb13-173"></a>Here we use the <span class="in">`admiral::derive_vars_joined()`</span> function which enables more complex joins.</span>
<span id="cb13-174"><a href="#cb13-174"></a></span>
<span id="cb13-177"><a href="#cb13-177"></a><span class="in">```{r}</span></span>
<span id="cb13-178"><a href="#cb13-178"></a><span class="co"># Derive LDOSEDT</span></span>
<span id="cb13-179"><a href="#cb13-179"></a><span class="co"># In our ex data the EXDOSFRQ (frequency) is "QD" which stands for once daily</span></span>
<span id="cb13-180"><a href="#cb13-180"></a><span class="co"># If this was not the case then we would need to use the admiral::create_single_dose_dataset() function</span></span>
<span id="cb13-181"><a href="#cb13-181"></a><span class="co"># to generate single doses from aggregate dose information</span></span>
<span id="cb13-182"><a href="#cb13-182"></a><span class="co"># Refer to https://pharmaverse.github.io/admiral/reference/create_single_dose_dataset.html</span></span>
<span id="cb13-183"><a href="#cb13-183"></a>ex <span class="ot">&lt;-</span> ex <span class="sc">%&gt;%</span></span>
<span id="cb13-184"><a href="#cb13-184"></a>  <span class="fu">derive_vars_dt</span>(</span>
<span id="cb13-185"><a href="#cb13-185"></a>    <span class="at">dtc =</span> EXENDTC,</span>
<span id="cb13-186"><a href="#cb13-186"></a>    <span class="at">new_vars_prefix =</span> <span class="st">"EXEN"</span></span>
<span id="cb13-187"><a href="#cb13-187"></a>  )</span>
<span id="cb13-188"><a href="#cb13-188"></a></span>
<span id="cb13-189"><a href="#cb13-189"></a>adae <span class="ot">&lt;-</span> adae <span class="sc">%&gt;%</span></span>
<span id="cb13-190"><a href="#cb13-190"></a>  <span class="fu">derive_vars_joined</span>(</span>
<span id="cb13-191"><a href="#cb13-191"></a>    <span class="at">dataset_add =</span> ex,</span>
<span id="cb13-192"><a href="#cb13-192"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID),</span>
<span id="cb13-193"><a href="#cb13-193"></a>    <span class="at">order =</span> <span class="fu">exprs</span>(EXENDT),</span>
<span id="cb13-194"><a href="#cb13-194"></a>    <span class="at">new_vars =</span> <span class="fu">exprs</span>(<span class="at">LDOSEDT =</span> EXENDT),</span>
<span id="cb13-195"><a href="#cb13-195"></a>    <span class="at">join_vars =</span> <span class="fu">exprs</span>(EXENDT),</span>
<span id="cb13-196"><a href="#cb13-196"></a>    <span class="at">join_type =</span> <span class="st">"all"</span>,</span>
<span id="cb13-197"><a href="#cb13-197"></a>    <span class="at">filter_add =</span> (EXDOSE <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> (EXDOSE <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(EXTRT, <span class="st">"PLACEBO"</span>))) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(EXENDT),</span>
<span id="cb13-198"><a href="#cb13-198"></a>    <span class="at">filter_join =</span> EXENDT <span class="sc">&lt;=</span> ASTDT,</span>
<span id="cb13-199"><a href="#cb13-199"></a>    <span class="at">mode =</span> <span class="st">"last"</span></span>
<span id="cb13-200"><a href="#cb13-200"></a>  )</span>
<span id="cb13-201"><a href="#cb13-201"></a><span class="in">```</span></span>
<span id="cb13-202"><a href="#cb13-202"></a></span>
<span id="cb13-203"><a href="#cb13-203"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb13-204"><a href="#cb13-204"></a><span class="fu">print_df</span>(ex <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, EXTRT, EXDOSE, EXENDT))</span>
<span id="cb13-205"><a href="#cb13-205"></a><span class="in">```</span></span>
<span id="cb13-206"><a href="#cb13-206"></a></span>
<span id="cb13-207"><a href="#cb13-207"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb13-208"><a href="#cb13-208"></a><span class="fu">print_df</span>(adae <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, ASTDT, LDOSEDT))</span>
<span id="cb13-209"><a href="#cb13-209"></a><span class="in">```</span></span>
<span id="cb13-210"><a href="#cb13-210"></a></span>
<span id="cb13-211"><a href="#cb13-211"></a><span class="fu">## Derive Analysis Flags {#anlflags}</span></span>
<span id="cb13-212"><a href="#cb13-212"></a></span>
<span id="cb13-213"><a href="#cb13-213"></a>Next we looks at common analysis flags such as treatment emergent and on treatment flags using the <span class="in">`admiral::derive_var_trtemfl()`</span> and <span class="in">`admiral::derive_var_ontrtfl()`</span> functions.</span>
<span id="cb13-214"><a href="#cb13-214"></a>For the on-treatment flag we only want to include AEs occurring until 30 days after treatment end.</span>
<span id="cb13-215"><a href="#cb13-215"></a></span>
<span id="cb13-218"><a href="#cb13-218"></a><span class="in">```{r}</span></span>
<span id="cb13-219"><a href="#cb13-219"></a><span class="co"># Derive TRTEMFL and ONTRTFL</span></span>
<span id="cb13-220"><a href="#cb13-220"></a>adae <span class="ot">&lt;-</span> adae <span class="sc">%&gt;%</span></span>
<span id="cb13-221"><a href="#cb13-221"></a>  <span class="fu">derive_var_trtemfl</span>(</span>
<span id="cb13-222"><a href="#cb13-222"></a>    <span class="at">start_date =</span> ASTDT,</span>
<span id="cb13-223"><a href="#cb13-223"></a>    <span class="at">end_date =</span> AENDT,</span>
<span id="cb13-224"><a href="#cb13-224"></a>    <span class="at">trt_start_date =</span> TRTSDT,</span>
<span id="cb13-225"><a href="#cb13-225"></a>    <span class="at">trt_end_date =</span> TRTEDT</span>
<span id="cb13-226"><a href="#cb13-226"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-227"><a href="#cb13-227"></a>  <span class="fu">derive_var_ontrtfl</span>(</span>
<span id="cb13-228"><a href="#cb13-228"></a>    <span class="at">start_date =</span> ASTDT,</span>
<span id="cb13-229"><a href="#cb13-229"></a>    <span class="at">ref_start_date =</span> TRTSDT,</span>
<span id="cb13-230"><a href="#cb13-230"></a>    <span class="at">ref_end_date =</span> TRTEDT,</span>
<span id="cb13-231"><a href="#cb13-231"></a>    <span class="at">ref_end_window =</span> <span class="dv">30</span></span>
<span id="cb13-232"><a href="#cb13-232"></a>  )</span>
<span id="cb13-233"><a href="#cb13-233"></a><span class="in">```</span></span>
<span id="cb13-234"><a href="#cb13-234"></a></span>
<span id="cb13-235"><a href="#cb13-235"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb13-236"><a href="#cb13-236"></a><span class="fu">print_df</span>(adae <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, ASTDT, TRTSDT, TRTEDT, TRTEMFL, ONTRTFL))</span>
<span id="cb13-237"><a href="#cb13-237"></a><span class="in">```</span></span>
<span id="cb13-238"><a href="#cb13-238"></a></span>
<span id="cb13-239"><a href="#cb13-239"></a>At first these 2 functions may appear similar but both offer extra specific arguments for</span>
<span id="cb13-240"><a href="#cb13-240"></a>flexibility if you needed to apply more complex analysis rules to these derivations. For example, for</span>
<span id="cb13-241"><a href="#cb13-241"></a>treatment emergent you could use the intensity arguments if you also wanted to flag those AEs</span>
<span id="cb13-242"><a href="#cb13-242"></a>starting before treatment start and ending after treatment start with worsened intensity</span>
<span id="cb13-243"><a href="#cb13-243"></a>(i.e. the most extreme intensity is greater than the initial intensity).</span>
<span id="cb13-244"><a href="#cb13-244"></a></span>
<span id="cb13-245"><a href="#cb13-245"></a><span class="fu">## Derive Occurrence Flags {#occflags}</span></span>
<span id="cb13-246"><a href="#cb13-246"></a></span>
<span id="cb13-247"><a href="#cb13-247"></a>There can be flags that need to be derived based on AE occurrences, such as flagging the first occurrence of maximum severity per patient which in the below example we call <span class="in">`AOCCIFL`</span>.</span>
<span id="cb13-248"><a href="#cb13-248"></a>Here we use the <span class="in">`admiral::derive_var_extreme_flag()`</span> function.</span>
<span id="cb13-249"><a href="#cb13-249"></a></span>
<span id="cb13-252"><a href="#cb13-252"></a><span class="in">```{r}</span></span>
<span id="cb13-253"><a href="#cb13-253"></a><span class="co"># Derive AOCCIFL</span></span>
<span id="cb13-254"><a href="#cb13-254"></a>adae <span class="ot">&lt;-</span> adae <span class="sc">%&gt;%</span></span>
<span id="cb13-255"><a href="#cb13-255"></a>  <span class="co"># create temporary numeric ASEVN for sorting purpose</span></span>
<span id="cb13-256"><a href="#cb13-256"></a>  <span class="fu">mutate</span>(<span class="at">TEMP_AESEVN =</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(AESEV, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"SEVERE"</span>, <span class="st">"MODERATE"</span>, <span class="st">"MILD"</span>)))) <span class="sc">%&gt;%</span></span>
<span id="cb13-257"><a href="#cb13-257"></a>  <span class="fu">derive_var_extreme_flag</span>(</span>
<span id="cb13-258"><a href="#cb13-258"></a>    <span class="at">new_var =</span> AOCCIFL,</span>
<span id="cb13-259"><a href="#cb13-259"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID),</span>
<span id="cb13-260"><a href="#cb13-260"></a>    <span class="at">order =</span> <span class="fu">exprs</span>(TEMP_AESEVN, ASTDT, AESEQ),</span>
<span id="cb13-261"><a href="#cb13-261"></a>    <span class="at">mode =</span> <span class="st">"first"</span></span>
<span id="cb13-262"><a href="#cb13-262"></a>  )</span>
<span id="cb13-263"><a href="#cb13-263"></a><span class="in">```</span></span>
<span id="cb13-264"><a href="#cb13-264"></a></span>
<span id="cb13-265"><a href="#cb13-265"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb13-266"><a href="#cb13-266"></a><span class="fu">print_df</span>(adae <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, ASTDT, AESEQ, AESEV, AOCCIFL))</span>
<span id="cb13-267"><a href="#cb13-267"></a><span class="in">```</span></span>
<span id="cb13-268"><a href="#cb13-268"></a></span>
<span id="cb13-269"><a href="#cb13-269"></a><span class="fu">## Derive Query Variables {#query}</span></span>
<span id="cb13-270"><a href="#cb13-270"></a></span>
<span id="cb13-271"><a href="#cb13-271"></a>The final set of derived flags would be around those checking for queries/baskets of AE terms, e.g. using Standardized MedDRA Queries (SMQs) or Custom Queries (CQs). </span>
<span id="cb13-272"><a href="#cb13-272"></a></span>
<span id="cb13-273"><a href="#cb13-273"></a>Before reading this section, you should read the <span class="co">[</span><span class="ot">Queries Dataset Vignette</span><span class="co">](https://pharmaverse.github.io/admiral/articles/queries_dataset.html)</span> from <span class="in">`{admiral}`</span>.</span>
<span id="cb13-274"><a href="#cb13-274"></a></span>
<span id="cb13-275"><a href="#cb13-275"></a>On a study you would need to create your own version of this queries dataset with the AE queries you need, but for the purpose of this article we use the example provided as part of <span class="in">`{admiral}`</span> and we filter it to just one CQ and one SMQ.</span>
<span id="cb13-276"><a href="#cb13-276"></a>Then you can derive the required variables using the <span class="in">`admiral::derive_vars_query()`</span> function.</span>
<span id="cb13-277"><a href="#cb13-277"></a></span>
<span id="cb13-280"><a href="#cb13-280"></a><span class="in">```{r}</span></span>
<span id="cb13-281"><a href="#cb13-281"></a>queries <span class="ot">&lt;-</span> admiral<span class="sc">::</span>queries <span class="sc">%&gt;%</span></span>
<span id="cb13-282"><a href="#cb13-282"></a>  <span class="fu">filter</span>(PREFIX <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CQ01"</span>, <span class="st">"SMQ02"</span>))</span>
<span id="cb13-283"><a href="#cb13-283"></a><span class="in">```</span></span>
<span id="cb13-284"><a href="#cb13-284"></a></span>
<span id="cb13-285"><a href="#cb13-285"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb13-286"><a href="#cb13-286"></a><span class="fu">print_df</span>(queries)</span>
<span id="cb13-287"><a href="#cb13-287"></a><span class="in">```</span></span>
<span id="cb13-288"><a href="#cb13-288"></a></span>
<span id="cb13-291"><a href="#cb13-291"></a><span class="in">```{r}</span></span>
<span id="cb13-292"><a href="#cb13-292"></a><span class="co"># Derive CQ01NAM and SMQ02NAM</span></span>
<span id="cb13-293"><a href="#cb13-293"></a>adae <span class="ot">&lt;-</span> adae <span class="sc">%&gt;%</span></span>
<span id="cb13-294"><a href="#cb13-294"></a>  <span class="fu">derive_vars_query</span>(<span class="at">dataset_queries =</span> queries)</span>
<span id="cb13-295"><a href="#cb13-295"></a><span class="in">```</span></span>
<span id="cb13-296"><a href="#cb13-296"></a></span>
<span id="cb13-297"><a href="#cb13-297"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb13-298"><a href="#cb13-298"></a><span class="fu">print_df</span>(adae <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, AEDECOD, CQ01NAM, SMQ02NAM))</span>
<span id="cb13-299"><a href="#cb13-299"></a><span class="in">```</span></span>
<span id="cb13-300"><a href="#cb13-300"></a></span>
<span id="cb13-301"><a href="#cb13-301"></a><span class="fu">## Add ADSL Variables {#adsladd}</span></span>
<span id="cb13-302"><a href="#cb13-302"></a></span>
<span id="cb13-303"><a href="#cb13-303"></a>If needed, the other <span class="in">`ADSL`</span> variables can now be added.</span>
<span id="cb13-304"><a href="#cb13-304"></a>List of ADSL variables already merged held in vector <span class="in">`adsl_vars`</span>.</span>
<span id="cb13-305"><a href="#cb13-305"></a></span>
<span id="cb13-306"><a href="#cb13-306"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb13-307"><a href="#cb13-307"></a>adae <span class="ot">&lt;-</span> adae <span class="sc">%&gt;%</span></span>
<span id="cb13-308"><a href="#cb13-308"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb13-309"><a href="#cb13-309"></a>    <span class="at">dataset_add =</span> <span class="fu">select</span>(adsl, <span class="sc">!!!</span><span class="fu">negate_vars</span>(adsl_vars)),</span>
<span id="cb13-310"><a href="#cb13-310"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID)</span>
<span id="cb13-311"><a href="#cb13-311"></a>  )</span>
<span id="cb13-312"><a href="#cb13-312"></a><span class="in">```</span></span>
<span id="cb13-313"><a href="#cb13-313"></a></span>
<span id="cb13-314"><a href="#cb13-314"></a><span class="fu"># Apply Metadata to Create an eSub XPT and Perform Associated Checks {#metacore_xportr}</span></span>
<span id="cb13-315"><a href="#cb13-315"></a></span>
<span id="cb13-316"><a href="#cb13-316"></a>We use <span class="in">`{metatools}`</span> and <span class="in">`{xportr}`</span> to perform checks, apply metadata such as types, lengths, labels, and write the dataset to an XPT file.</span>
<span id="cb13-317"><a href="#cb13-317"></a></span>
<span id="cb13-318"><a href="#cb13-318"></a><span class="in">```{r checks, warning=FALSE, message=FALSE}</span></span>
<span id="cb13-319"><a href="#cb13-319"></a>dir <span class="ot">&lt;-</span> <span class="fu">tempdir</span>() <span class="co"># Specify the directory for saving the XPT file</span></span>
<span id="cb13-320"><a href="#cb13-320"></a></span>
<span id="cb13-321"><a href="#cb13-321"></a>adae <span class="sc">%&gt;%</span></span>
<span id="cb13-322"><a href="#cb13-322"></a>  <span class="fu">drop_unspec_vars</span>(metacore) <span class="sc">%&gt;%</span> <span class="co"># Drop unspecified variables from specs</span></span>
<span id="cb13-323"><a href="#cb13-323"></a>  <span class="fu">check_variables</span>(metacore) <span class="sc">%&gt;%</span> <span class="co"># Check all variables specified are present and no more</span></span>
<span id="cb13-324"><a href="#cb13-324"></a>  <span class="fu">check_ct_data</span>(metacore, <span class="at">na_acceptable =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="co"># Checks all variables with CT only contain values within the CT</span></span>
<span id="cb13-325"><a href="#cb13-325"></a>  <span class="fu">order_cols</span>(metacore) <span class="sc">%&gt;%</span> <span class="co"># Orders the columns according to the spec</span></span>
<span id="cb13-326"><a href="#cb13-326"></a>  <span class="fu">sort_by_key</span>(metacore) <span class="sc">%&gt;%</span> <span class="co"># Sorts the rows by the sort keys</span></span>
<span id="cb13-327"><a href="#cb13-327"></a>  <span class="fu">xportr_type</span>(metacore, <span class="at">domain =</span> <span class="st">"ADAE"</span>) <span class="sc">%&gt;%</span> <span class="co"># Coerce variable type to match spec</span></span>
<span id="cb13-328"><a href="#cb13-328"></a>  <span class="fu">xportr_length</span>(metacore) <span class="sc">%&gt;%</span> <span class="co"># Assigns SAS length from a variable level metadata</span></span>
<span id="cb13-329"><a href="#cb13-329"></a>  <span class="fu">xportr_label</span>(metacore) <span class="sc">%&gt;%</span> <span class="co"># Assigns variable label from metacore specifications</span></span>
<span id="cb13-330"><a href="#cb13-330"></a>  <span class="fu">xportr_df_label</span>(metacore) <span class="sc">%&gt;%</span>  <span class="co"># Assigns dataset label from metacore specifications</span></span>
<span id="cb13-331"><a href="#cb13-331"></a>  <span class="fu">xportr_write</span>(<span class="fu">file.path</span>(dir, <span class="st">"adae.xpt"</span>), <span class="at">metadata =</span> metacore, <span class="at">domain =</span> <span class="st">"ADAE"</span>)</span>
<span id="cb13-332"><a href="#cb13-332"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>