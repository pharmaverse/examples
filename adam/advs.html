<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ADVS – pharmaverse examples</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../adam/adae.html" rel="next">
<link href="../adam/adtte.html" rel="prev">
<link href="../assets/img/Pharmaverse_examples.png" rel="icon" type="image/png">
<script src="../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-748b535e376f14d4692bf2b2e5fd6380.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-01aaa65abc2be12fb1e6ec0acd95931a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-974917195b3754385d623b0dbdbea424.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-01aaa65abc2be12fb1e6ec0acd95931a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en-US"
  });
});
</script> 
  
<style>html{ scroll-behavior: smooth; }</style>
<script src="../site_libs/core-js-2.5.3/shim.min.js"></script>
<script src="../site_libs/react-18.2.0/react.min.js"></script>
<script src="../site_libs/react-18.2.0/react-dom.min.js"></script>
<script src="../site_libs/reactwidget-2.0.0/react-tools.js"></script>
<link href="../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="../site_libs/reactable-0.4.4/reactable.css" rel="stylesheet">
<script src="../site_libs/reactable-binding-0.4.4/reactable.js"></script>


<link rel="stylesheet" href="../assets/css/style.scss">
<meta property="og:title" content="ADVS – pharmaverse examples">
<meta property="og:description" content="">
<meta property="og:image" content="https://pharmaverse.github.io/examples/adam/assets/img/Pharmaverse_examples.png">
<meta property="og:site_name" content="pharmaverse examples">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">pharmaverse examples</span>
    </a>
  </div>
          <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://pharmaverse.github.io/examples/"> <i class="bi bi-house" role="img" aria-label="pharmaverse">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://app.slack.com/client/T028PB489D3/"> <i class="bi bi-slack" role="img" aria-label="Slack">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pharmaverse/examples"> <i class="bi bi-github" role="img" aria-label="Repository">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
            <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../adam/adsl.html">ADaM</a></li><li class="breadcrumb-item"><a href="../adam/advs.html">ADVS</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../assets/img/Pharmaverse_examples.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">SDTM</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sdtm/examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SDTM Examples</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">ADaM</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../adam/adsl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ADSL</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../adam/adpc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ADPC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../adam/adppk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ADPPK</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../adam/adrs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ADRS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../adam/adtte.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ADTTE</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../adam/advs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">ADVS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../adam/adae.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ADAE</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">TLG</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tlg/demographic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Demographic Table</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tlg/adverse_events.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Adverse Events</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Interactive</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../interactive/teal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>teal</code> applications</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Logs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../logging/logging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Difference Between <code>logr</code> And <code>logrx</code></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../session.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Info</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://pharmaverse.org/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pharmaverse Home</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../adam/adsl.html">ADaM</a></li><li class="breadcrumb-item"><a href="../adam/advs.html">ADVS</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">ADVS</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i></button></div></div>
</div>



<div class="quarto-title-meta column-page-right">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This article provides a step-by-step explanation for creating an ADaM <code>ADVS</code> (Vital Signs) dataset using key pharmaverse packages along with tidyverse components.</p>
<p>For the purpose of this example, we will use the <code>ADSL</code> dataset from <code>{pharmaverseadam}</code> and <code>vs</code> domain from <code>{pharmaversesdtm}</code>.</p>
<section id="programming-flow" class="level2">
<h2 class="anchored" data-anchor-id="programming-flow">Programming Flow</h2>
<ul>
<li><a href="#loaddata">Load Data and Required pharmaverse Packages</a></li>
<li><a href="#loadspecs">Load Specifications for Metacore</a></li>
<li><a href="#adslvars">Select ADSL Variables</a></li>
<li><a href="#startbuild">Start Building Derivations</a></li>
<li><a href="#paramvars">Assign <code>PARAMCD</code>, <code>PARAM</code>, <code>PARAMN</code></a></li>
<li><a href="#avalvars">Derive Results and Units (<code>AVAL</code>, <code>AVALU</code>)</a></li>
<li><a href="#addparams">Derive Additional Parameters (e.g.&nbsp;<code>MAP</code>, <code>BMI</code> or <code>BSA</code> for <code>ADVS</code>)</a></li>
<li><a href="#timingvars">Derive Timing Variables (e.g.&nbsp;<code>AVISIT</code>, <code>ATPT</code>, <code>ATPTN</code>)</a></li>
<li><a href="#summaryrec">Derive summary records (e.g.&nbsp;mean of the triplicates at each time point)</a></li>
<li><a href="#ontrtfl">Timing Flag Variables (e.g.&nbsp;<code>ONTRTFL</code>)</a></li>
<li><a href="#rangeind">Assign Reference Range Indicator (<code>ANRIND</code>)</a></li>
<li><a href="#baselinevars">Derive Baseline (<code>BASETYPE</code>, <code>ABLFL</code>, <code>BASE</code>, <code>BNRIND</code>)</a></li>
<li><a href="#chgpchg">Derive Change from Baseline (<code>CHG</code>, <code>PCHG</code>)</a></li>
<li><a href="#anl01fl">Derive Analysis Flags (e.g.&nbsp;<code>ANL01FL</code>)</a></li>
<li><a href="#treatmentvars">Assign Treatment (<code>TRTA</code>, <code>TRTP</code>)</a></li>
<li><a href="#aseq">Assign <code>ASEQ</code></a></li>
<li><a href="#categorizationvars">Derive Categorization Variables (<code>AVALCATy</code>)</a></li>
<li><a href="#paramval">Assign Parameter Level Values (<code>PARAM</code>, <code>PARAMN</code>)</a></li>
<li><a href="#addadsl">Add ADSL variables</a></li>
<li><a href="#metacore_xportr">Apply Metadata and eSub Checks</a></li>
</ul>
</section>
</section>
<section id="loaddata" class="level1">
<h1>Load Data and Required pharmaverse Packages</h1>
<p>First we will load the packages required for our project. We will use <code>{admiral}</code> for the creation of analysis data. <code>{admiral}</code> requires <code>{dplyr}</code>, <code>{lubridate}</code> and <code>{stringr}</code>. Find <code>{admiral}</code> functions and related variables by searching <a href="https://pharmaverse.github.io/admiraldiscovery/articles/reactable.html">admiraldiscovery</a>. We will use <code>{metacore}</code> and <code>{metatools}</code> to store and manipulate metadata from our specifications. We will use <code>{xportr}</code> to perform checks on the final data and export to a transport file.</p>
<p>Then we will load our input data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(metacore)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(metatools)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(pharmaversesdtm)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(admiral)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(xportr)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co"># Read in input data</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>adsl <span class="ot">&lt;-</span> pharmaverseadam<span class="sc">::</span>adsl</span>
<span id="cb1-13"><a href="#cb1-13"></a>vs <span class="ot">&lt;-</span> pharmaversesdtm<span class="sc">::</span>vs</span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a>vs <span class="ot">&lt;-</span> <span class="fu">convert_blanks_to_na</span>(vs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loadspecs" class="level1">
<h1>Load Specifications for Metacore</h1>
<p>We have saved our specifications in an Excel file and will load them into <code>{metacore}</code> with the <code>metacore::spec_to_metacore()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># ---- Load Specs for Metacore ----</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>metacore <span class="ot">&lt;-</span> <span class="fu">spec_to_metacore</span>(</span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="at">path =</span> <span class="st">"./metadata/safety_specs.xlsx"</span>,</span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="co"># All datasets are described in the same sheet</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="at">where_sep_sheet =</span> <span class="cn">FALSE</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="fu">select_dataset</span>(<span class="st">"ADVS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adslvars" class="level1">
<h1>Select ADSL Variables</h1>
<p>Some variables from the <code>ADSL</code> dataset required for the derivations are merged into the <code>VS</code> domain using the <code>admiral::derive_vars_merged()</code> function. The rest of the relevant <code>ADSL</code> variables would be added later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Select required ADSL variables</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>adsl_vars <span class="ot">&lt;-</span> <span class="fu">exprs</span>(TRTSDT, TRTEDT, TRT01A, TRT01P)</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co"># Join ADSL variables with VS</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>advs <span class="ot">&lt;-</span> vs <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb3-7"><a href="#cb3-7"></a>    <span class="at">dataset_add =</span> adsl,</span>
<span id="cb3-8"><a href="#cb3-8"></a>    <span class="at">new_vars =</span> adsl_vars,</span>
<span id="cb3-9"><a href="#cb3-9"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID)</span>
<span id="cb3-10"><a href="#cb3-10"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-e44227343ac0a7b4c44b" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e44227343ac0a7b4c44b">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"STUDYID":["CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01"],"DOMAIN":["VS","VS","VS","VS","VS","VS","VS","VS","VS","VS"],"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015"],"VSSEQ":[1,2,3,4,5,6,7,8,9,10],"VSTESTCD":["DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP"],"VSTEST":["Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure"],"VSPOS":["SUPINE","STANDING","STANDING","SUPINE","STANDING","STANDING","SUPINE","STANDING","STANDING","SUPINE"],"VSORRES":["64","83","57","68","59","71","56","51","61","67"],"VSORRESU":["mmHg","mmHg","mmHg","mmHg","mmHg","mmHg","mmHg","mmHg","mmHg","mmHg"],"VSSTRESC":["64","83","57","68","59","71","56","51","61","67"],"VSSTRESN":[64,83,57,68,59,71,56,51,61,67],"VSSTRESU":["mmHg","mmHg","mmHg","mmHg","mmHg","mmHg","mmHg","mmHg","mmHg","mmHg"],"VSSTAT":[null,null,null,null,null,null,null,null,null,null],"VSLOC":[null,null,null,null,null,null,null,null,null,null],"VSBLFL":[null,null,null,null,null,null,"Y","Y","Y",null],"VISITNUM":[1,1,1,2,2,2,3,3,3,3.5],"VISIT":["SCREENING 1","SCREENING 1","SCREENING 1","SCREENING 2","SCREENING 2","SCREENING 2","BASELINE","BASELINE","BASELINE","AMBUL ECG PLACEMENT"],"VISITDY":[-7,-7,-7,-1,-1,-1,1,1,1,13],"VSDTC":["2013-12-26","2013-12-26","2013-12-26","2013-12-31","2013-12-31","2013-12-31","2014-01-02","2014-01-02","2014-01-02","2014-01-14"],"VSDY":[-7,-7,-7,-2,-2,-2,1,1,1,13],"VSTPT":["AFTER LYING DOWN FOR 5 MINUTES","AFTER STANDING FOR 1 MINUTE","AFTER STANDING FOR 3 MINUTES","AFTER LYING DOWN FOR 5 MINUTES","AFTER STANDING FOR 1 MINUTE","AFTER STANDING FOR 3 MINUTES","AFTER LYING DOWN FOR 5 MINUTES","AFTER STANDING FOR 1 MINUTE","AFTER STANDING FOR 3 MINUTES","AFTER LYING DOWN FOR 5 MINUTES"],"VSTPTNUM":[815,816,817,815,816,817,815,816,817,815],"VSELTM":["PT5M","PT1M","PT3M","PT5M","PT1M","PT3M","PT5M","PT1M","PT3M","PT5M"],"VSTPTREF":["PATIENT SUPINE","PATIENT STANDING","PATIENT STANDING","PATIENT SUPINE","PATIENT STANDING","PATIENT STANDING","PATIENT SUPINE","PATIENT STANDING","PATIENT STANDING","PATIENT SUPINE"],"TRTSDT":["2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02"],"TRTEDT":["2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02"],"TRT01A":["Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo"],"TRT01P":["Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo"]},"columns":[{"id":"STUDYID","name":"STUDYID","type":"character"},{"id":"DOMAIN","name":"DOMAIN","type":"character"},{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"VSSEQ","name":"VSSEQ","type":"numeric"},{"id":"VSTESTCD","name":"VSTESTCD","type":"character"},{"id":"VSTEST","name":"VSTEST","type":"character"},{"id":"VSPOS","name":"VSPOS","type":"character"},{"id":"VSORRES","name":"VSORRES","type":"character"},{"id":"VSORRESU","name":"VSORRESU","type":"character"},{"id":"VSSTRESC","name":"VSSTRESC","type":"character"},{"id":"VSSTRESN","name":"VSSTRESN","type":"numeric"},{"id":"VSSTRESU","name":"VSSTRESU","type":"character"},{"id":"VSSTAT","name":"VSSTAT","type":"character"},{"id":"VSLOC","name":"VSLOC","type":"character"},{"id":"VSBLFL","name":"VSBLFL","type":"character"},{"id":"VISITNUM","name":"VISITNUM","type":"numeric"},{"id":"VISIT","name":"VISIT","type":"character"},{"id":"VISITDY","name":"VISITDY","type":"numeric"},{"id":"VSDTC","name":"VSDTC","type":"character"},{"id":"VSDY","name":"VSDY","type":"numeric"},{"id":"VSTPT","name":"VSTPT","type":"character"},{"id":"VSTPTNUM","name":"VSTPTNUM","type":"numeric"},{"id":"VSELTM","name":"VSELTM","type":"character"},{"id":"VSTPTREF","name":"VSTPTREF","type":"character"},{"id":"TRTSDT","name":"TRTSDT","type":"Date"},{"id":"TRTEDT","name":"TRTEDT","type":"Date"},{"id":"TRT01A","name":"TRT01A","type":"character"},{"id":"TRT01P","name":"TRT01P","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"7e432ed47212a20a0ff2d6182cbe066d"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="startbuild" class="level1">
<h1>Start Building Derivations</h1>
<p>The first derivation step we are going to do is to compute the Analysis Date and Relative Analysis Day with the variables merged from <code>ADSL</code> dataset. The resulting dataset has the 2 columns created.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Calculate ADT, ADY</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">derive_vars_dt</span>(</span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="at">new_vars_prefix =</span> <span class="st">"A"</span>,</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="at">dtc =</span> VSDTC,</span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="co"># Below arguments are default values and not necessary to add in our case</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>    <span class="at">highest_imputation =</span> <span class="st">"n"</span>, <span class="co"># means no imputation is performed on partial/missing dates</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="at">flag_imputation =</span> <span class="st">"auto"</span> <span class="co"># To automatically create ADTF variable when highest_imputation is "Y", "M" or "D"</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>  <span class="fu">derive_vars_dy</span>(</span>
<span id="cb4-11"><a href="#cb4-11"></a>    <span class="at">reference_date =</span> TRTSDT,</span>
<span id="cb4-12"><a href="#cb4-12"></a>    <span class="at">source_vars =</span> <span class="fu">exprs</span>(ADT)</span>
<span id="cb4-13"><a href="#cb4-13"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-a64b94e5d26a513d0c6a" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a64b94e5d26a513d0c6a">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"STUDYID":["CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01"],"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015"],"VISIT":["SCREENING 1","SCREENING 1","SCREENING 1","SCREENING 2","SCREENING 2","SCREENING 2","BASELINE","BASELINE","BASELINE","AMBUL ECG PLACEMENT"],"VISITNUM":[1,1,1,2,2,2,3,3,3,3.5],"VSTESTCD":["DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP"],"VSTEST":["Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure"],"VSDTC":["2013-12-26","2013-12-26","2013-12-26","2013-12-31","2013-12-31","2013-12-31","2014-01-02","2014-01-02","2014-01-02","2014-01-14"],"TRTSDT":["2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02"],"TRTEDT":["2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02"],"TRT01A":["Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo"],"TRT01P":["Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo"],"ADT":["2013-12-26","2013-12-26","2013-12-26","2013-12-31","2013-12-31","2013-12-31","2014-01-02","2014-01-02","2014-01-02","2014-01-14"],"ADY":[-7,-7,-7,-2,-2,-2,1,1,1,13]},"columns":[{"id":"STUDYID","name":"STUDYID","type":"character"},{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"VISIT","name":"VISIT","type":"character"},{"id":"VISITNUM","name":"VISITNUM","type":"numeric"},{"id":"VSTESTCD","name":"VSTESTCD","type":"character"},{"id":"VSTEST","name":"VSTEST","type":"character"},{"id":"VSDTC","name":"VSDTC","type":"character"},{"id":"TRTSDT","name":"TRTSDT","type":"Date"},{"id":"TRTEDT","name":"TRTEDT","type":"Date"},{"id":"TRT01A","name":"TRT01A","type":"character"},{"id":"TRT01P","name":"TRT01P","type":"character"},{"id":"ADT","name":"ADT","type":"Date"},{"id":"ADY","name":"ADY","type":"numeric"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"220a21462becebf83c066e9a0c716757"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<section id="paramvars" class="level2">
<h2 class="anchored" data-anchor-id="paramvars">Assign <code>PARAMCD</code>, <code>PARAM</code>, <code>PARAMN</code></h2>
<p>To assign parameter level values such as <code>PARAMCD</code>, <code>PARAM</code>, <code>PARAMN</code>, etc., a lookup can be created to join to the source data.</p>
<p>For example, when creating <code>ADVS</code>, a lookup based on the SDTM <code>--TESTCD</code> value may be created:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><code>VSTESTCD</code></th>
<th><code>PARAMCD</code></th>
<th><code>PARAM</code></th>
<th><code>PARAMN</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SYSBP</td>
<td>SYSBP</td>
<td>Systolic Blood Pressure (mmHg)</td>
<td>1</td>
</tr>
<tr class="even">
<td>DIABP</td>
<td>DIABP</td>
<td>Diastolic Blood Pressure (mmHg)</td>
<td>2</td>
</tr>
<tr class="odd">
<td>PULSE</td>
<td>PULSE</td>
<td>Pulse Rate (beats/min)</td>
<td>3</td>
</tr>
<tr class="even">
<td>WEIGHT</td>
<td>WEIGHT</td>
<td>Weight (kg)</td>
<td>4</td>
</tr>
<tr class="odd">
<td>HEIGHT</td>
<td>HEIGHT</td>
<td>Height (cm)</td>
<td>5</td>
</tr>
<tr class="even">
<td>TEMP</td>
<td>TEMP</td>
<td>Temperature (C)</td>
<td>6</td>
</tr>
<tr class="odd">
<td>MAP</td>
<td>MAP</td>
<td>Mean Arterial Pressure</td>
<td>7</td>
</tr>
<tr class="even">
<td>BMI</td>
<td>BMI</td>
<td>Body Mass Index(kg/m^2)</td>
<td>8</td>
</tr>
<tr class="odd">
<td>BSA</td>
<td>BSA</td>
<td>Body Surface Area(m^2)</td>
<td>9</td>
</tr>
</tbody>
</table>
<p>This lookup may now be joined to the source data:</p>
<p>At this stage, only <code>PARAMCD</code> is required to perform the derivations. Additional derived parameters may be added, so only <code>PARAMCD</code> is joined to the datasets at this point. All other variables related to <code>PARAMCD</code> (e.g.&nbsp;<code>PARAM</code>, <code>PARAMN</code>, …) will be added when all <code>PARAMCD</code> are derived.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="co"># Add PARAMCD only - add PARAM etc later</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">derive_vars_merged_lookup</span>(</span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span class="at">dataset_add =</span> param_lookup,</span>
<span id="cb5-5"><a href="#cb5-5"></a>    <span class="at">new_vars =</span> <span class="fu">exprs</span>(PARAMCD),</span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(VSTESTCD),</span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="co"># Below arguments are default values and not necessary to add in our case</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>    <span class="at">print_not_mapped =</span> <span class="cn">TRUE</span> <span class="co"># Printing whether some parameters are not mapped</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>All `VSTESTCD` are mapped.</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-e86f98ae1063aa3362ae" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e86f98ae1063aa3362ae">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"STUDYID":["CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01"],"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015"],"VISIT":["SCREENING 1","SCREENING 1","SCREENING 1","SCREENING 2","SCREENING 2","SCREENING 2","BASELINE","BASELINE","BASELINE","AMBUL ECG PLACEMENT"],"VISITNUM":[1,1,1,2,2,2,3,3,3,3.5],"VSTESTCD":["DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP"],"VSTEST":["Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure"],"VSDTC":["2013-12-26","2013-12-26","2013-12-26","2013-12-31","2013-12-31","2013-12-31","2014-01-02","2014-01-02","2014-01-02","2014-01-14"],"TRTSDT":["2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02"],"TRTEDT":["2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02"],"TRT01A":["Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo"],"TRT01P":["Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo"],"ADT":["2013-12-26","2013-12-26","2013-12-26","2013-12-31","2013-12-31","2013-12-31","2014-01-02","2014-01-02","2014-01-02","2014-01-14"],"ADY":[-7,-7,-7,-2,-2,-2,1,1,1,13],"PARAMCD":["DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP"]},"columns":[{"id":"STUDYID","name":"STUDYID","type":"character"},{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"VISIT","name":"VISIT","type":"character"},{"id":"VISITNUM","name":"VISITNUM","type":"numeric"},{"id":"VSTESTCD","name":"VSTESTCD","type":"character"},{"id":"VSTEST","name":"VSTEST","type":"character"},{"id":"VSDTC","name":"VSDTC","type":"character"},{"id":"TRTSDT","name":"TRTSDT","type":"Date"},{"id":"TRTEDT","name":"TRTEDT","type":"Date"},{"id":"TRT01A","name":"TRT01A","type":"character"},{"id":"TRT01P","name":"TRT01P","type":"character"},{"id":"ADT","name":"ADT","type":"Date"},{"id":"ADY","name":"ADY","type":"numeric"},{"id":"PARAMCD","name":"PARAMCD","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"3699671d545fab7834e7b8ddccc58c93"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="avalvars" class="level2">
<h2 class="anchored" data-anchor-id="avalvars">Derive Results and Units (<code>AVAL</code>, <code>AVALU</code>)</h2>
<p>The mapping of <code>AVAL</code> and <code>AVALU</code> is left to the ADaM programmer. An example mapping may be:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="at">AVAL =</span> VSSTRESN,</span>
<span id="cb7-4"><a href="#cb7-4"></a>    <span class="at">AVALU =</span> VSSTRESU</span>
<span id="cb7-5"><a href="#cb7-5"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-9dc9d94aeaa67b049435" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9dc9d94aeaa67b049435">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"STUDYID":["CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01"],"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015"],"VISIT":["SCREENING 1","SCREENING 1","SCREENING 1","SCREENING 2","SCREENING 2","SCREENING 2","BASELINE","BASELINE","BASELINE","AMBUL ECG PLACEMENT"],"VISITNUM":[1,1,1,2,2,2,3,3,3,3.5],"VSTESTCD":["DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP"],"VSTEST":["Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure","Diastolic Blood Pressure"],"VSDTC":["2013-12-26","2013-12-26","2013-12-26","2013-12-31","2013-12-31","2013-12-31","2014-01-02","2014-01-02","2014-01-02","2014-01-14"],"TRTSDT":["2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02"],"TRTEDT":["2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02"],"TRT01A":["Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo"],"TRT01P":["Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo","Placebo"],"ADT":["2013-12-26","2013-12-26","2013-12-26","2013-12-31","2013-12-31","2013-12-31","2014-01-02","2014-01-02","2014-01-02","2014-01-14"],"ADY":[-7,-7,-7,-2,-2,-2,1,1,1,13],"PARAMCD":["DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP"],"AVAL":[64,83,57,68,59,71,56,51,61,67],"AVALU":["mmHg","mmHg","mmHg","mmHg","mmHg","mmHg","mmHg","mmHg","mmHg","mmHg"]},"columns":[{"id":"STUDYID","name":"STUDYID","type":"character"},{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"VISIT","name":"VISIT","type":"character"},{"id":"VISITNUM","name":"VISITNUM","type":"numeric"},{"id":"VSTESTCD","name":"VSTESTCD","type":"character"},{"id":"VSTEST","name":"VSTEST","type":"character"},{"id":"VSDTC","name":"VSDTC","type":"character"},{"id":"TRTSDT","name":"TRTSDT","type":"Date"},{"id":"TRTEDT","name":"TRTEDT","type":"Date"},{"id":"TRT01A","name":"TRT01A","type":"character"},{"id":"TRT01P","name":"TRT01P","type":"character"},{"id":"ADT","name":"ADT","type":"Date"},{"id":"ADY","name":"ADY","type":"numeric"},{"id":"PARAMCD","name":"PARAMCD","type":"character"},{"id":"AVAL","name":"AVAL","type":"numeric"},{"id":"AVALU","name":"AVALU","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"3e383421eec67c73f5e991ac95434707"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>In this example, as is often the case for ADVS, all <code>AVAL</code> values are numeric without any corresponding non-redundant text value for <code>AVALC</code>. Per recommendation in ADaMIG v1.3 we do not map <code>AVALC</code>.</p>
</section>
<section id="addparams" class="level2">
<h2 class="anchored" data-anchor-id="addparams">Derive Additional Parameters (e.g.&nbsp;<code>MAP</code>, <code>BMI</code> or <code>BSA</code> for <code>ADVS</code>)</h2>
<p>Optionally derive new parameters creating <code>PARAMCD</code> and <code>AVAL</code>. Note that only variables specified in the <code>by_vars</code> argument will be populated in the newly created records. This is relevant to the functions <code>admiral::derive_param_map</code>, <code>admiral::derive_param_bsa</code>, <code>admiral::derive_param_bmi</code>, and <code>admiral::derive_param_qtc</code>.</p>
<p>Below is an example of creating <code>Mean Arterial Pressure</code> for <code>ADVS</code> using the wrapper function <code>admiral::derive_param_map()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">derive_param_map</span>(</span>
<span id="cb8-3"><a href="#cb8-3"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, <span class="sc">!!!</span>adsl_vars, VISIT, VISITNUM, ADT, ADY, VSTPT, VSTPTNUM, AVALU), <span class="co"># Other variables than the defined ones here won't be populated</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>    <span class="at">set_values_to =</span> <span class="fu">exprs</span>(<span class="at">PARAMCD =</span> <span class="st">"MAP"</span>),</span>
<span id="cb8-5"><a href="#cb8-5"></a>    <span class="at">get_unit_expr =</span> VSSTRESU,</span>
<span id="cb8-6"><a href="#cb8-6"></a>    <span class="at">filter =</span> VSSTAT <span class="sc">!=</span> <span class="st">"NOT DONE"</span> <span class="sc">|</span> <span class="fu">is.na</span>(VSSTAT),</span>
<span id="cb8-7"><a href="#cb8-7"></a>    <span class="co"># Below arguments are default values and not necessary to add in our case</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>    <span class="at">sysbp_code =</span> <span class="st">"SYSBP"</span>,</span>
<span id="cb8-9"><a href="#cb8-9"></a>    <span class="at">diabp_code =</span> <span class="st">"DIABP"</span>,</span>
<span id="cb8-10"><a href="#cb8-10"></a>    <span class="at">hr_code =</span> <span class="cn">NULL</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly we could create <code>Body Mass Index</code> (BMI) for <code>ADVS</code> using the wrapper function <code>admiral::derive_param_bmi()</code>, instead we will see in below example how to use the more generic function <code>admiral::derive_param_computed()</code> Note that if height is collected only once use <code>constant_parameters</code> to define the corresponding parameter which will be merged to the other parameters and <code>constant_by_vars</code> to specify the subject-level variable to merge on. Otherwise BMI is only calculated for visits where both parameters <code>HEIGHT</code> and <code>WEIGHT</code> are collected.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="fu">derive_param_computed</span>(</span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, VISIT, VISITNUM, ADT, ADY, VSTPT, VSTPTNUM),</span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="at">parameters =</span> <span class="st">"WEIGHT"</span>,</span>
<span id="cb9-5"><a href="#cb9-5"></a>    <span class="at">set_values_to =</span> <span class="fu">exprs</span>(</span>
<span id="cb9-6"><a href="#cb9-6"></a>      <span class="at">AVAL =</span> AVAL.WEIGHT <span class="sc">/</span> (AVAL.HEIGHT <span class="sc">/</span> <span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb9-7"><a href="#cb9-7"></a>      <span class="at">PARAMCD =</span> <span class="st">"BMI"</span>,</span>
<span id="cb9-8"><a href="#cb9-8"></a>      <span class="at">AVALU =</span> <span class="st">"kg/m^2"</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>    ),</span>
<span id="cb9-10"><a href="#cb9-10"></a>    <span class="at">constant_parameters =</span> <span class="fu">c</span>(<span class="st">"HEIGHT"</span>),</span>
<span id="cb9-11"><a href="#cb9-11"></a>    <span class="at">constant_by_vars =</span> <span class="fu">exprs</span>(USUBJID)</span>
<span id="cb9-12"><a href="#cb9-12"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Likewise, wrapper function <code>admiral::derive_param_bsa()</code> call below, to create parameter <code>Body Surface Area</code> (BSA) for <code>ADVS</code> domain. Note that if height is collected only once use <code>constant_by_vars</code> to specify the subject-level variable to merge on. Otherwise BSA is only calculated for visits where both parameters <code>HEIGHT</code> and <code>WEIGHT</code> are collected.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">derive_param_bsa</span>(</span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, <span class="sc">!!!</span>adsl_vars, VISIT, VISITNUM, ADT, ADY, VSTPT, VSTPTNUM),</span>
<span id="cb10-4"><a href="#cb10-4"></a>    <span class="at">method =</span> <span class="st">"Mosteller"</span>,</span>
<span id="cb10-5"><a href="#cb10-5"></a>    <span class="at">set_values_to =</span> <span class="fu">exprs</span>(</span>
<span id="cb10-6"><a href="#cb10-6"></a>      <span class="at">PARAMCD =</span> <span class="st">"BSA"</span>,</span>
<span id="cb10-7"><a href="#cb10-7"></a>      <span class="at">AVALU =</span> <span class="st">"m^2"</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>    ),</span>
<span id="cb10-9"><a href="#cb10-9"></a>    <span class="at">get_unit_expr =</span> VSSTRESU,</span>
<span id="cb10-10"><a href="#cb10-10"></a>    <span class="at">filter =</span> VSSTAT <span class="sc">!=</span> <span class="st">"NOT DONE"</span> <span class="sc">|</span> <span class="fu">is.na</span>(VSSTAT),</span>
<span id="cb10-11"><a href="#cb10-11"></a>    <span class="at">constant_by_vars =</span> <span class="fu">exprs</span>(USUBJID),</span>
<span id="cb10-12"><a href="#cb10-12"></a>    <span class="co"># Below arguments are default values and not necessary to add in our case</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>    <span class="at">height_code =</span> <span class="st">"HEIGHT"</span>,</span>
<span id="cb10-14"><a href="#cb10-14"></a>    <span class="at">weight_code =</span> <span class="st">"WEIGHT"</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-779ce547bf5702af343f" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-779ce547bf5702af343f">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"STUDYID":["CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01"],"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015"],"VSTESTCD":[null,null,null,null,null,null,null,null,null,null],"PARAMCD":["MAP","MAP","MAP","MAP","MAP","MAP","MAP","MAP","MAP","MAP"],"VISIT":["SCREENING 1","SCREENING 1","SCREENING 1","SCREENING 2","SCREENING 2","SCREENING 2","BASELINE","BASELINE","BASELINE","AMBUL ECG PLACEMENT"],"VSTPT":["AFTER LYING DOWN FOR 5 MINUTES","AFTER STANDING FOR 1 MINUTE","AFTER STANDING FOR 3 MINUTES","AFTER LYING DOWN FOR 5 MINUTES","AFTER STANDING FOR 1 MINUTE","AFTER STANDING FOR 3 MINUTES","AFTER LYING DOWN FOR 5 MINUTES","AFTER STANDING FOR 1 MINUTE","AFTER STANDING FOR 3 MINUTES","AFTER LYING DOWN FOR 5 MINUTES"],"AVAL":[86.3333333333333,98.3333333333333,87,91.3333333333333,85,95.6666666666667,80.6666666666667,74.3333333333333,84.3333333333333,90.3333333333333],"AVALU":["mmHg","mmHg","mmHg","mmHg","mmHg","mmHg","mmHg","mmHg","mmHg","mmHg"]},"columns":[{"id":"STUDYID","name":"STUDYID","type":"character"},{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"VSTESTCD","name":"VSTESTCD","type":"character"},{"id":"PARAMCD","name":"PARAMCD","type":"character"},{"id":"VISIT","name":"VISIT","type":"character"},{"id":"VSTPT","name":"VSTPT","type":"character"},{"id":"AVAL","name":"AVAL","type":"numeric"},{"id":"AVALU","name":"AVALU","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"3f96f3cfa6f7c89edc203aadf643ef1c"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-8e3a470d04ad5113b81a" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8e3a470d04ad5113b81a">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"STUDYID":["CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01"],"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015"],"VSTESTCD":[null,null,null,null,null,null,null,null,null,null],"PARAMCD":["BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI"],"VISIT":["SCREENING 1","BASELINE","WEEK 2","WEEK 4","WEEK 6","WEEK 8","WEEK 12","WEEK 16","WEEK 20","WEEK 24"],"VSTPT":[null,null,null,null,null,null,null,null,null,null],"AVAL":[24.8719284596714,25.0792713238221,24.4526351121668,24.8719284596714,24.4526351121668,24.4526351121668,24.4526351121668,24.4526351121668,24.4526351121668,24.4526351121668],"AVALU":["kg/m^2","kg/m^2","kg/m^2","kg/m^2","kg/m^2","kg/m^2","kg/m^2","kg/m^2","kg/m^2","kg/m^2"]},"columns":[{"id":"STUDYID","name":"STUDYID","type":"character"},{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"VSTESTCD","name":"VSTESTCD","type":"character"},{"id":"PARAMCD","name":"PARAMCD","type":"character"},{"id":"VISIT","name":"VISIT","type":"character"},{"id":"VSTPT","name":"VSTPT","type":"character"},{"id":"AVAL","name":"AVAL","type":"numeric"},{"id":"AVALU","name":"AVALU","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"e71802625c9cfad7744b199f5b1f519a"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-b702bbef1839b461d765" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b702bbef1839b461d765">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"STUDYID":["CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01","CDISCPILOT01"],"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015"],"VSTESTCD":[null,null,null,null,null,null,null,null,null,null],"PARAMCD":["BSA","BSA","BSA","BSA","BSA","BSA","BSA","BSA","BSA","BSA"],"VISIT":["SCREENING 1","BASELINE","WEEK 2","WEEK 4","WEEK 6","WEEK 8","WEEK 12","WEEK 16","WEEK 20","WEEK 24"],"VSTPT":[null,null,null,null,null,null,null,null,null,null],"AVAL":[1.4862642953242,1.49244650006476,1.47368325407237,1.4862642953242,1.47368325407237,1.47368325407237,1.47368325407237,1.47368325407237,1.47368325407237,1.47368325407237],"AVALU":["m^2","m^2","m^2","m^2","m^2","m^2","m^2","m^2","m^2","m^2"]},"columns":[{"id":"STUDYID","name":"STUDYID","type":"character"},{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"VSTESTCD","name":"VSTESTCD","type":"character"},{"id":"PARAMCD","name":"PARAMCD","type":"character"},{"id":"VISIT","name":"VISIT","type":"character"},{"id":"VSTPT","name":"VSTPT","type":"character"},{"id":"AVAL","name":"AVAL","type":"numeric"},{"id":"AVALU","name":"AVALU","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"00473e896ee8eead7687749d52f7d1e5"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="timingvars" class="level2">
<h2 class="anchored" data-anchor-id="timingvars">Derive Timing Variables (e.g.&nbsp;<code>AVISIT</code>, <code>ATPT</code>, <code>ATPTN</code>)</h2>
<p>Categorical timing variables are protocol and analysis dependent. Below is a simple example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="at">ATPTN =</span> VSTPTNUM,</span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="at">ATPT =</span> VSTPT,</span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="at">AVISIT =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-6"><a href="#cb11-6"></a>      <span class="fu">str_detect</span>(VISIT, <span class="st">"SCREEN|UNSCHED|RETRIEVAL|AMBUL"</span>) <span class="sc">~</span> <span class="cn">NA_character_</span>,</span>
<span id="cb11-7"><a href="#cb11-7"></a>      <span class="sc">!</span><span class="fu">is.na</span>(VISIT) <span class="sc">~</span> <span class="fu">str_to_title</span>(VISIT),</span>
<span id="cb11-8"><a href="#cb11-8"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>    ),</span>
<span id="cb11-10"><a href="#cb11-10"></a>    <span class="at">AVISITN =</span> <span class="fu">as.numeric</span>(<span class="fu">case_when</span>(</span>
<span id="cb11-11"><a href="#cb11-11"></a>      VISIT <span class="sc">==</span> <span class="st">"BASELINE"</span> <span class="sc">~</span> <span class="st">"0"</span>,</span>
<span id="cb11-12"><a href="#cb11-12"></a>      <span class="fu">str_detect</span>(VISIT, <span class="st">"WEEK"</span>) <span class="sc">~</span> <span class="fu">str_trim</span>(<span class="fu">str_replace</span>(VISIT, <span class="st">"WEEK"</span>, <span class="st">""</span>)),</span>
<span id="cb11-13"><a href="#cb11-13"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb11-14"><a href="#cb11-14"></a>    ))</span>
<span id="cb11-15"><a href="#cb11-15"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For assigning visits based on time windows and deriving periods, subperiods, and phase variables see the <a href="visits_periods.html">“Visit and Period Variables” vignette</a>.</p>
</section>
<section id="summaryrec" class="level2">
<h2 class="anchored" data-anchor-id="summaryrec">Derive summary records (e.g.&nbsp;mean of the triplicates at each time point)</h2>
<p>For adding new records based on aggregating records <code>admiral::derive_summary_records()</code> can be used. For the new records only the variables specified by <code>by_vars</code> and <code>set_values_to</code> are populated.</p>
<p>For each subject, Vital Signs parameter, visit, and date add a record holding the average value for observations on that date. Set <code>DTYPE</code> to <code>AVERAGE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>advs <span class="ot">&lt;-</span> <span class="fu">derive_summary_records</span>(</span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="at">dataset =</span> advs,</span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="at">dataset_add =</span> advs, <span class="co"># Observations from the specified dataset are going to be used to calculate and added as new records to the input dataset.</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, <span class="sc">!!!</span>adsl_vars, PARAMCD, AVISITN, AVISIT, ADT, ADY, AVALU),</span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="at">filter_add =</span> <span class="sc">!</span><span class="fu">is.na</span>(AVAL),</span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="at">set_values_to =</span> <span class="fu">exprs</span>(</span>
<span id="cb12-7"><a href="#cb12-7"></a>    <span class="at">AVAL =</span> <span class="fu">mean</span>(AVAL),</span>
<span id="cb12-8"><a href="#cb12-8"></a>    <span class="at">DTYPE =</span> <span class="st">"AVERAGE"</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>  )</span>
<span id="cb12-10"><a href="#cb12-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ontrtfl" class="level2">
<h2 class="anchored" data-anchor-id="ontrtfl">Timing Flag Variables (e.g.&nbsp;<code>ONTRTFL</code>)</h2>
<p>In some analyses, it may be necessary to flag an observation as on-treatment. The admiral function <code>admiral::derive_var_ontrtfl()</code> can be used.</p>
<p>For example, if on-treatment is defined as any observation between treatment start and treatment end, the flag may be derived as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>advs <span class="ot">&lt;-</span> <span class="fu">derive_var_ontrtfl</span>(</span>
<span id="cb13-2"><a href="#cb13-2"></a>  advs,</span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="at">start_date =</span> ADT,</span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="at">ref_start_date =</span> TRTSDT,</span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="at">ref_end_date =</span> TRTEDT,</span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="at">filter_pre_timepoint =</span> <span class="fu">toupper</span>(AVISIT) <span class="sc">==</span> <span class="st">"BASELINE"</span> <span class="co"># Observations as not on-treatment</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-6eff453d13ac32123b14" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6eff453d13ac32123b14">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1023","01-701-1023","01-701-1023","01-701-1028","01-701-1028","01-701-1028","01-701-1033"],"PARAMCD":["DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP"],"ADT":["2014-01-16","2014-01-16","2014-01-16","2012-08-27","2012-08-27","2012-08-27","2013-08-01","2013-08-01","2013-08-01","2014-04-01"],"TRTSDT":["2014-01-02","2014-01-02","2014-01-02","2012-08-05","2012-08-05","2012-08-05","2013-07-19","2013-07-19","2013-07-19","2014-03-18"],"TRTEDT":["2014-07-02","2014-07-02","2014-07-02","2012-09-01","2012-09-01","2012-09-01","2014-01-14","2014-01-14","2014-01-14","2014-03-31"],"ONTRTFL":["Y","Y","Y","Y","Y","Y","Y","Y","Y",null]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"PARAMCD","name":"PARAMCD","type":"character"},{"id":"ADT","name":"ADT","type":"Date"},{"id":"TRTSDT","name":"TRTSDT","type":"Date"},{"id":"TRTEDT","name":"TRTEDT","type":"Date"},{"id":"ONTRTFL","name":"ONTRTFL","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"a05d5f8cc16e2c2f9e61e2b74e2a88db"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="rangeind" class="level2">
<h2 class="anchored" data-anchor-id="rangeind">Assign Reference Range Indicator (<code>ANRIND</code>)</h2>
<p>The admiral function <code>derive_var_anrind()</code> may be used to derive the reference range indicator <code>ANRIND</code>.</p>
<p>This function requires the reference range boundaries to exist on the data frame (<code>ANRLO</code>, <code>ANRHI</code>) and also accommodates the additional boundaries <code>A1LO</code> and <code>A1HI</code>.</p>
<p>The function is called as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>advs <span class="ot">&lt;-</span> <span class="fu">derive_var_anrind</span>(</span>
<span id="cb14-2"><a href="#cb14-2"></a>  advs,</span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="co"># Below arguments are default values and not necessary to add in our case</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="at">signif_dig =</span> <span class="fu">get_admiral_option</span>(<span class="st">"signif_digits"</span>),</span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="at">use_a1hia1lo =</span> <span class="cn">FALSE</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-13caa66e24635911a2c6" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-13caa66e24635911a2c6">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1023","01-701-1023","01-701-1023","01-701-1028","01-701-1028","01-701-1028","01-701-1033"],"PARAMCD":["DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP"],"AVAL":[56,50,54,88,86,90,78,80,80,84],"ANRLO":[60,60,60,60,60,60,60,60,60,60],"ANRHI":[80,80,80,80,80,80,80,80,80,80],"A1LO":[40,40,40,40,40,40,40,40,40,40],"A1HI":[90,90,90,90,90,90,90,90,90,90],"ANRIND":["LOW","LOW","LOW","HIGH","HIGH","HIGH","NORMAL","NORMAL","NORMAL","HIGH"]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"PARAMCD","name":"PARAMCD","type":"character"},{"id":"AVAL","name":"AVAL","type":"numeric"},{"id":"ANRLO","name":"ANRLO","type":"numeric"},{"id":"ANRHI","name":"ANRHI","type":"numeric"},{"id":"A1LO","name":"A1LO","type":"numeric"},{"id":"A1HI","name":"A1HI","type":"numeric"},{"id":"ANRIND","name":"ANRIND","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"31a16581316c497a60fcabc6b0f733cc"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="baselinevars" class="level2">
<h2 class="anchored" data-anchor-id="baselinevars">Derive Baseline (<code>BASETYPE</code>, <code>ABLFL</code>, <code>BASE</code>, <code>BNRIND</code>)</h2>
<p>The <code>BASETYPE</code> should be derived using the function <code>admiral::derive_basetype_records()</code>. The parameter <code>basetypes</code> of this function requires a named list of expression detailing how the <code>BASETYPE</code> should be assigned. Note, if a record falls into multiple expressions within the basetypes expression, a row will be produced for each <code>BASETYPE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>advs <span class="ot">&lt;-</span> <span class="fu">derive_basetype_records</span>(</span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="at">dataset =</span> advs,</span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="at">basetypes =</span> <span class="fu">exprs</span>(</span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="st">"LAST: AFTER LYING DOWN FOR 5 MINUTES"</span> <span class="ot">=</span> ATPTN <span class="sc">==</span> <span class="dv">815</span>,</span>
<span id="cb15-5"><a href="#cb15-5"></a>    <span class="st">"LAST: AFTER STANDING FOR 1 MINUTE"</span> <span class="ot">=</span> ATPTN <span class="sc">==</span> <span class="dv">816</span>,</span>
<span id="cb15-6"><a href="#cb15-6"></a>    <span class="st">"LAST: AFTER STANDING FOR 3 MINUTES"</span> <span class="ot">=</span> ATPTN <span class="sc">==</span> <span class="dv">817</span>,</span>
<span id="cb15-7"><a href="#cb15-7"></a>    <span class="st">"LAST"</span> <span class="ot">=</span> <span class="fu">is.na</span>(ATPTN)</span>
<span id="cb15-8"><a href="#cb15-8"></a>  )</span>
<span id="cb15-9"><a href="#cb15-9"></a>)</span>
<span id="cb15-10"><a href="#cb15-10"></a></span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="fu">count</span>(advs, ATPT, ATPTN, BASETYPE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  ATPT                           ATPTN BASETYPE                                n
  &lt;chr&gt;                          &lt;dbl&gt; &lt;chr&gt;                               &lt;int&gt;
1 AFTER LYING DOWN FOR 5 MINUTES   815 LAST: AFTER LYING DOWN FOR 5 MINUT… 10944
2 AFTER STANDING FOR 1 MINUTE      816 LAST: AFTER STANDING FOR 1 MINUTE   10938
3 AFTER STANDING FOR 3 MINUTES     817 LAST: AFTER STANDING FOR 3 MINUTES  10942
4 &lt;NA&gt;                              NA LAST                                29184</code></pre>
</div>
</div>
<p>It is important to derive <code>BASETYPE</code> first so that it can be utilized in subsequent derivations. This will be important if the data frame contains multiple values for <code>BASETYPE</code>.</p>
<p>Next, the analysis baseline flag <code>ABLFL</code> can be derived using the <code>{admiral}</code> function <code>admiral::derive_var_extreme_flag()</code>. For example, if baseline is defined as the last non-missing <code>AVAL</code> prior or on <code>TRTSDT</code>, the function call for <code>ABLFL</code> would be:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>advs <span class="ot">&lt;-</span> <span class="fu">restrict_derivation</span>(</span>
<span id="cb17-2"><a href="#cb17-2"></a>  advs,</span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="at">derivation =</span> derive_var_extreme_flag,</span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="at">args =</span> <span class="fu">params</span>(</span>
<span id="cb17-5"><a href="#cb17-5"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, BASETYPE, PARAMCD),</span>
<span id="cb17-6"><a href="#cb17-6"></a>    <span class="at">order =</span> <span class="fu">exprs</span>(ADT, VISITNUM, VSSEQ),</span>
<span id="cb17-7"><a href="#cb17-7"></a>    <span class="at">new_var =</span> ABLFL,</span>
<span id="cb17-8"><a href="#cb17-8"></a>    <span class="at">mode =</span> <span class="st">"last"</span>, <span class="co"># Determines of the first or last observation is flagged</span></span>
<span id="cb17-9"><a href="#cb17-9"></a>    <span class="co"># Below arguments are default values and not necessary to add in our case</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>    <span class="at">true_value =</span> <span class="st">"Y"</span></span>
<span id="cb17-11"><a href="#cb17-11"></a>  ),</span>
<span id="cb17-12"><a href="#cb17-12"></a>  <span class="at">filter =</span> (<span class="sc">!</span><span class="fu">is.na</span>(AVAL) <span class="sc">&amp;</span></span>
<span id="cb17-13"><a href="#cb17-13"></a>    ADT <span class="sc">&lt;=</span> TRTSDT <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(BASETYPE) <span class="sc">&amp;</span> <span class="fu">is.na</span>(DTYPE)</span>
<span id="cb17-14"><a href="#cb17-14"></a>  )</span>
<span id="cb17-15"><a href="#cb17-15"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-d3951c3c48f7c53e4350" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d3951c3c48f7c53e4350">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1023","01-701-1023","01-701-1023","01-701-1028","01-701-1028","01-701-1028","01-701-1033","01-701-1033","01-701-1033","01-701-1034","01-701-1034","01-701-1034","01-701-1047","01-701-1047","01-701-1047","01-701-1097","01-701-1097","01-701-1097","01-701-1111","01-701-1111","01-701-1111","01-701-1115","01-701-1115","01-701-1115","01-701-1118","01-701-1118","01-701-1118"],"BASETYPE":["LAST: AFTER LYING DOWN FOR 5 MINUTES","LAST: AFTER STANDING FOR 1 MINUTE","LAST: AFTER STANDING FOR 3 MINUTES","LAST: AFTER LYING DOWN FOR 5 MINUTES","LAST: AFTER STANDING FOR 1 MINUTE","LAST: AFTER STANDING FOR 3 MINUTES","LAST: AFTER LYING DOWN FOR 5 MINUTES","LAST: AFTER STANDING FOR 1 MINUTE","LAST: AFTER STANDING FOR 3 MINUTES","LAST: AFTER LYING DOWN FOR 5 MINUTES","LAST: AFTER STANDING FOR 1 MINUTE","LAST: AFTER STANDING FOR 3 MINUTES","LAST: AFTER LYING DOWN FOR 5 MINUTES","LAST: AFTER STANDING FOR 1 MINUTE","LAST: AFTER STANDING FOR 3 MINUTES","LAST: AFTER LYING DOWN FOR 5 MINUTES","LAST: AFTER STANDING FOR 1 MINUTE","LAST: AFTER STANDING FOR 3 MINUTES","LAST: AFTER LYING DOWN FOR 5 MINUTES","LAST: AFTER STANDING FOR 1 MINUTE","LAST: AFTER STANDING FOR 3 MINUTES","LAST: AFTER LYING DOWN FOR 5 MINUTES","LAST: AFTER STANDING FOR 1 MINUTE","LAST: AFTER STANDING FOR 3 MINUTES","LAST: AFTER LYING DOWN FOR 5 MINUTES","LAST: AFTER STANDING FOR 1 MINUTE","LAST: AFTER STANDING FOR 3 MINUTES","LAST: AFTER LYING DOWN FOR 5 MINUTES","LAST: AFTER STANDING FOR 1 MINUTE","LAST: AFTER STANDING FOR 3 MINUTES"],"PARAMCD":["DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP"],"ADT":["2014-01-02","2014-01-02","2014-01-02","2012-08-05","2012-08-05","2012-08-05","2013-07-19","2013-07-19","2013-07-19","2014-03-18","2014-03-18","2014-03-18","2014-07-01","2014-07-01","2014-07-01","2013-02-12","2013-02-12","2013-02-12","2014-01-01","2014-01-01","2014-01-01","2012-09-07","2012-09-07","2012-09-07","2012-11-30","2012-11-30","2012-11-30","2014-03-12","2014-03-12","2014-03-12"],"TRTSDT":["2014-01-02","2014-01-02","2014-01-02","2012-08-05","2012-08-05","2012-08-05","2013-07-19","2013-07-19","2013-07-19","2014-03-18","2014-03-18","2014-03-18","2014-07-01","2014-07-01","2014-07-01","2013-02-12","2013-02-12","2013-02-12","2014-01-01","2014-01-01","2014-01-01","2012-09-07","2012-09-07","2012-09-07","2012-11-30","2012-11-30","2012-11-30","2014-03-12","2014-03-12","2014-03-12"],"ATPTN":[815,816,817,815,816,817,815,816,817,815,816,817,815,816,817,815,816,817,815,816,817,815,816,817,815,816,817,815,816,817],"ABLFL":["Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y"]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"BASETYPE","name":"BASETYPE","type":"character"},{"id":"PARAMCD","name":"PARAMCD","type":"character"},{"id":"ADT","name":"ADT","type":"Date"},{"id":"TRTSDT","name":"TRTSDT","type":"Date"},{"id":"ATPTN","name":"ATPTN","type":"numeric"},{"id":"ABLFL","name":"ABLFL","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"3043371012bcfc1035e025e01df7d0d1"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Lastly, the <code>BASE</code>, and <code>BNRIND</code> columns can be derived using the <code>{admiral}</code> function <code>admiral::derive_var_base()</code>. Example calls are:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>advs <span class="ot">&lt;-</span> <span class="fu">derive_var_base</span>(</span>
<span id="cb18-2"><a href="#cb18-2"></a>  advs,</span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, PARAMCD, BASETYPE),</span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="at">source_var =</span> AVAL,</span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="at">new_var =</span> BASE,</span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="co"># Below arguments are default values and not necessary to add in our case</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="at">filter =</span> ABLFL <span class="sc">==</span> <span class="st">"Y"</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>)</span>
<span id="cb18-9"><a href="#cb18-9"></a></span>
<span id="cb18-10"><a href="#cb18-10"></a>advs <span class="ot">&lt;-</span> <span class="fu">derive_var_base</span>(</span>
<span id="cb18-11"><a href="#cb18-11"></a>  advs,</span>
<span id="cb18-12"><a href="#cb18-12"></a>  <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, PARAMCD, BASETYPE),</span>
<span id="cb18-13"><a href="#cb18-13"></a>  <span class="at">source_var =</span> ANRIND,</span>
<span id="cb18-14"><a href="#cb18-14"></a>  <span class="at">new_var =</span> BNRIND</span>
<span id="cb18-15"><a href="#cb18-15"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-44079561ab5a37a1bdc4" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-44079561ab5a37a1bdc4">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1023","01-701-1023","01-701-1023","01-701-1028","01-701-1028","01-701-1028","01-701-1033"],"BASETYPE":["LAST: AFTER LYING DOWN FOR 5 MINUTES","LAST: AFTER STANDING FOR 1 MINUTE","LAST: AFTER STANDING FOR 3 MINUTES","LAST: AFTER LYING DOWN FOR 5 MINUTES","LAST: AFTER STANDING FOR 1 MINUTE","LAST: AFTER STANDING FOR 3 MINUTES","LAST: AFTER LYING DOWN FOR 5 MINUTES","LAST: AFTER STANDING FOR 1 MINUTE","LAST: AFTER STANDING FOR 3 MINUTES","LAST: AFTER LYING DOWN FOR 5 MINUTES"],"PARAMCD":["DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP"],"ABLFL":["Y","Y","Y","Y","Y","Y","Y","Y","Y","Y"],"BASE":[56,51,61,84,86,88,85,76,75,83],"ANRIND":["LOW","LOW","NORMAL","HIGH","HIGH","HIGH","HIGH","NORMAL","NORMAL","HIGH"],"BNRIND":["LOW","LOW","NORMAL","HIGH","HIGH","HIGH","HIGH","NORMAL","NORMAL","HIGH"]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"BASETYPE","name":"BASETYPE","type":"character"},{"id":"PARAMCD","name":"PARAMCD","type":"character"},{"id":"ABLFL","name":"ABLFL","type":"character"},{"id":"BASE","name":"BASE","type":"numeric"},{"id":"ANRIND","name":"ANRIND","type":"character"},{"id":"BNRIND","name":"BNRIND","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"1b8e71dcdf2fb7056b2939537a335b07"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="chgpchg" class="level2">
<h2 class="anchored" data-anchor-id="chgpchg">Derive Change from Baseline (<code>CHG</code>, <code>PCHG</code>)</h2>
<p>Change and percent change from baseline can be derived using the <code>{admiral}</code> functions <code>admiral::derive_var_chg()</code> and <code>admiral::derive_var_pchg()</code>. These functions expect <code>AVAL</code> and <code>BASE</code> to exist in the data frame. The <code>CHG</code> is simply <code>AVAL - BASE</code> and the <code>PCHG</code> is <code>(AVAL - BASE) / absolute value (BASE) * 100</code>. If the variables should not be derived for all records, e.g., for post-baseline records only, <code>admiral::restrict_derivation()</code> can be used. Examples calls are:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>advs <span class="ot">&lt;-</span> <span class="fu">restrict_derivation</span>(</span>
<span id="cb19-2"><a href="#cb19-2"></a>  advs,</span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="at">derivation =</span> derive_var_chg,</span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="at">filter =</span> AVISITN <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>)</span>
<span id="cb19-6"><a href="#cb19-6"></a></span>
<span id="cb19-7"><a href="#cb19-7"></a>advs <span class="ot">&lt;-</span> <span class="fu">restrict_derivation</span>(</span>
<span id="cb19-8"><a href="#cb19-8"></a>  advs,</span>
<span id="cb19-9"><a href="#cb19-9"></a>  <span class="at">derivation =</span> derive_var_pchg,</span>
<span id="cb19-10"><a href="#cb19-10"></a>  <span class="at">filter =</span> AVISITN <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb19-11"><a href="#cb19-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-f45c599e503a462621d5" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f45c599e503a462621d5">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-701-1015","01-701-1015","01-701-1023","01-701-1028","01-701-1028","01-701-1033","01-701-1034","01-701-1034","01-701-1047","01-701-1097","01-701-1097","01-701-1111","01-701-1115","01-701-1115","01-701-1118","01-701-1118","01-701-1130","01-701-1130","01-701-1133","01-701-1133","01-701-1146","01-701-1148","01-701-1148","01-701-1153","01-701-1153","01-701-1180","01-701-1181","01-701-1188","01-701-1192","01-701-1192"],"PARAMCD":["DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP"],"VISIT":["WEEK 2","WEEK 8","WEEK 2","WEEK 2","WEEK 8","WEEK 2","WEEK 2","WEEK 8","WEEK 2","WEEK 2","WEEK 8","WEEK 2","WEEK 2","WEEK 8","WEEK 2","WEEK 8","WEEK 2","WEEK 8","WEEK 2","WEEK 8","WEEK 2","WEEK 2","WEEK 8","WEEK 2","WEEK 8","WEEK 2","WEEK 2","WEEK 2","WEEK 2","WEEK 8"],"BASE":[56,56,84,85,85,83,60,60,61,72,72,66,83,83,84,84,74,74,59,59,51,70,70,60,60,76,71,78,84,84],"AVAL":[56,67,88,78,76,84,81,73,72,72,75,60,79,76,82,67,72,75,56,59,57,69,75,63,56,87,64,87,72,64],"CHG":[0,11,4,-7,-9,1,21,13,11,0,3,-6,-4,-7,-2,-17,-2,1,-3,0,6,-1,5,3,-4,11,-7,9,-12,-20],"PCHG":[0,19.6428571428571,4.76190476190476,-8.23529411764706,-10.5882352941176,1.20481927710843,35,21.6666666666667,18.0327868852459,0,4.16666666666667,-9.09090909090909,-4.81927710843374,-8.43373493975904,-2.38095238095238,-20.2380952380952,-2.7027027027027,1.35135135135135,-5.08474576271187,0,11.7647058823529,-1.42857142857143,7.14285714285714,5,-6.66666666666667,14.4736842105263,-9.85915492957746,11.5384615384615,-14.2857142857143,-23.8095238095238]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"PARAMCD","name":"PARAMCD","type":"character"},{"id":"VISIT","name":"VISIT","type":"character"},{"id":"BASE","name":"BASE","type":"numeric"},{"id":"AVAL","name":"AVAL","type":"numeric"},{"id":"CHG","name":"CHG","type":"numeric"},{"id":"PCHG","name":"PCHG","type":"numeric"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"77c6a200aa0acc71f98b66668fabe338"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="anl01fl" class="level2">
<h2 class="anchored" data-anchor-id="anl01fl">Derive Analysis Flags (e.g.&nbsp;<code>ANL01FL</code>)</h2>
<p>In most finding ADaMs, an analysis flag is derived to identify the appropriate observation(s) to use for a particular analysis when a subject has multiple observations within a particular timing period.</p>
<p>In this situation, an analysis flag (e.g.&nbsp;<code>ANLzzFL</code>) may be used to choose the appropriate record for analysis.</p>
<p>This flag may be derived using the <code>{admiral}</code> function <code>admiral::derive_var_extreme_flag()</code>. For this example, we will assume we would like to choose within the Post-Baseline records the latest and highest value by <code>USUBJID</code>, <code>PARAMCD</code>, <code>AVISIT</code>, and <code>ATPT</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>advs <span class="ot">&lt;-</span> <span class="fu">restrict_derivation</span>(</span>
<span id="cb20-2"><a href="#cb20-2"></a>  advs,</span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="at">derivation =</span> derive_var_extreme_flag,</span>
<span id="cb20-4"><a href="#cb20-4"></a>  <span class="at">args =</span> <span class="fu">params</span>(</span>
<span id="cb20-5"><a href="#cb20-5"></a>    <span class="at">new_var =</span> ANL01FL,</span>
<span id="cb20-6"><a href="#cb20-6"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, PARAMCD, AVISIT, ATPT, DTYPE),</span>
<span id="cb20-7"><a href="#cb20-7"></a>    <span class="at">order =</span> <span class="fu">exprs</span>(ADT, AVAL),</span>
<span id="cb20-8"><a href="#cb20-8"></a>    <span class="at">mode =</span> <span class="st">"last"</span>, <span class="co"># Determines of the first or last observation is flagged - As seen while deriving ABLFL</span></span>
<span id="cb20-9"><a href="#cb20-9"></a>    <span class="co"># Below arguments are default values and not necessary to add in our case</span></span>
<span id="cb20-10"><a href="#cb20-10"></a>    <span class="at">true_value =</span> <span class="st">"Y"</span></span>
<span id="cb20-11"><a href="#cb20-11"></a>  ),</span>
<span id="cb20-12"><a href="#cb20-12"></a>  <span class="at">filter =</span> <span class="sc">!</span><span class="fu">is.na</span>(AVISITN) <span class="sc">&amp;</span> ONTRTFL <span class="sc">==</span> <span class="st">"Y"</span></span>
<span id="cb20-13"><a href="#cb20-13"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-babb7ec9afa470abf397" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-babb7ec9afa470abf397">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1023","01-701-1023","01-701-1023","01-701-1028","01-701-1028","01-701-1028","01-701-1028","01-701-1028","01-701-1028","01-701-1034","01-701-1034","01-701-1034","01-701-1034","01-701-1034","01-701-1034","01-701-1047","01-701-1047","01-701-1047","01-701-1097","01-701-1097","01-701-1097","01-701-1097","01-701-1097","01-701-1097"],"PARAMCD":["DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP","DIABP"],"AVISIT":["Week 2","Week 2","Week 2","Week 8","Week 8","Week 8","Week 2","Week 2","Week 2","Week 2","Week 2","Week 2","Week 8","Week 8","Week 8","Week 2","Week 2","Week 2","Week 8","Week 8","Week 8","Week 2","Week 2","Week 2","Week 2","Week 2","Week 2","Week 8","Week 8","Week 8"],"ATPTN":[815,816,817,815,816,817,815,816,817,815,816,817,815,816,817,815,816,817,815,816,817,815,816,817,815,816,817,815,816,817],"ADT":["2014-01-16","2014-01-16","2014-01-16","2014-03-05","2014-03-05","2014-03-05","2012-08-27","2012-08-27","2012-08-27","2013-08-01","2013-08-01","2013-08-01","2013-09-10","2013-09-10","2013-09-10","2014-07-15","2014-07-15","2014-07-15","2014-08-26","2014-08-26","2014-08-26","2013-02-25","2013-02-25","2013-02-25","2014-01-15","2014-01-15","2014-01-15","2014-02-26","2014-02-26","2014-02-26"],"AVAL":[56,50,54,67,62,71,88,86,90,78,80,80,76,81,84,81,101,84,73,80,76,72,84,73,72,82,84,75,73,66],"ANL01FL":["Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y","Y"]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"PARAMCD","name":"PARAMCD","type":"character"},{"id":"AVISIT","name":"AVISIT","type":"character"},{"id":"ATPTN","name":"ATPTN","type":"numeric"},{"id":"ADT","name":"ADT","type":"Date"},{"id":"AVAL","name":"AVAL","type":"numeric"},{"id":"ANL01FL","name":"ANL01FL","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"80ffaf6430c46ecd5311bffaf299c823"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="treatmentvars" class="level2">
<h2 class="anchored" data-anchor-id="treatmentvars">Assign Treatment (<code>TRTA</code>, <code>TRTP</code>)</h2>
<p><code>TRTA</code> and <code>TRTP</code> must match at least one value of the character treatment variables in ADSL (e.g., <code>TRTxxA</code>/<code>TRTxxP</code>, <code>TRTSEQA</code>/<code>TRTSEQP</code>, <code>TRxxAGy</code>/<code>TRxxPGy</code>).</p>
<p>An example of a simple implementation for a study without periods could be:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-3"><a href="#cb21-3"></a>    <span class="at">TRTP =</span> TRT01P,</span>
<span id="cb21-4"><a href="#cb21-4"></a>    <span class="at">TRTA =</span> TRT01A</span>
<span id="cb21-5"><a href="#cb21-5"></a>  )</span>
<span id="cb21-6"><a href="#cb21-6"></a></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="fu">count</span>(advs, TRTP, TRTA, TRT01P, TRT01A)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  TRTP                 TRTA                 TRT01P               TRT01A        n
  &lt;chr&gt;                &lt;chr&gt;                &lt;chr&gt;                &lt;chr&gt;     &lt;int&gt;
1 Placebo              Placebo              Placebo              Placebo   22102
2 Xanomeline High Dose Xanomeline High Dose Xanomeline High Dose Xanomeli… 16782
3 Xanomeline High Dose Xanomeline Low Dose  Xanomeline High Dose Xanomeli…  1038
4 Xanomeline Low Dose  Xanomeline Low Dose  Xanomeline Low Dose  Xanomeli… 17986
5 &lt;NA&gt;                 &lt;NA&gt;                 &lt;NA&gt;                 &lt;NA&gt;       4100</code></pre>
</div>
</div>
<p>For studies with periods see the <a href="visits_periods.html#treatment_bds">“Visit and Period Variables” vignette</a>.</p>
</section>
<section id="aseq" class="level2">
<h2 class="anchored" data-anchor-id="aseq">Assign <code>ASEQ</code></h2>
<p>The <code>{admiral}</code> function <code>admiral::derive_var_obs_number()</code> can be used to derive <code>ASEQ</code>. An example call is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>advs <span class="ot">&lt;-</span> <span class="fu">derive_var_obs_number</span>(</span>
<span id="cb23-2"><a href="#cb23-2"></a>  advs,</span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="at">new_var =</span> ASEQ,</span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID),</span>
<span id="cb23-5"><a href="#cb23-5"></a>  <span class="at">order =</span> <span class="fu">exprs</span>(PARAMCD, ADT, AVISITN, VISITNUM, ATPTN, DTYPE),</span>
<span id="cb23-6"><a href="#cb23-6"></a>  <span class="at">check_type =</span> <span class="st">"error"</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-d987ac392683534f9472" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d987ac392683534f9472">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015"],"PARAMCD":["BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BSA","BSA","BSA","BSA","BSA","BSA","BSA","BSA"],"ADT":["2013-12-26","2013-12-26","2014-01-02","2014-01-02","2014-01-16","2014-01-16","2014-01-30","2014-01-30","2014-02-12","2014-02-12","2014-03-05","2014-03-05","2014-03-26","2014-03-26","2014-05-07","2014-05-07","2014-05-21","2014-05-21","2014-06-18","2014-06-18","2014-07-02","2014-07-02","2013-12-26","2013-12-26","2014-01-02","2014-01-02","2014-01-16","2014-01-16","2014-01-30","2014-01-30"],"AVISITN":["NA","NA",0,0,2,2,4,4,6,6,8,8,12,12,16,16,20,20,24,24,26,26,"NA","NA",0,0,2,2,4,4],"ATPTN":["NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA"],"VISIT":["SCREENING 1",null,"BASELINE",null,"WEEK 2",null,"WEEK 4",null,"WEEK 6",null,"WEEK 8",null,"WEEK 12",null,"WEEK 16",null,"WEEK 20",null,"WEEK 24",null,"WEEK 26",null,"SCREENING 1",null,"BASELINE",null,"WEEK 2",null,"WEEK 4",null],"ASEQ":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"PARAMCD","name":"PARAMCD","type":"character"},{"id":"ADT","name":"ADT","type":"Date"},{"id":"AVISITN","name":"AVISITN","type":"numeric"},{"id":"ATPTN","name":"ATPTN","type":"numeric"},{"id":"VISIT","name":"VISIT","type":"character"},{"id":"ASEQ","name":"ASEQ","type":"numeric"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"4e51868b6c66d238e465e02a7226fdfa"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="categorizationvars" class="level2">
<h2 class="anchored" data-anchor-id="categorizationvars">Derive Categorization Variables (<code>AVALCATy</code>)</h2>
<p>We can use the <code>admiral::derive_vars_cat()</code> function to derive the categorization variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>avalcat_lookup <span class="ot">&lt;-</span> <span class="fu">exprs</span>(</span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="sc">~</span>PARAMCD,  <span class="sc">~</span>condition,   <span class="sc">~</span>AVALCAT1, <span class="sc">~</span>AVALCA1N,</span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="st">"HEIGHT"</span>,  AVAL <span class="sc">&gt;</span> <span class="dv">140</span>,   <span class="st">"&gt;140 cm"</span>,         <span class="dv">1</span>,</span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="st">"HEIGHT"</span>, AVAL <span class="sc">&lt;=</span> <span class="dv">140</span>, <span class="st">"&lt;= 140 cm"</span>,         <span class="dv">2</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>)</span>
<span id="cb24-6"><a href="#cb24-6"></a></span>
<span id="cb24-7"><a href="#cb24-7"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb24-8"><a href="#cb24-8"></a>  <span class="fu">derive_vars_cat</span>(</span>
<span id="cb24-9"><a href="#cb24-9"></a>    <span class="at">definition =</span> avalcat_lookup,</span>
<span id="cb24-10"><a href="#cb24-10"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(PARAMCD)</span>
<span id="cb24-11"><a href="#cb24-11"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-9cb009d8531f9ccec1df" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9cb009d8531f9ccec1df">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-701-1015","01-701-1015","01-701-1023","01-701-1023","01-701-1028","01-701-1028","01-701-1033","01-701-1033","01-701-1034","01-701-1034","01-701-1047","01-701-1047","01-701-1097","01-701-1097","01-701-1111","01-701-1111","01-701-1115","01-701-1115","01-701-1118","01-701-1118","01-701-1130","01-701-1130","01-701-1133","01-701-1133","01-701-1146","01-701-1146","01-701-1148","01-701-1148","01-701-1153","01-701-1153"],"PARAMCD":["HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT","HEIGHT"],"AVAL":[147.32,147.32,162.56,162.56,177.8,177.8,175.26,175.26,154.94,154.94,148.59,148.59,168.91,168.91,158.24,158.24,181.61,181.61,180.34,180.34,169.67,169.67,162.56,162.56,147.32,147.32,175.26,175.26,156.21,156.21],"AVALCA1N":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"AVALCAT1":[">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm",">140 cm"]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"PARAMCD","name":"PARAMCD","type":"character"},{"id":"AVAL","name":"AVAL","type":"numeric"},{"id":"AVALCA1N","name":"AVALCA1N","type":"numeric"},{"id":"AVALCAT1","name":"AVALCAT1","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"0cb2ee3647223280984dce9ead6dad9e"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="paramval" class="level2">
<h2 class="anchored" data-anchor-id="paramval">Assign Parameter Level Values (<code>PARAM</code>, <code>PARAMN</code>)</h2>
<p>When all <code>PARAMCD</code> have been derived and added to the dataset, the other information from the look-up table (<code>PARAM</code>, <code>PARAMN</code>,…) should be added using <code>admiral::derive_vars_merged()</code> function.</p>
<p>Another way to assign parameter-level values is by using the <code>metatools</code> package with the <code>{metacore}</code> objects we created at the beginning. To use the <code>metatools::create_var_from_codelist()</code> function, as shown in the example below, certain prerequisites must be met. Specifically, this function relies on code/decode pairs from a <code>{metacore}</code> object. Therefore, these pairs must be defined in the corresponding ADaMs specifications before creating the <code>{metacore}</code> object.</p>
<p>We can look into the <code>{metacore}</code> object and see these pairs for the <code>PARAM</code> variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu">get_control_term</span>(metacore, <span class="at">variable =</span> PARAM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
  code   decode                  
  &lt;chr&gt;  &lt;chr&gt;                   
1 SYSBP  Systolic Blood Pressure 
2 DIABP  Diastolic Blood Pressure
3 PULSE  Pulse Rate              
4 WEIGHT Weight                  
5 HEIGHT Height                  
6 TEMP   Temperature             
7 MAP    Mean Arterial Pressure  
8 BMI    Body Mass Index (kg/m^2)
9 BSA    Body Surface Area (m^2) </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">create_var_from_codelist</span>(</span>
<span id="cb27-3"><a href="#cb27-3"></a>    metacore,</span>
<span id="cb27-4"><a href="#cb27-4"></a>    <span class="at">input_var =</span> PARAMCD,</span>
<span id="cb27-5"><a href="#cb27-5"></a>    <span class="at">out_var =</span> PARAM,</span>
<span id="cb27-6"><a href="#cb27-6"></a>    <span class="at">decode_to_code =</span> <span class="cn">FALSE</span> <span class="co"># input_var is the code column of the codelist</span></span>
<span id="cb27-7"><a href="#cb27-7"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="#cb27-8"></a>  <span class="fu">create_var_from_codelist</span>(</span>
<span id="cb27-9"><a href="#cb27-9"></a>    metacore,</span>
<span id="cb27-10"><a href="#cb27-10"></a>    <span class="at">input_var =</span> PARAMCD,</span>
<span id="cb27-11"><a href="#cb27-11"></a>    <span class="at">out_var =</span> PARAMN</span>
<span id="cb27-12"><a href="#cb27-12"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-94a08bcacea55759b9f0" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-94a08bcacea55759b9f0">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024","01-716-1024"],"VSTESTCD":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"PARAMCD":["BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BMI","BSA","BSA","BSA","BSA","BSA","BSA","BSA","BSA"],"PARAM":["Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Mass Index (kg/m^2)","Body Surface Area (m^2)","Body Surface Area (m^2)","Body Surface Area (m^2)","Body Surface Area (m^2)","Body Surface Area (m^2)","Body Surface Area (m^2)","Body Surface Area (m^2)","Body Surface Area (m^2)"],"PARAMN":[8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"VSTESTCD","name":"VSTESTCD","type":"character"},{"id":"PARAMCD","name":"PARAMCD","type":"character"},{"id":"PARAM","name":"PARAM","type":"character"},{"id":"PARAMN","name":"PARAMN","type":"numeric"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"704eba0615c1f66757e465e09622ec24"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="addadsl" class="level2">
<h2 class="anchored" data-anchor-id="addadsl">Add ADSL variables</h2>
<p>If needed, the other <code>ADSL</code> variables can now be added. List of ADSL variables already merged held in vector <code>adsl_vars</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb28-3"><a href="#cb28-3"></a>    <span class="at">dataset_add =</span> <span class="fu">select</span>(adsl, <span class="sc">!!!</span><span class="fu">negate_vars</span>(adsl_vars)),</span>
<span id="cb28-4"><a href="#cb28-4"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID)</span>
<span id="cb28-5"><a href="#cb28-5"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:16px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Sample of Data</h1>
<div class="reactable html-widget html-fill-item" id="htmlwidget-81afcca8c3386d3e0827" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-81afcca8c3386d3e0827">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"USUBJID":["01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015","01-701-1015"],"RFSTDTC":["2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02","2014-01-02"],"RFENDTC":["2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02","2014-07-02"],"DTHDTC":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"DTHFL":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"AGE":[63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63],"AGEU":["YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS","YEARS"]},"columns":[{"id":"USUBJID","name":"USUBJID","type":"character"},{"id":"RFSTDTC","name":"RFSTDTC","type":"character"},{"id":"RFENDTC","name":"RFENDTC","type":"character"},{"id":"DTHDTC","name":"DTHDTC","type":"character"},{"id":"DTHFL","name":"DTHFL","type":"character"},{"id":"AGE","name":"AGE","type":"numeric"},{"id":"AGEU","name":"AGEU","type":"character"}],"defaultPageSize":5,"highlight":true,"bordered":true,"striped":true,"compact":true,"nowrap":true,"theme":{"color":"#333","backgroundColor":"white","borderColor":"#ddd","stripedColor":"#f8f9fa","highlightColor":"#dfe6f2","cellPadding":"8px"},"dataKey":"d0b170328a6cb91c8575f71ec5cee18f"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="metacore_xportr" class="level1">
<h1>Apply Metadata and eSub Checks</h1>
<p>We use <code>{metatools}</code> and <code>{xportr}</code> to perform checks, apply metadata such as types, lengths, labels, and write the dataset to an XPT file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">tempdir</span>() <span class="co"># Specify the directory for saving the XPT file</span></span>
<span id="cb29-2"><a href="#cb29-2"></a></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="co"># Apply metadata and perform checks</span></span>
<span id="cb29-4"><a href="#cb29-4"></a>advs_prefinal <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>  <span class="fu">drop_unspec_vars</span>(metacore) <span class="sc">%&gt;%</span> <span class="co"># Drop unspecified variables from specs</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>  <span class="fu">check_variables</span>(metacore, <span class="at">dataset_name =</span> <span class="st">"ADVS"</span>) <span class="sc">%&gt;%</span> <span class="co"># Check all variables specified are present and no more</span></span>
<span id="cb29-7"><a href="#cb29-7"></a>  <span class="fu">order_cols</span>(metacore) <span class="sc">%&gt;%</span> <span class="co"># Orders the columns according to the spec</span></span>
<span id="cb29-8"><a href="#cb29-8"></a>  <span class="fu">sort_by_key</span>(metacore) <span class="co"># Sorts the rows by the sort keys</span></span>
<span id="cb29-9"><a href="#cb29-9"></a></span>
<span id="cb29-10"><a href="#cb29-10"></a><span class="co"># Apply apply labels, formats, and export the dataset to an XPT file.</span></span>
<span id="cb29-11"><a href="#cb29-11"></a>advs_final <span class="ot">&lt;-</span> advs_prefinal <span class="sc">%&gt;%</span></span>
<span id="cb29-12"><a href="#cb29-12"></a>  <span class="fu">xportr_type</span>(metacore) <span class="sc">%&gt;%</span></span>
<span id="cb29-13"><a href="#cb29-13"></a>  <span class="fu">xportr_length</span>(metacore) <span class="sc">%&gt;%</span></span>
<span id="cb29-14"><a href="#cb29-14"></a>  <span class="fu">xportr_label</span>(metacore) <span class="sc">%&gt;%</span></span>
<span id="cb29-15"><a href="#cb29-15"></a>  <span class="fu">xportr_format</span>(metacore, <span class="at">domain =</span> <span class="st">"ADVS"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-16"><a href="#cb29-16"></a>  <span class="fu">xportr_df_label</span>(metacore, <span class="at">domain =</span> <span class="st">"ADVS"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-17"><a href="#cb29-17"></a>  <span class="fu">xportr_write</span>(<span class="fu">file.path</span>(dir, <span class="st">"advs.xpt"</span>), <span class="at">metadata =</span> metacore, <span class="at">domain =</span> <span class="st">"ADVS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/pharmaverse\.github\.io\/examples\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation column-page-right">
  <div class="nav-page nav-page-previous">
      <a href="../adam/adtte.html" class="pagination-link" aria-label="ADTTE">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">ADTTE</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../adam/adae.html" class="pagination-link" aria-label="ADAE">
        <span class="nav-page-text">ADAE</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb30" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb30-1"><a href="#cb30-1"></a><span class="co">---</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="an">title:</span><span class="co"> "ADVS"</span></span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="an">order:</span><span class="co"> 6</span></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="co">---</span></span>
<span id="cb30-5"><a href="#cb30-5"></a></span>
<span id="cb30-6"><a href="#cb30-6"></a><span class="in">```{r setup script, include=FALSE, purl=FALSE}</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>invisible_hook_purl <span class="ot">&lt;-</span> <span class="cf">function</span>(before, options, ...) {</span>
<span id="cb30-8"><a href="#cb30-8"></a>  knitr<span class="sc">::</span><span class="fu">hook_purl</span>(before, options, ...)</span>
<span id="cb30-9"><a href="#cb30-9"></a>  <span class="cn">NULL</span></span>
<span id="cb30-10"><a href="#cb30-10"></a>}</span>
<span id="cb30-11"><a href="#cb30-11"></a>knitr<span class="sc">::</span>knit_hooks<span class="sc">$</span><span class="fu">set</span>(<span class="at">purl =</span> invisible_hook_purl)</span>
<span id="cb30-12"><a href="#cb30-12"></a><span class="fu">source</span>(<span class="st">"functions/print_df.R"</span>)</span>
<span id="cb30-13"><a href="#cb30-13"></a><span class="in">```</span></span>
<span id="cb30-14"><a href="#cb30-14"></a></span>
<span id="cb30-15"><a href="#cb30-15"></a><span class="fu"># Introduction</span></span>
<span id="cb30-16"><a href="#cb30-16"></a></span>
<span id="cb30-17"><a href="#cb30-17"></a>This article provides a step-by-step explanation for creating an ADaM <span class="in">`ADVS`</span> (Vital Signs) dataset using key pharmaverse packages along with tidyverse components.</span>
<span id="cb30-18"><a href="#cb30-18"></a></span>
<span id="cb30-19"><a href="#cb30-19"></a>For the purpose of this example, we will use the <span class="in">`ADSL`</span> dataset from <span class="in">`{pharmaverseadam}`</span> and <span class="in">`vs`</span> domain from <span class="in">`{pharmaversesdtm}`</span>.</span>
<span id="cb30-20"><a href="#cb30-20"></a></span>
<span id="cb30-21"><a href="#cb30-21"></a><span class="fu">## Programming Flow</span></span>
<span id="cb30-22"><a href="#cb30-22"></a></span>
<span id="cb30-23"><a href="#cb30-23"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Load Data and Required pharmaverse Packages</span><span class="co">](#loaddata)</span></span>
<span id="cb30-24"><a href="#cb30-24"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Load Specifications for Metacore</span><span class="co">](#loadspecs)</span></span>
<span id="cb30-25"><a href="#cb30-25"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Select ADSL Variables</span><span class="co">](#adslvars)</span></span>
<span id="cb30-26"><a href="#cb30-26"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Start Building Derivations</span><span class="co">](#startbuild)</span></span>
<span id="cb30-27"><a href="#cb30-27"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Assign `PARAMCD`, `PARAM`, `PARAMN`</span><span class="co">](#paramvars)</span></span>
<span id="cb30-28"><a href="#cb30-28"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Derive Results and Units (`AVAL`, `AVALU`)</span><span class="co">](#avalvars)</span></span>
<span id="cb30-29"><a href="#cb30-29"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Derive Additional Parameters (e.g. `MAP`, `BMI` or `BSA` for `ADVS`)</span><span class="co">](#addparams)</span></span>
<span id="cb30-30"><a href="#cb30-30"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Derive Timing Variables (e.g. `AVISIT`, `ATPT`, `ATPTN`)</span><span class="co">](#timingvars)</span></span>
<span id="cb30-31"><a href="#cb30-31"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Derive summary records (e.g. mean of the triplicates at each time point)</span><span class="co">](#summaryrec)</span></span>
<span id="cb30-32"><a href="#cb30-32"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Timing Flag Variables (e.g. `ONTRTFL`)</span><span class="co">](#ontrtfl)</span></span>
<span id="cb30-33"><a href="#cb30-33"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Assign Reference Range Indicator (`ANRIND`)</span><span class="co">](#rangeind)</span></span>
<span id="cb30-34"><a href="#cb30-34"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Derive Baseline (`BASETYPE`, `ABLFL`, `BASE`, `BNRIND`)</span><span class="co">](#baselinevars)</span></span>
<span id="cb30-35"><a href="#cb30-35"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Derive Change from Baseline (`CHG`, `PCHG`)</span><span class="co">](#chgpchg)</span></span>
<span id="cb30-36"><a href="#cb30-36"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Derive Analysis Flags (e.g. `ANL01FL`)</span><span class="co">](#anl01fl)</span></span>
<span id="cb30-37"><a href="#cb30-37"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Assign Treatment (`TRTA`, `TRTP`)</span><span class="co">](#treatmentvars)</span></span>
<span id="cb30-38"><a href="#cb30-38"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Assign `ASEQ`</span><span class="co">](#aseq)</span></span>
<span id="cb30-39"><a href="#cb30-39"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Derive Categorization Variables (`AVALCATy`)</span><span class="co">](#categorizationvars)</span></span>
<span id="cb30-40"><a href="#cb30-40"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Assign Parameter Level Values (`PARAM`, `PARAMN`)</span><span class="co">](#paramval)</span></span>
<span id="cb30-41"><a href="#cb30-41"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Add ADSL variables</span><span class="co">](#addadsl)</span></span>
<span id="cb30-42"><a href="#cb30-42"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Apply Metadata and eSub Checks</span><span class="co">](#metacore_xportr)</span></span>
<span id="cb30-43"><a href="#cb30-43"></a></span>
<span id="cb30-44"><a href="#cb30-44"></a><span class="fu"># Load Data and Required pharmaverse Packages {#loaddata}</span></span>
<span id="cb30-45"><a href="#cb30-45"></a></span>
<span id="cb30-46"><a href="#cb30-46"></a>First we will load the packages required for our project. We will use <span class="in">`{admiral}`</span> for the creation of analysis data. <span class="in">`{admiral}`</span> requires <span class="in">`{dplyr}`</span>, <span class="in">`{lubridate}`</span> and <span class="in">`{stringr}`</span>. Find <span class="in">`{admiral}`</span> functions and related variables by searching <span class="co">[</span><span class="ot">admiraldiscovery</span><span class="co">](&lt;https://pharmaverse.github.io/admiraldiscovery/articles/reactable.html&gt;)</span>. We will use <span class="in">`{metacore}`</span> and <span class="in">`{metatools}`</span> to store and manipulate metadata from our specifications. We will use <span class="in">`{xportr}`</span> to perform checks on the final data and export to a transport file.</span>
<span id="cb30-47"><a href="#cb30-47"></a></span>
<span id="cb30-48"><a href="#cb30-48"></a>Then we will load our input data.</span>
<span id="cb30-49"><a href="#cb30-49"></a></span>
<span id="cb30-50"><a href="#cb30-50"></a><span class="in">```{r setup, message=FALSE, warning=FALSE, results='hold'}</span></span>
<span id="cb30-51"><a href="#cb30-51"></a><span class="fu">library</span>(metacore)</span>
<span id="cb30-52"><a href="#cb30-52"></a><span class="fu">library</span>(metatools)</span>
<span id="cb30-53"><a href="#cb30-53"></a><span class="fu">library</span>(pharmaversesdtm)</span>
<span id="cb30-54"><a href="#cb30-54"></a><span class="fu">library</span>(admiral)</span>
<span id="cb30-55"><a href="#cb30-55"></a><span class="fu">library</span>(xportr)</span>
<span id="cb30-56"><a href="#cb30-56"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb30-57"><a href="#cb30-57"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb30-58"><a href="#cb30-58"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb30-59"><a href="#cb30-59"></a><span class="fu">library</span>(stringr)</span>
<span id="cb30-60"><a href="#cb30-60"></a></span>
<span id="cb30-61"><a href="#cb30-61"></a><span class="co"># Read in input data</span></span>
<span id="cb30-62"><a href="#cb30-62"></a>adsl <span class="ot">&lt;-</span> pharmaverseadam<span class="sc">::</span>adsl</span>
<span id="cb30-63"><a href="#cb30-63"></a>vs <span class="ot">&lt;-</span> pharmaversesdtm<span class="sc">::</span>vs</span>
<span id="cb30-64"><a href="#cb30-64"></a></span>
<span id="cb30-65"><a href="#cb30-65"></a>vs <span class="ot">&lt;-</span> <span class="fu">convert_blanks_to_na</span>(vs)</span>
<span id="cb30-66"><a href="#cb30-66"></a><span class="in">```</span></span>
<span id="cb30-67"><a href="#cb30-67"></a></span>
<span id="cb30-68"><a href="#cb30-68"></a><span class="fu"># Load Specifications for Metacore {#loadspecs}</span></span>
<span id="cb30-69"><a href="#cb30-69"></a></span>
<span id="cb30-70"><a href="#cb30-70"></a>We have saved our specifications in an Excel file and will load them into <span class="in">`{metacore}`</span> with the <span class="in">`metacore::spec_to_metacore()`</span> function.</span>
<span id="cb30-71"><a href="#cb30-71"></a></span>
<span id="cb30-72"><a href="#cb30-72"></a><span class="in">```{r echo=TRUE}</span></span>
<span id="cb30-73"><a href="#cb30-73"></a><span class="co">#| label: Load Specs</span></span>
<span id="cb30-74"><a href="#cb30-74"></a><span class="co">#| warning: false</span></span>
<span id="cb30-75"><a href="#cb30-75"></a><span class="co"># ---- Load Specs for Metacore ----</span></span>
<span id="cb30-76"><a href="#cb30-76"></a>metacore <span class="ot">&lt;-</span> <span class="fu">spec_to_metacore</span>(</span>
<span id="cb30-77"><a href="#cb30-77"></a>  <span class="at">path =</span> <span class="st">"./metadata/safety_specs.xlsx"</span>,</span>
<span id="cb30-78"><a href="#cb30-78"></a>  <span class="co"># All datasets are described in the same sheet</span></span>
<span id="cb30-79"><a href="#cb30-79"></a>  <span class="at">where_sep_sheet =</span> <span class="cn">FALSE</span></span>
<span id="cb30-80"><a href="#cb30-80"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb30-81"><a href="#cb30-81"></a>  <span class="fu">select_dataset</span>(<span class="st">"ADVS"</span>)</span>
<span id="cb30-82"><a href="#cb30-82"></a><span class="in">```</span></span>
<span id="cb30-83"><a href="#cb30-83"></a></span>
<span id="cb30-84"><a href="#cb30-84"></a><span class="fu"># Select ADSL Variables {#adslvars}</span></span>
<span id="cb30-85"><a href="#cb30-85"></a></span>
<span id="cb30-86"><a href="#cb30-86"></a>Some variables from the <span class="in">`ADSL`</span> dataset required for the derivations are merged into the <span class="in">`VS`</span> domain using the <span class="in">`admiral::derive_vars_merged()`</span> function.</span>
<span id="cb30-87"><a href="#cb30-87"></a>The rest of the relevant <span class="in">`ADSL`</span> variables would be added later.</span>
<span id="cb30-88"><a href="#cb30-88"></a></span>
<span id="cb30-91"><a href="#cb30-91"></a><span class="in">```{r}</span></span>
<span id="cb30-92"><a href="#cb30-92"></a><span class="co"># Select required ADSL variables</span></span>
<span id="cb30-93"><a href="#cb30-93"></a>adsl_vars <span class="ot">&lt;-</span> <span class="fu">exprs</span>(TRTSDT, TRTEDT, TRT01A, TRT01P)</span>
<span id="cb30-94"><a href="#cb30-94"></a></span>
<span id="cb30-95"><a href="#cb30-95"></a><span class="co"># Join ADSL variables with VS</span></span>
<span id="cb30-96"><a href="#cb30-96"></a>advs <span class="ot">&lt;-</span> vs <span class="sc">%&gt;%</span></span>
<span id="cb30-97"><a href="#cb30-97"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb30-98"><a href="#cb30-98"></a>    <span class="at">dataset_add =</span> adsl,</span>
<span id="cb30-99"><a href="#cb30-99"></a>    <span class="at">new_vars =</span> adsl_vars,</span>
<span id="cb30-100"><a href="#cb30-100"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID)</span>
<span id="cb30-101"><a href="#cb30-101"></a>  )</span>
<span id="cb30-102"><a href="#cb30-102"></a><span class="in">```</span></span>
<span id="cb30-103"><a href="#cb30-103"></a></span>
<span id="cb30-104"><a href="#cb30-104"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-105"><a href="#cb30-105"></a><span class="fu">print_df</span>(advs, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb30-106"><a href="#cb30-106"></a><span class="in">```</span></span>
<span id="cb30-107"><a href="#cb30-107"></a></span>
<span id="cb30-108"><a href="#cb30-108"></a><span class="fu"># Start Building Derivations {#startbuild}</span></span>
<span id="cb30-109"><a href="#cb30-109"></a></span>
<span id="cb30-110"><a href="#cb30-110"></a>The first derivation step we are going to do is to compute the Analysis Date and Relative Analysis Day with the variables merged from <span class="in">`ADSL`</span> dataset.</span>
<span id="cb30-111"><a href="#cb30-111"></a>The resulting dataset has the 2 columns created.</span>
<span id="cb30-112"><a href="#cb30-112"></a></span>
<span id="cb30-115"><a href="#cb30-115"></a><span class="in">```{r}</span></span>
<span id="cb30-116"><a href="#cb30-116"></a><span class="co"># Calculate ADT, ADY</span></span>
<span id="cb30-117"><a href="#cb30-117"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb30-118"><a href="#cb30-118"></a>  <span class="fu">derive_vars_dt</span>(</span>
<span id="cb30-119"><a href="#cb30-119"></a>    <span class="at">new_vars_prefix =</span> <span class="st">"A"</span>,</span>
<span id="cb30-120"><a href="#cb30-120"></a>    <span class="at">dtc =</span> VSDTC,</span>
<span id="cb30-121"><a href="#cb30-121"></a>    <span class="co"># Below arguments are default values and not necessary to add in our case</span></span>
<span id="cb30-122"><a href="#cb30-122"></a>    <span class="at">highest_imputation =</span> <span class="st">"n"</span>, <span class="co"># means no imputation is performed on partial/missing dates</span></span>
<span id="cb30-123"><a href="#cb30-123"></a>    <span class="at">flag_imputation =</span> <span class="st">"auto"</span> <span class="co"># To automatically create ADTF variable when highest_imputation is "Y", "M" or "D"</span></span>
<span id="cb30-124"><a href="#cb30-124"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-125"><a href="#cb30-125"></a>  <span class="fu">derive_vars_dy</span>(</span>
<span id="cb30-126"><a href="#cb30-126"></a>    <span class="at">reference_date =</span> TRTSDT,</span>
<span id="cb30-127"><a href="#cb30-127"></a>    <span class="at">source_vars =</span> <span class="fu">exprs</span>(ADT)</span>
<span id="cb30-128"><a href="#cb30-128"></a>  )</span>
<span id="cb30-129"><a href="#cb30-129"></a><span class="in">```</span></span>
<span id="cb30-130"><a href="#cb30-130"></a></span>
<span id="cb30-131"><a href="#cb30-131"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-132"><a href="#cb30-132"></a><span class="fu">print_df</span>(advs <span class="sc">%&gt;%</span> <span class="fu">select</span>(STUDYID, USUBJID, VISIT, VISITNUM, VSTESTCD, VSTEST, VSDTC, <span class="sc">!!!</span>adsl_vars, ADT, ADY), <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb30-133"><a href="#cb30-133"></a><span class="in">```</span></span>
<span id="cb30-134"><a href="#cb30-134"></a></span>
<span id="cb30-135"><a href="#cb30-135"></a><span class="fu">## Assign `PARAMCD`, `PARAM`, `PARAMN` {#paramvars}</span></span>
<span id="cb30-136"><a href="#cb30-136"></a></span>
<span id="cb30-137"><a href="#cb30-137"></a>To assign parameter level values such as <span class="in">`PARAMCD`</span>, <span class="in">`PARAM`</span>, <span class="in">`PARAMN`</span>,</span>
<span id="cb30-138"><a href="#cb30-138"></a>etc., a lookup can be created to join to the source data.</span>
<span id="cb30-139"><a href="#cb30-139"></a></span>
<span id="cb30-140"><a href="#cb30-140"></a>For example, when creating <span class="in">`ADVS`</span>, a lookup based on the SDTM <span class="in">`--TESTCD`</span> value </span>
<span id="cb30-141"><a href="#cb30-141"></a>may be created:</span>
<span id="cb30-142"><a href="#cb30-142"></a></span>
<span id="cb30-143"><a href="#cb30-143"></a><span class="in">`VSTESTCD`</span> | <span class="in">`PARAMCD`</span> | <span class="in">`PARAM`</span> | <span class="in">`PARAMN`</span> </span>
<span id="cb30-144"><a href="#cb30-144"></a>--------- | --------- | -------- | ------- </span>
<span id="cb30-145"><a href="#cb30-145"></a>SYSBP | SYSBP | Systolic Blood Pressure (mmHg) | 1</span>
<span id="cb30-146"><a href="#cb30-146"></a>DIABP | DIABP | Diastolic Blood Pressure (mmHg) | 2</span>
<span id="cb30-147"><a href="#cb30-147"></a>PULSE | PULSE | Pulse Rate (beats/min) | 3</span>
<span id="cb30-148"><a href="#cb30-148"></a>WEIGHT | WEIGHT | Weight (kg) | 4</span>
<span id="cb30-149"><a href="#cb30-149"></a>HEIGHT | HEIGHT | Height (cm) | 5</span>
<span id="cb30-150"><a href="#cb30-150"></a>TEMP | TEMP | Temperature (C) | 6</span>
<span id="cb30-151"><a href="#cb30-151"></a>MAP | MAP | Mean Arterial Pressure | 7</span>
<span id="cb30-152"><a href="#cb30-152"></a>BMI | BMI | Body Mass Index(kg/m^2) | 8</span>
<span id="cb30-153"><a href="#cb30-153"></a>BSA | BSA | Body Surface Area(m^2) | 9</span>
<span id="cb30-154"><a href="#cb30-154"></a></span>
<span id="cb30-155"><a href="#cb30-155"></a>This lookup may now be joined to the source data:</span>
<span id="cb30-156"><a href="#cb30-156"></a></span>
<span id="cb30-157"><a href="#cb30-157"></a><span class="in">```{r eval=TRUE, include=FALSE}</span></span>
<span id="cb30-158"><a href="#cb30-158"></a>param_lookup <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb30-159"><a href="#cb30-159"></a>  <span class="sc">~</span>VSTESTCD, <span class="sc">~</span>PARAMCD, <span class="sc">~</span>PARAM, <span class="sc">~</span>PARAMN,</span>
<span id="cb30-160"><a href="#cb30-160"></a>  <span class="st">"SYSBP"</span>, <span class="st">"SYSBP"</span>, <span class="st">" Systolic Blood Pressure (mmHg)"</span>, <span class="dv">1</span>,</span>
<span id="cb30-161"><a href="#cb30-161"></a>  <span class="st">"DIABP"</span>, <span class="st">"DIABP"</span>, <span class="st">"Diastolic Blood Pressure (mmHg)"</span>, <span class="dv">2</span>,</span>
<span id="cb30-162"><a href="#cb30-162"></a>  <span class="st">"PULSE"</span>, <span class="st">"PULSE"</span>, <span class="st">"Pulse Rate (beats/min)"</span>, <span class="dv">3</span>,</span>
<span id="cb30-163"><a href="#cb30-163"></a>  <span class="st">"WEIGHT"</span>, <span class="st">"WEIGHT"</span>, <span class="st">"Weight (kg)"</span>, <span class="dv">4</span>,</span>
<span id="cb30-164"><a href="#cb30-164"></a>  <span class="st">"HEIGHT"</span>, <span class="st">"HEIGHT"</span>, <span class="st">"Height (cm)"</span>, <span class="dv">5</span>,</span>
<span id="cb30-165"><a href="#cb30-165"></a>  <span class="st">"TEMP"</span>, <span class="st">"TEMP"</span>, <span class="st">"Temperature (C)"</span>, <span class="dv">6</span>,</span>
<span id="cb30-166"><a href="#cb30-166"></a>  <span class="st">"MAP"</span>, <span class="st">"MAP"</span>, <span class="st">"Mean Arterial Pressure (mmHg)"</span>, <span class="dv">7</span>,</span>
<span id="cb30-167"><a href="#cb30-167"></a>  <span class="st">"BMI"</span>, <span class="st">"BMI"</span>, <span class="st">"Body Mass Index(kg/m^2)"</span>, <span class="dv">8</span>,</span>
<span id="cb30-168"><a href="#cb30-168"></a>  <span class="st">"BSA"</span>, <span class="st">"BSA"</span>, <span class="st">"Body Surface Area(m^2)"</span>, <span class="dv">9</span></span>
<span id="cb30-169"><a href="#cb30-169"></a>)</span>
<span id="cb30-170"><a href="#cb30-170"></a><span class="fu">attr</span>(param_lookup<span class="sc">$</span>VSTESTCD, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Vital Signs Test Short Name"</span></span>
<span id="cb30-171"><a href="#cb30-171"></a><span class="in">```</span></span>
<span id="cb30-172"><a href="#cb30-172"></a></span>
<span id="cb30-173"><a href="#cb30-173"></a>At this stage, only <span class="in">`PARAMCD`</span> is required to perform the derivations. Additional</span>
<span id="cb30-174"><a href="#cb30-174"></a>derived parameters may be added, so only <span class="in">`PARAMCD`</span> is joined to the datasets at</span>
<span id="cb30-175"><a href="#cb30-175"></a>this point. All other variables related to <span class="in">`PARAMCD`</span> (e.g. <span class="in">`PARAM`</span>, <span class="in">`PARAMN`</span>, ...)</span>
<span id="cb30-176"><a href="#cb30-176"></a>will be added when all <span class="in">`PARAMCD`</span> are derived.</span>
<span id="cb30-177"><a href="#cb30-177"></a></span>
<span id="cb30-180"><a href="#cb30-180"></a><span class="in">```{r}</span></span>
<span id="cb30-181"><a href="#cb30-181"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb30-182"><a href="#cb30-182"></a>  <span class="co"># Add PARAMCD only - add PARAM etc later</span></span>
<span id="cb30-183"><a href="#cb30-183"></a>  <span class="fu">derive_vars_merged_lookup</span>(</span>
<span id="cb30-184"><a href="#cb30-184"></a>    <span class="at">dataset_add =</span> param_lookup,</span>
<span id="cb30-185"><a href="#cb30-185"></a>    <span class="at">new_vars =</span> <span class="fu">exprs</span>(PARAMCD),</span>
<span id="cb30-186"><a href="#cb30-186"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(VSTESTCD),</span>
<span id="cb30-187"><a href="#cb30-187"></a>    <span class="co"># Below arguments are default values and not necessary to add in our case</span></span>
<span id="cb30-188"><a href="#cb30-188"></a>    <span class="at">print_not_mapped =</span> <span class="cn">TRUE</span> <span class="co"># Printing whether some parameters are not mapped</span></span>
<span id="cb30-189"><a href="#cb30-189"></a>  )</span>
<span id="cb30-190"><a href="#cb30-190"></a><span class="in">```</span></span>
<span id="cb30-191"><a href="#cb30-191"></a></span>
<span id="cb30-192"><a href="#cb30-192"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-193"><a href="#cb30-193"></a><span class="fu">print_df</span>(advs <span class="sc">%&gt;%</span> <span class="fu">select</span>(STUDYID, USUBJID, VISIT, VISITNUM, VSTESTCD, VSTEST, VSDTC, <span class="sc">!!!</span>adsl_vars, ADT, ADY, PARAMCD), <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb30-194"><a href="#cb30-194"></a><span class="in">```</span></span>
<span id="cb30-195"><a href="#cb30-195"></a></span>
<span id="cb30-196"><a href="#cb30-196"></a><span class="fu">## Derive Results and Units (`AVAL`, `AVALU`) {#avalvars}</span></span>
<span id="cb30-197"><a href="#cb30-197"></a></span>
<span id="cb30-198"><a href="#cb30-198"></a>The mapping of <span class="in">`AVAL`</span> and <span class="in">`AVALU`</span> is left to the ADaM programmer. An </span>
<span id="cb30-199"><a href="#cb30-199"></a>example mapping may be:</span>
<span id="cb30-200"><a href="#cb30-200"></a></span>
<span id="cb30-201"><a href="#cb30-201"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-202"><a href="#cb30-202"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb30-203"><a href="#cb30-203"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-204"><a href="#cb30-204"></a>    <span class="at">AVAL =</span> VSSTRESN,</span>
<span id="cb30-205"><a href="#cb30-205"></a>    <span class="at">AVALU =</span> VSSTRESU</span>
<span id="cb30-206"><a href="#cb30-206"></a>  )</span>
<span id="cb30-207"><a href="#cb30-207"></a><span class="in">```</span></span>
<span id="cb30-208"><a href="#cb30-208"></a></span>
<span id="cb30-209"><a href="#cb30-209"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-210"><a href="#cb30-210"></a><span class="fu">print_df</span>(advs <span class="sc">%&gt;%</span> <span class="fu">select</span>(STUDYID, USUBJID, VISIT, VISITNUM, VSTESTCD, VSTEST, VSDTC, <span class="sc">!!!</span>adsl_vars, ADT, ADY, PARAMCD, AVAL, AVALU), <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb30-211"><a href="#cb30-211"></a><span class="in">```</span></span>
<span id="cb30-212"><a href="#cb30-212"></a></span>
<span id="cb30-213"><a href="#cb30-213"></a>In this example, as is often the case for ADVS, all <span class="in">`AVAL`</span> values are numeric without any corresponding non-redundant text value for <span class="in">`AVALC`</span>.</span>
<span id="cb30-214"><a href="#cb30-214"></a>Per recommendation in ADaMIG v1.3 we do not map <span class="in">`AVALC`</span>.</span>
<span id="cb30-215"><a href="#cb30-215"></a></span>
<span id="cb30-216"><a href="#cb30-216"></a><span class="fu">## Derive Additional Parameters (e.g. `MAP`, `BMI` or `BSA` for `ADVS`) {#addparams}</span></span>
<span id="cb30-217"><a href="#cb30-217"></a></span>
<span id="cb30-218"><a href="#cb30-218"></a>Optionally derive new parameters creating <span class="in">`PARAMCD`</span> and <span class="in">`AVAL`</span>. Note that only</span>
<span id="cb30-219"><a href="#cb30-219"></a>variables specified in the <span class="in">`by_vars`</span> argument will be populated in the newly </span>
<span id="cb30-220"><a href="#cb30-220"></a>created records. This is relevant to the functions <span class="in">`admiral::derive_param_map`</span>, </span>
<span id="cb30-221"><a href="#cb30-221"></a><span class="in">`admiral::derive_param_bsa`</span>, <span class="in">`admiral::derive_param_bmi`</span>, and <span class="in">`admiral::derive_param_qtc`</span>. </span>
<span id="cb30-222"><a href="#cb30-222"></a></span>
<span id="cb30-223"><a href="#cb30-223"></a>Below is an example of creating <span class="in">`Mean Arterial Pressure`</span> for <span class="in">`ADVS`</span> using the wrapper function <span class="in">`admiral::derive_param_map()`</span> </span>
<span id="cb30-224"><a href="#cb30-224"></a></span>
<span id="cb30-225"><a href="#cb30-225"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-226"><a href="#cb30-226"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb30-227"><a href="#cb30-227"></a>  <span class="fu">derive_param_map</span>(</span>
<span id="cb30-228"><a href="#cb30-228"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, <span class="sc">!!!</span>adsl_vars, VISIT, VISITNUM, ADT, ADY, VSTPT, VSTPTNUM, AVALU), <span class="co"># Other variables than the defined ones here won't be populated</span></span>
<span id="cb30-229"><a href="#cb30-229"></a>    <span class="at">set_values_to =</span> <span class="fu">exprs</span>(<span class="at">PARAMCD =</span> <span class="st">"MAP"</span>),</span>
<span id="cb30-230"><a href="#cb30-230"></a>    <span class="at">get_unit_expr =</span> VSSTRESU,</span>
<span id="cb30-231"><a href="#cb30-231"></a>    <span class="at">filter =</span> VSSTAT <span class="sc">!=</span> <span class="st">"NOT DONE"</span> <span class="sc">|</span> <span class="fu">is.na</span>(VSSTAT),</span>
<span id="cb30-232"><a href="#cb30-232"></a>    <span class="co"># Below arguments are default values and not necessary to add in our case</span></span>
<span id="cb30-233"><a href="#cb30-233"></a>    <span class="at">sysbp_code =</span> <span class="st">"SYSBP"</span>,</span>
<span id="cb30-234"><a href="#cb30-234"></a>    <span class="at">diabp_code =</span> <span class="st">"DIABP"</span>,</span>
<span id="cb30-235"><a href="#cb30-235"></a>    <span class="at">hr_code =</span> <span class="cn">NULL</span></span>
<span id="cb30-236"><a href="#cb30-236"></a>  )</span>
<span id="cb30-237"><a href="#cb30-237"></a><span class="in">```</span></span>
<span id="cb30-238"><a href="#cb30-238"></a></span>
<span id="cb30-239"><a href="#cb30-239"></a>Similarly we could create <span class="in">`Body Mass Index`</span> (BMI) for <span class="in">`ADVS`</span> using the wrapper function <span class="in">`admiral::derive_param_bmi()`</span>, instead we will see in below example</span>
<span id="cb30-240"><a href="#cb30-240"></a>how to use the more generic function <span class="in">`admiral::derive_param_computed()`</span></span>
<span id="cb30-241"><a href="#cb30-241"></a>Note that if height is collected only once use <span class="in">`constant_parameters`</span> to define the corresponding parameter which will be merged to the other parameters and <span class="in">`constant_by_vars`</span> to specify the subject-level variable to merge on.</span>
<span id="cb30-242"><a href="#cb30-242"></a>Otherwise BMI is only calculated for visits where both parameters <span class="in">`HEIGHT`</span> and <span class="in">`WEIGHT`</span> are collected.</span>
<span id="cb30-243"><a href="#cb30-243"></a></span>
<span id="cb30-244"><a href="#cb30-244"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-245"><a href="#cb30-245"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb30-246"><a href="#cb30-246"></a>  <span class="fu">derive_param_computed</span>(</span>
<span id="cb30-247"><a href="#cb30-247"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, VISIT, VISITNUM, ADT, ADY, VSTPT, VSTPTNUM),</span>
<span id="cb30-248"><a href="#cb30-248"></a>    <span class="at">parameters =</span> <span class="st">"WEIGHT"</span>,</span>
<span id="cb30-249"><a href="#cb30-249"></a>    <span class="at">set_values_to =</span> <span class="fu">exprs</span>(</span>
<span id="cb30-250"><a href="#cb30-250"></a>      <span class="at">AVAL =</span> AVAL.WEIGHT <span class="sc">/</span> (AVAL.HEIGHT <span class="sc">/</span> <span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb30-251"><a href="#cb30-251"></a>      <span class="at">PARAMCD =</span> <span class="st">"BMI"</span>,</span>
<span id="cb30-252"><a href="#cb30-252"></a>      <span class="at">AVALU =</span> <span class="st">"kg/m^2"</span></span>
<span id="cb30-253"><a href="#cb30-253"></a>    ),</span>
<span id="cb30-254"><a href="#cb30-254"></a>    <span class="at">constant_parameters =</span> <span class="fu">c</span>(<span class="st">"HEIGHT"</span>),</span>
<span id="cb30-255"><a href="#cb30-255"></a>    <span class="at">constant_by_vars =</span> <span class="fu">exprs</span>(USUBJID)</span>
<span id="cb30-256"><a href="#cb30-256"></a>  )</span>
<span id="cb30-257"><a href="#cb30-257"></a><span class="in">```</span></span>
<span id="cb30-258"><a href="#cb30-258"></a></span>
<span id="cb30-259"><a href="#cb30-259"></a>Likewise, wrapper function <span class="in">`admiral::derive_param_bsa()`</span> call below, to create parameter <span class="in">`Body Surface Area`</span> (BSA) for <span class="in">`ADVS`</span> domain.</span>
<span id="cb30-260"><a href="#cb30-260"></a>Note that if height is collected only once use <span class="in">`constant_by_vars`</span> to specify the subject-level variable to merge on.</span>
<span id="cb30-261"><a href="#cb30-261"></a>Otherwise BSA is only calculated for visits where both parameters <span class="in">`HEIGHT`</span> and <span class="in">`WEIGHT`</span> are collected.</span>
<span id="cb30-262"><a href="#cb30-262"></a></span>
<span id="cb30-263"><a href="#cb30-263"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-264"><a href="#cb30-264"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb30-265"><a href="#cb30-265"></a>  <span class="fu">derive_param_bsa</span>(</span>
<span id="cb30-266"><a href="#cb30-266"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, <span class="sc">!!!</span>adsl_vars, VISIT, VISITNUM, ADT, ADY, VSTPT, VSTPTNUM),</span>
<span id="cb30-267"><a href="#cb30-267"></a>    <span class="at">method =</span> <span class="st">"Mosteller"</span>,</span>
<span id="cb30-268"><a href="#cb30-268"></a>    <span class="at">set_values_to =</span> <span class="fu">exprs</span>(</span>
<span id="cb30-269"><a href="#cb30-269"></a>      <span class="at">PARAMCD =</span> <span class="st">"BSA"</span>,</span>
<span id="cb30-270"><a href="#cb30-270"></a>      <span class="at">AVALU =</span> <span class="st">"m^2"</span></span>
<span id="cb30-271"><a href="#cb30-271"></a>    ),</span>
<span id="cb30-272"><a href="#cb30-272"></a>    <span class="at">get_unit_expr =</span> VSSTRESU,</span>
<span id="cb30-273"><a href="#cb30-273"></a>    <span class="at">filter =</span> VSSTAT <span class="sc">!=</span> <span class="st">"NOT DONE"</span> <span class="sc">|</span> <span class="fu">is.na</span>(VSSTAT),</span>
<span id="cb30-274"><a href="#cb30-274"></a>    <span class="at">constant_by_vars =</span> <span class="fu">exprs</span>(USUBJID),</span>
<span id="cb30-275"><a href="#cb30-275"></a>    <span class="co"># Below arguments are default values and not necessary to add in our case</span></span>
<span id="cb30-276"><a href="#cb30-276"></a>    <span class="at">height_code =</span> <span class="st">"HEIGHT"</span>,</span>
<span id="cb30-277"><a href="#cb30-277"></a>    <span class="at">weight_code =</span> <span class="st">"WEIGHT"</span></span>
<span id="cb30-278"><a href="#cb30-278"></a>  )</span>
<span id="cb30-279"><a href="#cb30-279"></a><span class="in">```</span></span>
<span id="cb30-280"><a href="#cb30-280"></a></span>
<span id="cb30-281"><a href="#cb30-281"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-282"><a href="#cb30-282"></a><span class="fu">print_df</span>(advs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PARAMCD <span class="sc">==</span> <span class="st">"MAP"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(STUDYID, USUBJID, VSTESTCD, PARAMCD, VISIT, VSTPT, AVAL, AVALU), <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb30-283"><a href="#cb30-283"></a><span class="in">```</span></span>
<span id="cb30-284"><a href="#cb30-284"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-285"><a href="#cb30-285"></a><span class="fu">print_df</span>(advs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PARAMCD <span class="sc">==</span> <span class="st">"BMI"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(STUDYID, USUBJID, VSTESTCD, PARAMCD, VISIT, VSTPT, AVAL, AVALU), <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb30-286"><a href="#cb30-286"></a><span class="in">```</span></span>
<span id="cb30-287"><a href="#cb30-287"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-288"><a href="#cb30-288"></a><span class="fu">print_df</span>(advs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PARAMCD <span class="sc">==</span> <span class="st">"BSA"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(STUDYID, USUBJID, VSTESTCD, PARAMCD, VISIT, VSTPT, AVAL, AVALU), <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb30-289"><a href="#cb30-289"></a><span class="in">```</span></span>
<span id="cb30-290"><a href="#cb30-290"></a></span>
<span id="cb30-291"><a href="#cb30-291"></a><span class="fu">## Derive Timing Variables (e.g. `AVISIT`, `ATPT`, `ATPTN`) {#timingvars}</span></span>
<span id="cb30-292"><a href="#cb30-292"></a></span>
<span id="cb30-293"><a href="#cb30-293"></a>Categorical timing variables are protocol and analysis dependent. Below is a simple example. </span>
<span id="cb30-294"><a href="#cb30-294"></a></span>
<span id="cb30-295"><a href="#cb30-295"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-296"><a href="#cb30-296"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb30-297"><a href="#cb30-297"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-298"><a href="#cb30-298"></a>    <span class="at">ATPTN =</span> VSTPTNUM,</span>
<span id="cb30-299"><a href="#cb30-299"></a>    <span class="at">ATPT =</span> VSTPT,</span>
<span id="cb30-300"><a href="#cb30-300"></a>    <span class="at">AVISIT =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-301"><a href="#cb30-301"></a>      <span class="fu">str_detect</span>(VISIT, <span class="st">"SCREEN|UNSCHED|RETRIEVAL|AMBUL"</span>) <span class="sc">~</span> <span class="cn">NA_character_</span>,</span>
<span id="cb30-302"><a href="#cb30-302"></a>      <span class="sc">!</span><span class="fu">is.na</span>(VISIT) <span class="sc">~</span> <span class="fu">str_to_title</span>(VISIT),</span>
<span id="cb30-303"><a href="#cb30-303"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb30-304"><a href="#cb30-304"></a>    ),</span>
<span id="cb30-305"><a href="#cb30-305"></a>    <span class="at">AVISITN =</span> <span class="fu">as.numeric</span>(<span class="fu">case_when</span>(</span>
<span id="cb30-306"><a href="#cb30-306"></a>      VISIT <span class="sc">==</span> <span class="st">"BASELINE"</span> <span class="sc">~</span> <span class="st">"0"</span>,</span>
<span id="cb30-307"><a href="#cb30-307"></a>      <span class="fu">str_detect</span>(VISIT, <span class="st">"WEEK"</span>) <span class="sc">~</span> <span class="fu">str_trim</span>(<span class="fu">str_replace</span>(VISIT, <span class="st">"WEEK"</span>, <span class="st">""</span>)),</span>
<span id="cb30-308"><a href="#cb30-308"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb30-309"><a href="#cb30-309"></a>    ))</span>
<span id="cb30-310"><a href="#cb30-310"></a>  )</span>
<span id="cb30-311"><a href="#cb30-311"></a><span class="in">```</span></span>
<span id="cb30-312"><a href="#cb30-312"></a></span>
<span id="cb30-313"><a href="#cb30-313"></a>For assigning visits based on time windows and deriving periods, subperiods, and phase variables see</span>
<span id="cb30-314"><a href="#cb30-314"></a>the <span class="co">[</span><span class="ot">"Visit and Period Variables" vignette</span><span class="co">](visits_periods.html)</span>.</span>
<span id="cb30-315"><a href="#cb30-315"></a></span>
<span id="cb30-316"><a href="#cb30-316"></a><span class="fu">## Derive summary records (e.g. mean of the triplicates at each time point) {#summaryrec}</span></span>
<span id="cb30-317"><a href="#cb30-317"></a></span>
<span id="cb30-318"><a href="#cb30-318"></a>For adding new records based on aggregating records <span class="in">`admiral::derive_summary_records()`</span></span>
<span id="cb30-319"><a href="#cb30-319"></a>can be used. For the new records only the variables specified by <span class="in">`by_vars`</span> and</span>
<span id="cb30-320"><a href="#cb30-320"></a><span class="in">`set_values_to`</span> are populated.</span>
<span id="cb30-321"><a href="#cb30-321"></a></span>
<span id="cb30-322"><a href="#cb30-322"></a>For each subject, Vital Signs parameter, visit, and date add a record holding</span>
<span id="cb30-323"><a href="#cb30-323"></a>the average value for observations on that date.</span>
<span id="cb30-324"><a href="#cb30-324"></a>Set <span class="in">`DTYPE`</span> to <span class="in">`AVERAGE`</span>.</span>
<span id="cb30-325"><a href="#cb30-325"></a></span>
<span id="cb30-326"><a href="#cb30-326"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-327"><a href="#cb30-327"></a>advs <span class="ot">&lt;-</span> <span class="fu">derive_summary_records</span>(</span>
<span id="cb30-328"><a href="#cb30-328"></a>  <span class="at">dataset =</span> advs,</span>
<span id="cb30-329"><a href="#cb30-329"></a>  <span class="at">dataset_add =</span> advs, <span class="co"># Observations from the specified dataset are going to be used to calculate and added as new records to the input dataset.</span></span>
<span id="cb30-330"><a href="#cb30-330"></a>  <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, <span class="sc">!!!</span>adsl_vars, PARAMCD, AVISITN, AVISIT, ADT, ADY, AVALU),</span>
<span id="cb30-331"><a href="#cb30-331"></a>  <span class="at">filter_add =</span> <span class="sc">!</span><span class="fu">is.na</span>(AVAL),</span>
<span id="cb30-332"><a href="#cb30-332"></a>  <span class="at">set_values_to =</span> <span class="fu">exprs</span>(</span>
<span id="cb30-333"><a href="#cb30-333"></a>    <span class="at">AVAL =</span> <span class="fu">mean</span>(AVAL),</span>
<span id="cb30-334"><a href="#cb30-334"></a>    <span class="at">DTYPE =</span> <span class="st">"AVERAGE"</span></span>
<span id="cb30-335"><a href="#cb30-335"></a>  )</span>
<span id="cb30-336"><a href="#cb30-336"></a>)</span>
<span id="cb30-337"><a href="#cb30-337"></a><span class="in">```</span></span>
<span id="cb30-338"><a href="#cb30-338"></a></span>
<span id="cb30-339"><a href="#cb30-339"></a><span class="fu">## Timing Flag Variables (e.g. `ONTRTFL`) {#ontrtfl}</span></span>
<span id="cb30-340"><a href="#cb30-340"></a></span>
<span id="cb30-341"><a href="#cb30-341"></a>In some analyses, it may be necessary to flag an observation as on-treatment.</span>
<span id="cb30-342"><a href="#cb30-342"></a>The admiral function <span class="in">`admiral::derive_var_ontrtfl()`</span> can be used.</span>
<span id="cb30-343"><a href="#cb30-343"></a></span>
<span id="cb30-344"><a href="#cb30-344"></a>For example, if on-treatment is defined as any observation between treatment</span>
<span id="cb30-345"><a href="#cb30-345"></a>start and treatment end, the flag may be derived as:</span>
<span id="cb30-346"><a href="#cb30-346"></a></span>
<span id="cb30-347"><a href="#cb30-347"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-348"><a href="#cb30-348"></a>advs <span class="ot">&lt;-</span> <span class="fu">derive_var_ontrtfl</span>(</span>
<span id="cb30-349"><a href="#cb30-349"></a>  advs,</span>
<span id="cb30-350"><a href="#cb30-350"></a>  <span class="at">start_date =</span> ADT,</span>
<span id="cb30-351"><a href="#cb30-351"></a>  <span class="at">ref_start_date =</span> TRTSDT,</span>
<span id="cb30-352"><a href="#cb30-352"></a>  <span class="at">ref_end_date =</span> TRTEDT,</span>
<span id="cb30-353"><a href="#cb30-353"></a>  <span class="at">filter_pre_timepoint =</span> <span class="fu">toupper</span>(AVISIT) <span class="sc">==</span> <span class="st">"BASELINE"</span> <span class="co"># Observations as not on-treatment</span></span>
<span id="cb30-354"><a href="#cb30-354"></a>)</span>
<span id="cb30-355"><a href="#cb30-355"></a><span class="in">```</span></span>
<span id="cb30-356"><a href="#cb30-356"></a></span>
<span id="cb30-357"><a href="#cb30-357"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-358"><a href="#cb30-358"></a><span class="fu">print_df</span>(advs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PARAMCD <span class="sc">==</span> <span class="st">"DIABP"</span> <span class="sc">&amp;</span> <span class="fu">toupper</span>(VISIT) <span class="sc">==</span> <span class="st">"WEEK 2"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, PARAMCD, ADT, TRTSDT, TRTEDT, ONTRTFL), <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb30-359"><a href="#cb30-359"></a><span class="in">```</span></span>
<span id="cb30-360"><a href="#cb30-360"></a></span>
<span id="cb30-361"><a href="#cb30-361"></a><span class="fu">## Assign Reference Range Indicator (`ANRIND`) {#rangeind}</span></span>
<span id="cb30-362"><a href="#cb30-362"></a></span>
<span id="cb30-363"><a href="#cb30-363"></a>The admiral function <span class="in">`derive_var_anrind()`</span> may be used to derive the reference</span>
<span id="cb30-364"><a href="#cb30-364"></a>range indicator <span class="in">`ANRIND`</span>.</span>
<span id="cb30-365"><a href="#cb30-365"></a></span>
<span id="cb30-366"><a href="#cb30-366"></a>This function requires the reference range boundaries to exist on the data frame </span>
<span id="cb30-367"><a href="#cb30-367"></a>(<span class="in">`ANRLO`</span>, <span class="in">`ANRHI`</span>) and also accommodates the additional boundaries <span class="in">`A1LO`</span> and <span class="in">`A1HI`</span>.</span>
<span id="cb30-368"><a href="#cb30-368"></a></span>
<span id="cb30-369"><a href="#cb30-369"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb30-370"><a href="#cb30-370"></a>range_lookup <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb30-371"><a href="#cb30-371"></a>  <span class="sc">~</span>PARAMCD, <span class="sc">~</span>ANRLO, <span class="sc">~</span>ANRHI, <span class="sc">~</span>A1LO, <span class="sc">~</span>A1HI,</span>
<span id="cb30-372"><a href="#cb30-372"></a>  <span class="st">"SYSBP"</span>,      <span class="dv">90</span>,    <span class="dv">130</span>,    <span class="dv">70</span>,   <span class="dv">140</span>,</span>
<span id="cb30-373"><a href="#cb30-373"></a>  <span class="st">"DIABP"</span>,      <span class="dv">60</span>,     <span class="dv">80</span>,    <span class="dv">40</span>,    <span class="dv">90</span>,</span>
<span id="cb30-374"><a href="#cb30-374"></a>  <span class="st">"PULSE"</span>,      <span class="dv">60</span>,    <span class="dv">100</span>,    <span class="dv">40</span>,   <span class="dv">110</span>,</span>
<span id="cb30-375"><a href="#cb30-375"></a>  <span class="st">"TEMP"</span>,     <span class="fl">36.5</span>,   <span class="fl">37.5</span>,    <span class="dv">35</span>,    <span class="dv">38</span></span>
<span id="cb30-376"><a href="#cb30-376"></a>)</span>
<span id="cb30-377"><a href="#cb30-377"></a></span>
<span id="cb30-378"><a href="#cb30-378"></a>advs <span class="ot">&lt;-</span> <span class="fu">derive_vars_merged</span>(</span>
<span id="cb30-379"><a href="#cb30-379"></a>  advs,</span>
<span id="cb30-380"><a href="#cb30-380"></a>  <span class="at">dataset_add =</span> range_lookup,</span>
<span id="cb30-381"><a href="#cb30-381"></a>  <span class="at">by_vars =</span> <span class="fu">exprs</span>(PARAMCD)</span>
<span id="cb30-382"><a href="#cb30-382"></a>)</span>
<span id="cb30-383"><a href="#cb30-383"></a><span class="in">```</span></span>
<span id="cb30-384"><a href="#cb30-384"></a></span>
<span id="cb30-385"><a href="#cb30-385"></a>The function is called as:</span>
<span id="cb30-386"><a href="#cb30-386"></a></span>
<span id="cb30-387"><a href="#cb30-387"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-388"><a href="#cb30-388"></a>advs <span class="ot">&lt;-</span> <span class="fu">derive_var_anrind</span>(</span>
<span id="cb30-389"><a href="#cb30-389"></a>  advs,</span>
<span id="cb30-390"><a href="#cb30-390"></a>  <span class="co"># Below arguments are default values and not necessary to add in our case</span></span>
<span id="cb30-391"><a href="#cb30-391"></a>  <span class="at">signif_dig =</span> <span class="fu">get_admiral_option</span>(<span class="st">"signif_digits"</span>),</span>
<span id="cb30-392"><a href="#cb30-392"></a>  <span class="at">use_a1hia1lo =</span> <span class="cn">FALSE</span></span>
<span id="cb30-393"><a href="#cb30-393"></a>)</span>
<span id="cb30-394"><a href="#cb30-394"></a><span class="in">```</span></span>
<span id="cb30-395"><a href="#cb30-395"></a></span>
<span id="cb30-396"><a href="#cb30-396"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-397"><a href="#cb30-397"></a><span class="fu">print_df</span>(advs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PARAMCD <span class="sc">==</span> <span class="st">"DIABP"</span> <span class="sc">&amp;</span> <span class="fu">toupper</span>(VISIT) <span class="sc">==</span> <span class="st">"WEEK 2"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, PARAMCD, AVAL, ANRLO, ANRHI, A1LO, A1HI, ANRIND), <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb30-398"><a href="#cb30-398"></a><span class="in">```</span></span>
<span id="cb30-399"><a href="#cb30-399"></a></span>
<span id="cb30-400"><a href="#cb30-400"></a><span class="fu">## Derive Baseline (`BASETYPE`, `ABLFL`, `BASE`, `BNRIND`) {#baselinevars}</span></span>
<span id="cb30-401"><a href="#cb30-401"></a></span>
<span id="cb30-402"><a href="#cb30-402"></a>The <span class="in">`BASETYPE`</span> should be derived using the function <span class="in">`admiral::derive_basetype_records()`</span>.</span>
<span id="cb30-403"><a href="#cb30-403"></a>The parameter <span class="in">`basetypes`</span> of this function requires a named list of expression </span>
<span id="cb30-404"><a href="#cb30-404"></a>detailing how the <span class="in">`BASETYPE`</span> should be assigned.  Note, if a record falls into</span>
<span id="cb30-405"><a href="#cb30-405"></a>multiple expressions within the basetypes expression, a row will be produced for </span>
<span id="cb30-406"><a href="#cb30-406"></a>each <span class="in">`BASETYPE`</span>.</span>
<span id="cb30-407"><a href="#cb30-407"></a></span>
<span id="cb30-408"><a href="#cb30-408"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-409"><a href="#cb30-409"></a>advs <span class="ot">&lt;-</span> <span class="fu">derive_basetype_records</span>(</span>
<span id="cb30-410"><a href="#cb30-410"></a>  <span class="at">dataset =</span> advs,</span>
<span id="cb30-411"><a href="#cb30-411"></a>  <span class="at">basetypes =</span> <span class="fu">exprs</span>(</span>
<span id="cb30-412"><a href="#cb30-412"></a>    <span class="st">"LAST: AFTER LYING DOWN FOR 5 MINUTES"</span> <span class="ot">=</span> ATPTN <span class="sc">==</span> <span class="dv">815</span>,</span>
<span id="cb30-413"><a href="#cb30-413"></a>    <span class="st">"LAST: AFTER STANDING FOR 1 MINUTE"</span> <span class="ot">=</span> ATPTN <span class="sc">==</span> <span class="dv">816</span>,</span>
<span id="cb30-414"><a href="#cb30-414"></a>    <span class="st">"LAST: AFTER STANDING FOR 3 MINUTES"</span> <span class="ot">=</span> ATPTN <span class="sc">==</span> <span class="dv">817</span>,</span>
<span id="cb30-415"><a href="#cb30-415"></a>    <span class="st">"LAST"</span> <span class="ot">=</span> <span class="fu">is.na</span>(ATPTN)</span>
<span id="cb30-416"><a href="#cb30-416"></a>  )</span>
<span id="cb30-417"><a href="#cb30-417"></a>)</span>
<span id="cb30-418"><a href="#cb30-418"></a></span>
<span id="cb30-419"><a href="#cb30-419"></a><span class="fu">count</span>(advs, ATPT, ATPTN, BASETYPE)</span>
<span id="cb30-420"><a href="#cb30-420"></a><span class="in">```</span></span>
<span id="cb30-421"><a href="#cb30-421"></a></span>
<span id="cb30-422"><a href="#cb30-422"></a>It is important to derive <span class="in">`BASETYPE`</span> first so that it can be utilized in </span>
<span id="cb30-423"><a href="#cb30-423"></a>subsequent derivations. This will be important if the data frame contains</span>
<span id="cb30-424"><a href="#cb30-424"></a>multiple values for <span class="in">`BASETYPE`</span>.</span>
<span id="cb30-425"><a href="#cb30-425"></a></span>
<span id="cb30-426"><a href="#cb30-426"></a>Next, the analysis baseline flag <span class="in">`ABLFL`</span> can be derived using the <span class="in">`{admiral}`</span></span>
<span id="cb30-427"><a href="#cb30-427"></a>function <span class="in">`admiral::derive_var_extreme_flag()`</span>.  For example, if baseline is defined as the last </span>
<span id="cb30-428"><a href="#cb30-428"></a>non-missing <span class="in">`AVAL`</span> prior or on <span class="in">`TRTSDT`</span>, the function call for <span class="in">`ABLFL`</span> would be:</span>
<span id="cb30-429"><a href="#cb30-429"></a></span>
<span id="cb30-430"><a href="#cb30-430"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-431"><a href="#cb30-431"></a>advs <span class="ot">&lt;-</span> <span class="fu">restrict_derivation</span>(</span>
<span id="cb30-432"><a href="#cb30-432"></a>  advs,</span>
<span id="cb30-433"><a href="#cb30-433"></a>  <span class="at">derivation =</span> derive_var_extreme_flag,</span>
<span id="cb30-434"><a href="#cb30-434"></a>  <span class="at">args =</span> <span class="fu">params</span>(</span>
<span id="cb30-435"><a href="#cb30-435"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, BASETYPE, PARAMCD),</span>
<span id="cb30-436"><a href="#cb30-436"></a>    <span class="at">order =</span> <span class="fu">exprs</span>(ADT, VISITNUM, VSSEQ),</span>
<span id="cb30-437"><a href="#cb30-437"></a>    <span class="at">new_var =</span> ABLFL,</span>
<span id="cb30-438"><a href="#cb30-438"></a>    <span class="at">mode =</span> <span class="st">"last"</span>, <span class="co"># Determines of the first or last observation is flagged</span></span>
<span id="cb30-439"><a href="#cb30-439"></a>    <span class="co"># Below arguments are default values and not necessary to add in our case</span></span>
<span id="cb30-440"><a href="#cb30-440"></a>    <span class="at">true_value =</span> <span class="st">"Y"</span></span>
<span id="cb30-441"><a href="#cb30-441"></a>  ),</span>
<span id="cb30-442"><a href="#cb30-442"></a>  <span class="at">filter =</span> (<span class="sc">!</span><span class="fu">is.na</span>(AVAL) <span class="sc">&amp;</span></span>
<span id="cb30-443"><a href="#cb30-443"></a>    ADT <span class="sc">&lt;=</span> TRTSDT <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(BASETYPE) <span class="sc">&amp;</span> <span class="fu">is.na</span>(DTYPE)</span>
<span id="cb30-444"><a href="#cb30-444"></a>  )</span>
<span id="cb30-445"><a href="#cb30-445"></a>)</span>
<span id="cb30-446"><a href="#cb30-446"></a><span class="in">```</span></span>
<span id="cb30-447"><a href="#cb30-447"></a></span>
<span id="cb30-448"><a href="#cb30-448"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-449"><a href="#cb30-449"></a><span class="fu">print_df</span>(advs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PARAMCD <span class="sc">==</span> <span class="st">"DIABP"</span> <span class="sc">&amp;</span> <span class="fu">toupper</span>(VISIT) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"WEEK 2"</span>, <span class="st">"BASELINE"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, BASETYPE, PARAMCD, ADT, TRTSDT, ATPTN, TRTSDT, ABLFL), <span class="at">n =</span> <span class="dv">30</span>)</span>
<span id="cb30-450"><a href="#cb30-450"></a><span class="in">```</span></span>
<span id="cb30-451"><a href="#cb30-451"></a></span>
<span id="cb30-452"><a href="#cb30-452"></a>Lastly, the <span class="in">`BASE`</span>, and  <span class="in">`BNRIND`</span> columns can be derived using the <span class="in">`{admiral}`</span> function</span>
<span id="cb30-453"><a href="#cb30-453"></a><span class="in">`admiral::derive_var_base()`</span>. Example calls are:</span>
<span id="cb30-454"><a href="#cb30-454"></a></span>
<span id="cb30-455"><a href="#cb30-455"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-456"><a href="#cb30-456"></a>advs <span class="ot">&lt;-</span> <span class="fu">derive_var_base</span>(</span>
<span id="cb30-457"><a href="#cb30-457"></a>  advs,</span>
<span id="cb30-458"><a href="#cb30-458"></a>  <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, PARAMCD, BASETYPE),</span>
<span id="cb30-459"><a href="#cb30-459"></a>  <span class="at">source_var =</span> AVAL,</span>
<span id="cb30-460"><a href="#cb30-460"></a>  <span class="at">new_var =</span> BASE,</span>
<span id="cb30-461"><a href="#cb30-461"></a>  <span class="co"># Below arguments are default values and not necessary to add in our case</span></span>
<span id="cb30-462"><a href="#cb30-462"></a>  <span class="at">filter =</span> ABLFL <span class="sc">==</span> <span class="st">"Y"</span></span>
<span id="cb30-463"><a href="#cb30-463"></a>)</span>
<span id="cb30-464"><a href="#cb30-464"></a></span>
<span id="cb30-465"><a href="#cb30-465"></a>advs <span class="ot">&lt;-</span> <span class="fu">derive_var_base</span>(</span>
<span id="cb30-466"><a href="#cb30-466"></a>  advs,</span>
<span id="cb30-467"><a href="#cb30-467"></a>  <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, PARAMCD, BASETYPE),</span>
<span id="cb30-468"><a href="#cb30-468"></a>  <span class="at">source_var =</span> ANRIND,</span>
<span id="cb30-469"><a href="#cb30-469"></a>  <span class="at">new_var =</span> BNRIND</span>
<span id="cb30-470"><a href="#cb30-470"></a>)</span>
<span id="cb30-471"><a href="#cb30-471"></a><span class="in">```</span></span>
<span id="cb30-472"><a href="#cb30-472"></a></span>
<span id="cb30-473"><a href="#cb30-473"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-474"><a href="#cb30-474"></a><span class="fu">print_df</span>(advs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PARAMCD <span class="sc">==</span> <span class="st">"DIABP"</span> <span class="sc">&amp;</span> <span class="fu">toupper</span>(VISIT) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"WEEK 2"</span>, <span class="st">"BASELINE"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, BASETYPE, PARAMCD, ABLFL, BASE, ANRIND, BNRIND), <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb30-475"><a href="#cb30-475"></a><span class="in">```</span></span>
<span id="cb30-476"><a href="#cb30-476"></a></span>
<span id="cb30-477"><a href="#cb30-477"></a><span class="fu">## Derive Change from Baseline (`CHG`, `PCHG`) {#chgpchg}</span></span>
<span id="cb30-478"><a href="#cb30-478"></a></span>
<span id="cb30-479"><a href="#cb30-479"></a>Change and percent change from baseline can be derived using the <span class="in">`{admiral}`</span> </span>
<span id="cb30-480"><a href="#cb30-480"></a>functions <span class="in">`admiral::derive_var_chg()`</span> and <span class="in">`admiral::derive_var_pchg()`</span>.  These functions expect <span class="in">`AVAL`</span> </span>
<span id="cb30-481"><a href="#cb30-481"></a>and <span class="in">`BASE`</span> to exist in the data frame.  The <span class="in">`CHG`</span> is simply <span class="in">`AVAL - BASE`</span> and the</span>
<span id="cb30-482"><a href="#cb30-482"></a><span class="in">`PCHG`</span> is <span class="in">`(AVAL - BASE) / absolute value (BASE) * 100`</span>.</span>
<span id="cb30-483"><a href="#cb30-483"></a>If the variables should not be derived for all records, e.g., for post-baseline</span>
<span id="cb30-484"><a href="#cb30-484"></a>records only, <span class="in">`admiral::restrict_derivation()`</span> can be used.</span>
<span id="cb30-485"><a href="#cb30-485"></a>Examples calls are:</span>
<span id="cb30-486"><a href="#cb30-486"></a></span>
<span id="cb30-487"><a href="#cb30-487"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-488"><a href="#cb30-488"></a>advs <span class="ot">&lt;-</span> <span class="fu">restrict_derivation</span>(</span>
<span id="cb30-489"><a href="#cb30-489"></a>  advs,</span>
<span id="cb30-490"><a href="#cb30-490"></a>  <span class="at">derivation =</span> derive_var_chg,</span>
<span id="cb30-491"><a href="#cb30-491"></a>  <span class="at">filter =</span> AVISITN <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb30-492"><a href="#cb30-492"></a>)</span>
<span id="cb30-493"><a href="#cb30-493"></a></span>
<span id="cb30-494"><a href="#cb30-494"></a>advs <span class="ot">&lt;-</span> <span class="fu">restrict_derivation</span>(</span>
<span id="cb30-495"><a href="#cb30-495"></a>  advs,</span>
<span id="cb30-496"><a href="#cb30-496"></a>  <span class="at">derivation =</span> derive_var_pchg,</span>
<span id="cb30-497"><a href="#cb30-497"></a>  <span class="at">filter =</span> AVISITN <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb30-498"><a href="#cb30-498"></a>)</span>
<span id="cb30-499"><a href="#cb30-499"></a><span class="in">```</span></span>
<span id="cb30-500"><a href="#cb30-500"></a></span>
<span id="cb30-501"><a href="#cb30-501"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-502"><a href="#cb30-502"></a><span class="fu">print_df</span>(advs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PARAMCD <span class="sc">==</span> <span class="st">"DIABP"</span> <span class="sc">&amp;</span> <span class="fu">toupper</span>(VISIT) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"WEEK 2"</span>, <span class="st">"WEEK 8"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, PARAMCD, VISIT, BASE, AVAL, CHG, PCHG), <span class="at">n =</span> <span class="dv">30</span>)</span>
<span id="cb30-503"><a href="#cb30-503"></a><span class="in">```</span></span>
<span id="cb30-504"><a href="#cb30-504"></a></span>
<span id="cb30-505"><a href="#cb30-505"></a><span class="fu">## Derive Analysis Flags (e.g. `ANL01FL`) {#anl01fl}</span></span>
<span id="cb30-506"><a href="#cb30-506"></a></span>
<span id="cb30-507"><a href="#cb30-507"></a>In most finding ADaMs, an analysis flag is derived to identify the appropriate </span>
<span id="cb30-508"><a href="#cb30-508"></a>observation(s) to use for a particular analysis when a subject has multiple</span>
<span id="cb30-509"><a href="#cb30-509"></a>observations within a particular timing period.</span>
<span id="cb30-510"><a href="#cb30-510"></a></span>
<span id="cb30-511"><a href="#cb30-511"></a>In this situation, an analysis flag (e.g. <span class="in">`ANLzzFL`</span>) may be used to choose the</span>
<span id="cb30-512"><a href="#cb30-512"></a>appropriate record for analysis.</span>
<span id="cb30-513"><a href="#cb30-513"></a></span>
<span id="cb30-514"><a href="#cb30-514"></a>This flag may be derived using the <span class="in">`{admiral}`</span> function <span class="in">`admiral::derive_var_extreme_flag()`</span>. </span>
<span id="cb30-515"><a href="#cb30-515"></a>For this example, we will assume we would like to choose within the Post-Baseline records the latest and </span>
<span id="cb30-516"><a href="#cb30-516"></a>highest value by <span class="in">`USUBJID`</span>, <span class="in">`PARAMCD`</span>, <span class="in">`AVISIT`</span>, and <span class="in">`ATPT`</span>.</span>
<span id="cb30-517"><a href="#cb30-517"></a></span>
<span id="cb30-518"><a href="#cb30-518"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-519"><a href="#cb30-519"></a>advs <span class="ot">&lt;-</span> <span class="fu">restrict_derivation</span>(</span>
<span id="cb30-520"><a href="#cb30-520"></a>  advs,</span>
<span id="cb30-521"><a href="#cb30-521"></a>  <span class="at">derivation =</span> derive_var_extreme_flag,</span>
<span id="cb30-522"><a href="#cb30-522"></a>  <span class="at">args =</span> <span class="fu">params</span>(</span>
<span id="cb30-523"><a href="#cb30-523"></a>    <span class="at">new_var =</span> ANL01FL,</span>
<span id="cb30-524"><a href="#cb30-524"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, PARAMCD, AVISIT, ATPT, DTYPE),</span>
<span id="cb30-525"><a href="#cb30-525"></a>    <span class="at">order =</span> <span class="fu">exprs</span>(ADT, AVAL),</span>
<span id="cb30-526"><a href="#cb30-526"></a>    <span class="at">mode =</span> <span class="st">"last"</span>, <span class="co"># Determines of the first or last observation is flagged - As seen while deriving ABLFL</span></span>
<span id="cb30-527"><a href="#cb30-527"></a>    <span class="co"># Below arguments are default values and not necessary to add in our case</span></span>
<span id="cb30-528"><a href="#cb30-528"></a>    <span class="at">true_value =</span> <span class="st">"Y"</span></span>
<span id="cb30-529"><a href="#cb30-529"></a>  ),</span>
<span id="cb30-530"><a href="#cb30-530"></a>  <span class="at">filter =</span> <span class="sc">!</span><span class="fu">is.na</span>(AVISITN) <span class="sc">&amp;</span> ONTRTFL <span class="sc">==</span> <span class="st">"Y"</span></span>
<span id="cb30-531"><a href="#cb30-531"></a>)</span>
<span id="cb30-532"><a href="#cb30-532"></a><span class="in">```</span></span>
<span id="cb30-533"><a href="#cb30-533"></a></span>
<span id="cb30-534"><a href="#cb30-534"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-535"><a href="#cb30-535"></a><span class="fu">print_df</span>(advs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PARAMCD <span class="sc">==</span> <span class="st">"DIABP"</span> <span class="sc">&amp;</span> <span class="fu">toupper</span>(VISIT) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"WEEK 2"</span>, <span class="st">"WEEK 8"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, PARAMCD, AVISIT, ATPTN, ADT, AVAL, ANL01FL), <span class="at">n =</span> <span class="dv">30</span>)</span>
<span id="cb30-536"><a href="#cb30-536"></a><span class="in">```</span></span>
<span id="cb30-537"><a href="#cb30-537"></a></span>
<span id="cb30-538"><a href="#cb30-538"></a><span class="fu">## Assign Treatment (`TRTA`, `TRTP`) {#treatmentvars}</span></span>
<span id="cb30-539"><a href="#cb30-539"></a></span>
<span id="cb30-540"><a href="#cb30-540"></a><span class="in">`TRTA`</span> and <span class="in">`TRTP`</span> must match at least one value of the character treatment</span>
<span id="cb30-541"><a href="#cb30-541"></a>variables in ADSL (e.g., <span class="in">`TRTxxA`</span>/<span class="in">`TRTxxP`</span>, <span class="in">`TRTSEQA`</span>/<span class="in">`TRTSEQP`</span>,</span>
<span id="cb30-542"><a href="#cb30-542"></a><span class="in">`TRxxAGy`</span>/<span class="in">`TRxxPGy`</span>).</span>
<span id="cb30-543"><a href="#cb30-543"></a></span>
<span id="cb30-544"><a href="#cb30-544"></a>An example of a simple implementation for a study without periods could be:</span>
<span id="cb30-545"><a href="#cb30-545"></a></span>
<span id="cb30-546"><a href="#cb30-546"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-547"><a href="#cb30-547"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb30-548"><a href="#cb30-548"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-549"><a href="#cb30-549"></a>    <span class="at">TRTP =</span> TRT01P,</span>
<span id="cb30-550"><a href="#cb30-550"></a>    <span class="at">TRTA =</span> TRT01A</span>
<span id="cb30-551"><a href="#cb30-551"></a>  )</span>
<span id="cb30-552"><a href="#cb30-552"></a></span>
<span id="cb30-553"><a href="#cb30-553"></a><span class="fu">count</span>(advs, TRTP, TRTA, TRT01P, TRT01A)</span>
<span id="cb30-554"><a href="#cb30-554"></a><span class="in">```</span></span>
<span id="cb30-555"><a href="#cb30-555"></a></span>
<span id="cb30-556"><a href="#cb30-556"></a>For studies with periods see the <span class="co">[</span><span class="ot">"Visit and Period Variables" vignette</span><span class="co">](visits_periods.html#treatment_bds)</span>.</span>
<span id="cb30-557"><a href="#cb30-557"></a></span>
<span id="cb30-558"><a href="#cb30-558"></a><span class="fu">## Assign `ASEQ` {#aseq}</span></span>
<span id="cb30-559"><a href="#cb30-559"></a></span>
<span id="cb30-560"><a href="#cb30-560"></a>The <span class="in">`{admiral}`</span> function <span class="in">`admiral::derive_var_obs_number()`</span> can be used to derive <span class="in">`ASEQ`</span>. An </span>
<span id="cb30-561"><a href="#cb30-561"></a>example call is:</span>
<span id="cb30-562"><a href="#cb30-562"></a></span>
<span id="cb30-563"><a href="#cb30-563"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-564"><a href="#cb30-564"></a>advs <span class="ot">&lt;-</span> <span class="fu">derive_var_obs_number</span>(</span>
<span id="cb30-565"><a href="#cb30-565"></a>  advs,</span>
<span id="cb30-566"><a href="#cb30-566"></a>  <span class="at">new_var =</span> ASEQ,</span>
<span id="cb30-567"><a href="#cb30-567"></a>  <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID),</span>
<span id="cb30-568"><a href="#cb30-568"></a>  <span class="at">order =</span> <span class="fu">exprs</span>(PARAMCD, ADT, AVISITN, VISITNUM, ATPTN, DTYPE),</span>
<span id="cb30-569"><a href="#cb30-569"></a>  <span class="at">check_type =</span> <span class="st">"error"</span></span>
<span id="cb30-570"><a href="#cb30-570"></a>)</span>
<span id="cb30-571"><a href="#cb30-571"></a><span class="in">```</span></span>
<span id="cb30-572"><a href="#cb30-572"></a></span>
<span id="cb30-573"><a href="#cb30-573"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-574"><a href="#cb30-574"></a><span class="fu">print_df</span>(advs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(USUBJID <span class="sc">==</span> <span class="st">"01-701-1015"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, PARAMCD, ADT, AVISITN, ATPTN, VISIT, ADT, ASEQ), <span class="at">n =</span> <span class="dv">30</span>)</span>
<span id="cb30-575"><a href="#cb30-575"></a><span class="in">```</span></span>
<span id="cb30-576"><a href="#cb30-576"></a></span>
<span id="cb30-577"><a href="#cb30-577"></a><span class="fu">## Derive Categorization Variables (`AVALCATy`) {#categorizationvars}</span></span>
<span id="cb30-578"><a href="#cb30-578"></a></span>
<span id="cb30-579"><a href="#cb30-579"></a>We can use the <span class="in">`admiral::derive_vars_cat()`</span> function to derive the categorization variables.</span>
<span id="cb30-580"><a href="#cb30-580"></a></span>
<span id="cb30-581"><a href="#cb30-581"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-582"><a href="#cb30-582"></a>avalcat_lookup <span class="ot">&lt;-</span> <span class="fu">exprs</span>(</span>
<span id="cb30-583"><a href="#cb30-583"></a>  <span class="sc">~</span>PARAMCD,  <span class="sc">~</span>condition,   <span class="sc">~</span>AVALCAT1, <span class="sc">~</span>AVALCA1N,</span>
<span id="cb30-584"><a href="#cb30-584"></a>  <span class="st">"HEIGHT"</span>,  AVAL <span class="sc">&gt;</span> <span class="dv">140</span>,   <span class="st">"&gt;140 cm"</span>,         <span class="dv">1</span>,</span>
<span id="cb30-585"><a href="#cb30-585"></a>  <span class="st">"HEIGHT"</span>, AVAL <span class="sc">&lt;=</span> <span class="dv">140</span>, <span class="st">"&lt;= 140 cm"</span>,         <span class="dv">2</span></span>
<span id="cb30-586"><a href="#cb30-586"></a>)</span>
<span id="cb30-587"><a href="#cb30-587"></a></span>
<span id="cb30-588"><a href="#cb30-588"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb30-589"><a href="#cb30-589"></a>  <span class="fu">derive_vars_cat</span>(</span>
<span id="cb30-590"><a href="#cb30-590"></a>    <span class="at">definition =</span> avalcat_lookup,</span>
<span id="cb30-591"><a href="#cb30-591"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(PARAMCD)</span>
<span id="cb30-592"><a href="#cb30-592"></a>  )</span>
<span id="cb30-593"><a href="#cb30-593"></a><span class="in">```</span></span>
<span id="cb30-594"><a href="#cb30-594"></a></span>
<span id="cb30-595"><a href="#cb30-595"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-596"><a href="#cb30-596"></a><span class="fu">print_df</span>(advs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PARAMCD <span class="sc">==</span> <span class="st">"HEIGHT"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, PARAMCD, AVAL, AVALCA1N, AVALCAT1), <span class="at">n =</span> <span class="dv">30</span>)</span>
<span id="cb30-597"><a href="#cb30-597"></a><span class="in">```</span></span>
<span id="cb30-598"><a href="#cb30-598"></a></span>
<span id="cb30-599"><a href="#cb30-599"></a><span class="fu">## Assign Parameter Level Values (`PARAM`, `PARAMN`) {#paramval}</span></span>
<span id="cb30-600"><a href="#cb30-600"></a></span>
<span id="cb30-601"><a href="#cb30-601"></a>When all <span class="in">`PARAMCD`</span> have been derived and added to the dataset, the other information </span>
<span id="cb30-602"><a href="#cb30-602"></a>from the look-up table (<span class="in">`PARAM`</span>, <span class="in">`PARAMN`</span>,...) should be added using <span class="in">`admiral::derive_vars_merged()`</span> function.</span>
<span id="cb30-603"><a href="#cb30-603"></a></span>
<span id="cb30-604"><a href="#cb30-604"></a>Another way to assign parameter-level values is by using the <span class="in">`metatools`</span> package with the <span class="in">`{metacore}`</span> objects </span>
<span id="cb30-605"><a href="#cb30-605"></a>we created at the beginning. To use the <span class="in">`metatools::create_var_from_codelist()`</span> function, as shown in the example below, certain prerequisites must be met.</span>
<span id="cb30-606"><a href="#cb30-606"></a>Specifically, this function relies on code/decode pairs from a <span class="in">`{metacore}`</span> object. Therefore, these pairs must be defined in the corresponding ADaMs specifications</span>
<span id="cb30-607"><a href="#cb30-607"></a>before creating the <span class="in">`{metacore}`</span> object. </span>
<span id="cb30-608"><a href="#cb30-608"></a></span>
<span id="cb30-609"><a href="#cb30-609"></a>We can look into the <span class="in">`{metacore}`</span> object and see these pairs for the <span class="in">`PARAM`</span> variable.</span>
<span id="cb30-610"><a href="#cb30-610"></a></span>
<span id="cb30-613"><a href="#cb30-613"></a><span class="in">```{r}</span></span>
<span id="cb30-614"><a href="#cb30-614"></a><span class="fu">get_control_term</span>(metacore, <span class="at">variable =</span> PARAM)</span>
<span id="cb30-615"><a href="#cb30-615"></a><span class="in">```</span></span>
<span id="cb30-616"><a href="#cb30-616"></a></span>
<span id="cb30-617"><a href="#cb30-617"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-618"><a href="#cb30-618"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb30-619"><a href="#cb30-619"></a>  <span class="fu">create_var_from_codelist</span>(</span>
<span id="cb30-620"><a href="#cb30-620"></a>    metacore,</span>
<span id="cb30-621"><a href="#cb30-621"></a>    <span class="at">input_var =</span> PARAMCD,</span>
<span id="cb30-622"><a href="#cb30-622"></a>    <span class="at">out_var =</span> PARAM,</span>
<span id="cb30-623"><a href="#cb30-623"></a>    <span class="at">decode_to_code =</span> <span class="cn">FALSE</span> <span class="co"># input_var is the code column of the codelist</span></span>
<span id="cb30-624"><a href="#cb30-624"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-625"><a href="#cb30-625"></a>  <span class="fu">create_var_from_codelist</span>(</span>
<span id="cb30-626"><a href="#cb30-626"></a>    metacore,</span>
<span id="cb30-627"><a href="#cb30-627"></a>    <span class="at">input_var =</span> PARAMCD,</span>
<span id="cb30-628"><a href="#cb30-628"></a>    <span class="at">out_var =</span> PARAMN</span>
<span id="cb30-629"><a href="#cb30-629"></a>  )</span>
<span id="cb30-630"><a href="#cb30-630"></a><span class="in">```</span></span>
<span id="cb30-631"><a href="#cb30-631"></a></span>
<span id="cb30-632"><a href="#cb30-632"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-633"><a href="#cb30-633"></a><span class="fu">print_df</span>(advs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(USUBJID <span class="sc">==</span> <span class="st">"01-716-1024"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, VSTESTCD, PARAMCD, PARAM, PARAMN), <span class="at">n =</span> <span class="dv">30</span>)</span>
<span id="cb30-634"><a href="#cb30-634"></a><span class="in">```</span></span>
<span id="cb30-635"><a href="#cb30-635"></a></span>
<span id="cb30-636"><a href="#cb30-636"></a><span class="fu">## Add ADSL variables {#addadsl}</span></span>
<span id="cb30-637"><a href="#cb30-637"></a></span>
<span id="cb30-638"><a href="#cb30-638"></a>If needed, the other <span class="in">`ADSL`</span> variables can now be added.</span>
<span id="cb30-639"><a href="#cb30-639"></a>List of ADSL variables already merged held in vector <span class="in">`adsl_vars`</span></span>
<span id="cb30-640"><a href="#cb30-640"></a></span>
<span id="cb30-641"><a href="#cb30-641"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb30-642"><a href="#cb30-642"></a>advs <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb30-643"><a href="#cb30-643"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb30-644"><a href="#cb30-644"></a>    <span class="at">dataset_add =</span> <span class="fu">select</span>(adsl, <span class="sc">!!!</span><span class="fu">negate_vars</span>(adsl_vars)),</span>
<span id="cb30-645"><a href="#cb30-645"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID)</span>
<span id="cb30-646"><a href="#cb30-646"></a>  )</span>
<span id="cb30-647"><a href="#cb30-647"></a><span class="in">```</span></span>
<span id="cb30-648"><a href="#cb30-648"></a></span>
<span id="cb30-649"><a href="#cb30-649"></a><span class="in">```{r eval=TRUE, echo=FALSE, purl=FALSE}</span></span>
<span id="cb30-650"><a href="#cb30-650"></a><span class="fu">print_df</span>(advs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(USUBJID <span class="sc">==</span> <span class="st">"01-701-1015"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(USUBJID, RFSTDTC, RFENDTC, DTHDTC, DTHFL, AGE, AGEU), <span class="at">n =</span> <span class="dv">30</span>)</span>
<span id="cb30-651"><a href="#cb30-651"></a><span class="in">```</span></span>
<span id="cb30-652"><a href="#cb30-652"></a></span>
<span id="cb30-653"><a href="#cb30-653"></a><span class="fu"># Apply Metadata and eSub Checks {#metacore_xportr}</span></span>
<span id="cb30-654"><a href="#cb30-654"></a></span>
<span id="cb30-655"><a href="#cb30-655"></a>We use <span class="in">`{metatools}`</span> and <span class="in">`{xportr}`</span> to perform checks, apply metadata such as types, lengths, labels, and write the dataset to an XPT file.</span>
<span id="cb30-656"><a href="#cb30-656"></a></span>
<span id="cb30-657"><a href="#cb30-657"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb30-658"><a href="#cb30-658"></a>dir <span class="ot">&lt;-</span> <span class="fu">tempdir</span>() <span class="co"># Specify the directory for saving the XPT file</span></span>
<span id="cb30-659"><a href="#cb30-659"></a></span>
<span id="cb30-660"><a href="#cb30-660"></a><span class="co"># Apply metadata and perform checks</span></span>
<span id="cb30-661"><a href="#cb30-661"></a>advs_prefinal <span class="ot">&lt;-</span> advs <span class="sc">%&gt;%</span></span>
<span id="cb30-662"><a href="#cb30-662"></a>  <span class="fu">drop_unspec_vars</span>(metacore) <span class="sc">%&gt;%</span> <span class="co"># Drop unspecified variables from specs</span></span>
<span id="cb30-663"><a href="#cb30-663"></a>  <span class="fu">check_variables</span>(metacore, <span class="at">dataset_name =</span> <span class="st">"ADVS"</span>) <span class="sc">%&gt;%</span> <span class="co"># Check all variables specified are present and no more</span></span>
<span id="cb30-664"><a href="#cb30-664"></a>  <span class="fu">order_cols</span>(metacore) <span class="sc">%&gt;%</span> <span class="co"># Orders the columns according to the spec</span></span>
<span id="cb30-665"><a href="#cb30-665"></a>  <span class="fu">sort_by_key</span>(metacore) <span class="co"># Sorts the rows by the sort keys</span></span>
<span id="cb30-666"><a href="#cb30-666"></a></span>
<span id="cb30-667"><a href="#cb30-667"></a><span class="co"># Apply apply labels, formats, and export the dataset to an XPT file.</span></span>
<span id="cb30-668"><a href="#cb30-668"></a>advs_final <span class="ot">&lt;-</span> advs_prefinal <span class="sc">%&gt;%</span></span>
<span id="cb30-669"><a href="#cb30-669"></a>  <span class="fu">xportr_type</span>(metacore) <span class="sc">%&gt;%</span></span>
<span id="cb30-670"><a href="#cb30-670"></a>  <span class="fu">xportr_length</span>(metacore) <span class="sc">%&gt;%</span></span>
<span id="cb30-671"><a href="#cb30-671"></a>  <span class="fu">xportr_label</span>(metacore) <span class="sc">%&gt;%</span></span>
<span id="cb30-672"><a href="#cb30-672"></a>  <span class="fu">xportr_format</span>(metacore, <span class="at">domain =</span> <span class="st">"ADVS"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-673"><a href="#cb30-673"></a>  <span class="fu">xportr_df_label</span>(metacore, <span class="at">domain =</span> <span class="st">"ADVS"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-674"><a href="#cb30-674"></a>  <span class="fu">xportr_write</span>(<span class="fu">file.path</span>(dir, <span class="st">"advs.xpt"</span>), <span class="at">metadata =</span> metacore, <span class="at">domain =</span> <span class="st">"ADVS"</span>)</span>
<span id="cb30-675"><a href="#cb30-675"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>